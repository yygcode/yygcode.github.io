<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<!-- 2018-06-03 Sun 11:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>GCC编译起步</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yanyg" />
<link rel="stylesheet" type="text/css" href="../r/org-code.css" />
<link rel="stylesheet" type="text/css" href="../r/blog-bluetopbar.css" />
<script type="text/javascript" src="../r/MathJax.js?config=TeX-AMS_HTML"> </script>
<script type="text/javascript" src="../r/bootstrap.min.js"></script>
<script type="text/javascript" src="../r/jquery.stickytableheaders.min.js"></script>
</head>
<body>
<div id="preamble" class="status">
<a href="../index.html">Yanyg - SAN Software Engineer</a>
<div class="sitelinks">
  <a href="archives.html">Archives</a> |
  <a href="theindex.html">Index</a> |
  <a href="tags.html">TAGS</a> |
  <a href="https://github.com/yygcode">Github</a> |
  <a href="../about.html">About Me</a>
</div>
</div>
<div id="content">
<h1 class="title">GCC编译起步</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org673077a">1. C编程中的文件后缀名介绍</a></li>
<li><a href="#org939732f">2. hello.c</a>
<ul>
<li><a href="#org28ebfb4">2.1. executable output</a></li>
<li><a href="#org7ca6680">2.2. 预处理文件 hello.i</a></li>
<li><a href="#org668394a">2.3. asm output</a></li>
<li><a href="#orgf5d43aa">2.4. objective output</a></li>
<li><a href="#org1cef9be">2.5. step one by one</a></li>
</ul>
</li>
<li><a href="#org55352b7">3. 静态库/static library</a></li>
<li><a href="#orgcc53246">4. 静态库/dynamic library</a></li>
<li><a href="#orgea8e553">5. 结束语</a></li>
</ul>
</div>
</div>
<p>
CSDN: <a href="http://blog.csdn.net/cppgp/article/details/3457718">http://blog.csdn.net/cppgp/article/details/3457718</a>
</p>

<div id="outline-container-org673077a" class="outline-2">
<h2 id="org673077a"><span class="section-number-2">1</span> C编程中的文件后缀名介绍</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>.a 静态库（打包文件）</li>
<li>.c 未经过预处理的C源码</li>
<li>.h C头文件</li>
<li>.i 经过预处理的C源码</li>
<li>.o 编译之后产生的目标文件</li>
<li>.s 生成的汇编语言代码</li>
<li>.so 动态库（动态链接库）</li>
</ul>

<p>
解释：*.a是我们在编译过后用ar打包生成的静态库；*.c一般是我们自己编辑的代码，是我们劳动的结晶；*.h一般是我们手工生成的接口文件，如果愿意，也可在*.c完成后用
GCC的选项-aux-info帮我们生成；*.i是经过预处理后的源码，是由GCC在选项-E编译下自动生成的文件；*.o是编译后产生的目标文件；*.s是GCC在选项-S编译下生成的汇编语言代码，对于性能要求很高的程序可以先生成汇编语言文件并对汇编做优化，然后用优化后的汇编生成目标文件并链接；*.so是动态库，通过GCC的-fpic -shared选项生成。
</p>
</div>
</div>

<div id="outline-container-org939732f" class="outline-2">
<h2 id="org939732f"><span class="section-number-2">2</span> hello.c</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">hello.c</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>

<span class="org-preprocessor">#include</span><span class="org-whitespace-space"> </span><span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-type">int</span><span class="org-whitespace-space">  </span><span class="org-function-name">main</span>()
{
<span class="org-whitespace-space">        </span>printf(<span class="org-string">"hello,</span><span class="org-whitespace-space"> </span><span class="org-string">world!/n"</span>);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
</pre>
</div>
</div>

<div id="outline-container-org28ebfb4" class="outline-3">
<h3 id="org28ebfb4"><span class="section-number-3">2.1</span> executable output</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-sh">$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello<span class="org-whitespace-space"> </span>hello.c
$<span class="org-whitespace-space"> </span>./hello
hello,<span class="org-whitespace-space"> </span>world!

&#22914;&#19979;&#32534;&#35793;&#26041;&#24335;&#32467;&#26524;&#30456;&#21516;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>hello.c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello
$<span class="org-whitespace-space"> </span>./hello
hello,<span class="org-whitespace-space"> </span>world!

&#22914;&#19979;&#32534;&#35793;&#26041;&#24335;&#26377;&#21035;&#20110;&#20197;&#19978;&#32534;&#35793;&#26041;&#26696;&#65288;&#20855;&#20307;&#26597;&#25214;ELF&#21644;a.out&#25991;&#20214;&#26684;&#24335;&#24046;&#21035;&#30340;&#32593;&#32476;&#36164;&#26009;&#65292;&#23545;&#20110;&#27492;&#22788;&#32467;&#26524;&#26159;&#26080;&#20219;&#20309;&#21306;&#21035;&#30340;&#65289;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>hello.c
$<span class="org-whitespace-space"> </span>./a.out
hello,<span class="org-whitespace-space"> </span>world!
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ca6680" class="outline-3">
<h3 id="org7ca6680"><span class="section-number-3">2.2</span> 预处理文件 hello.i</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-sh">$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-E<span class="org-whitespace-space"> </span>hello.c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.i
$<span class="org-whitespace-space"> </span>ls
a.out<span class="org-whitespace-space">  </span>hello<span class="org-whitespace-space">  </span>hello.c<span class="org-whitespace-space">  </span>hello.i
hello.i<span class="org-whitespace-space"> </span>&#23601;&#26159;&#26032;&#29983;&#25104;&#30340;&#25991;&#20214;

&#22914;&#19979;&#35821;&#21477;&#32467;&#26524;&#30456;&#21516;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-E<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.i<span class="org-whitespace-space"> </span>hello.c

&#22914;&#26524;&#19981;&#35774;&#23450;&#36755;&#20986;&#25991;&#20214;&#65292;&#21017;&#25171;&#21360;&#21040;&#26631;&#20934;&#32456;&#31471;&#65292;&#27492;&#26102;&#25105;&#20204;&#21487;&#20197;&#29992;<span class="org-whitespace-space"> </span>less<span class="org-whitespace-space"> </span>&#26597;&#30475;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-E<span class="org-whitespace-space"> </span>hello.c<span class="org-whitespace-space"> </span>|<span class="org-whitespace-space"> </span>less
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"hello.c"</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"&lt;built-in&gt;"</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"&lt;command</span><span class="org-whitespace-space"> </span><span class="org-comment">line&gt;"</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"hello.c"</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/stdio.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">28</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/stdio.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/features.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
<span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">329</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/features.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
..............................

&#25110;&#32773;&#25191;&#34892;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-E<span class="org-whitespace-space"> </span>hello.c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.i
$<span class="org-whitespace-space"> </span>vi<span class="org-whitespace-space"> </span>hello.i
<span class="org-whitespace-space">  </span>1<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"hello.c"</span>
<span class="org-whitespace-space">  </span>2<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"&lt;built-in&gt;"</span>
<span class="org-whitespace-space">  </span>3<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"&lt;command</span><span class="org-whitespace-space"> </span><span class="org-comment">line&gt;"</span>
<span class="org-whitespace-space">  </span>4<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"hello.c"</span>
<span class="org-whitespace-space">  </span>5<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/stdio.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
<span class="org-whitespace-space">  </span>6<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">28</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/stdio.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
<span class="org-whitespace-space">  </span>7<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/features.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
<span class="org-whitespace-space">  </span>8<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">329</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/features.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>

..........<span class="org-whitespace-space"> </span>&lt;&#20013;&#38388;&#37096;&#20998;&#30053;&gt;<span class="org-whitespace-space"> </span>..................

929<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">844</span><span class="org-whitespace-space"> </span><span class="org-comment">"/usr/include/stdio.h"</span><span class="org-whitespace-space"> </span><span class="org-comment">3</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span>
930
931<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">#</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">"hello.c"</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span>
932
933<span class="org-whitespace-space"> </span>int<span class="org-whitespace-space"> </span>main()
934<span class="org-whitespace-space"> </span>{
935<span class="org-whitespace-space">         </span>printf(<span class="org-string">"hello,</span><span class="org-whitespace-space"> </span><span class="org-string">world!/n"</span>);
936
937<span class="org-whitespace-space">         </span>return<span class="org-whitespace-space"> </span>0;
938<span class="org-whitespace-space"> </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org668394a" class="outline-3">
<h3 id="org668394a"><span class="section-number-3">2.3</span> asm output</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-sh">$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-S<span class="org-whitespace-space"> </span>hello.c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.s
$<span class="org-whitespace-space"> </span>ls
a.out<span class="org-whitespace-space">  </span>hello<span class="org-whitespace-space">  </span>hello.c<span class="org-whitespace-space">  </span>hello.i<span class="org-whitespace-space">  </span>hello.s
hello.s&#23601;&#26159;&#26032;&#29983;&#25104;&#30340;&#25991;&#20214;

&#22914;&#19979;&#35821;&#21477;&#32467;&#26524;&#30456;&#21516;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-S<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.s<span class="org-whitespace-space"> </span>hello.c

&#22914;&#19979;&#35821;&#21477;&#32467;&#26524;&#30456;&#21516;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-S<span class="org-whitespace-space"> </span>hello.c

&#20063;&#21487;&#20197;&#37319;&#29992;&#21069;&#19968;&#27493;&#39588;&#20135;&#29983;&#30340;&#20013;&#38388;&#25991;&#20214;&#29983;&#25104;&#27719;&#32534;&#25991;&#20214;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-S<span class="org-whitespace-space"> </span>hello.i<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.s
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-S<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.s<span class="org-whitespace-space"> </span>hello.i
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-S<span class="org-whitespace-space"> </span>hello.i


&#29983;&#25104;&#30340;&#27719;&#32534;&#37096;&#20998;&#20195;&#30721;&#22914;&#19979;&#65306;
$<span class="org-whitespace-space"> </span>vi<span class="org-whitespace-space"> </span>hello.s
<span class="org-whitespace-space">  </span>1<span class="org-whitespace-space">         </span>.file<span class="org-whitespace-space">   </span><span class="org-string">"hello.c"</span>
<span class="org-whitespace-space">  </span>2<span class="org-whitespace-space">         </span>.section<span class="org-whitespace-space">        </span>.rodata
<span class="org-whitespace-space">  </span>3<span class="org-whitespace-space"> </span>.LC0:
<span class="org-whitespace-space">  </span>4<span class="org-whitespace-space">         </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"hello,</span><span class="org-whitespace-space"> </span><span class="org-string">world!"</span>
<span class="org-whitespace-space">  </span>5<span class="org-whitespace-space">         </span>.text
<span class="org-whitespace-space">  </span>6<span class="org-whitespace-space"> </span>.globl<span class="org-whitespace-space"> </span>main
<span class="org-whitespace-space">  </span>7<span class="org-whitespace-space">         </span>.type<span class="org-whitespace-space">   </span>main,<span class="org-whitespace-space"> </span>@<span class="org-keyword">function</span>
<span class="org-whitespace-space">  </span>8<span class="org-whitespace-space"> </span>main:
<span class="org-whitespace-space">  </span>9<span class="org-whitespace-space">         </span>leal<span class="org-whitespace-space">    </span>4(%esp),<span class="org-whitespace-space"> </span>%ecx
<span class="org-whitespace-space"> </span>10<span class="org-whitespace-space">         </span>andl<span class="org-whitespace-space">    </span>$<span class="org-variable-name">-</span>16,<span class="org-whitespace-space"> </span>%esp
<span class="org-whitespace-space"> </span>11<span class="org-whitespace-space">         </span>pushl<span class="org-whitespace-space">   </span>-4(%ecx)
<span class="org-whitespace-space"> </span>12<span class="org-whitespace-space">         </span>pushl<span class="org-whitespace-space">   </span>%ebp
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5d43aa" class="outline-3">
<h3 id="orgf5d43aa"><span class="section-number-3">2.4</span> objective output</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-sh">$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>hello.c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.o
$<span class="org-whitespace-space"> </span>ls
a.out<span class="org-whitespace-space">  </span>hello<span class="org-whitespace-space">  </span>hello.c<span class="org-whitespace-space">  </span>hello.i<span class="org-whitespace-space">  </span>hello.o<span class="org-whitespace-space">  </span>hello.s
hello.o&#23601;&#26159;&#26032;&#29983;&#25104;&#30340;&#30446;&#26631;&#25991;&#20214;&#65306;

&#22914;&#19979;&#35821;&#21477;&#32467;&#26524;&#30456;&#21516;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello.o<span class="org-whitespace-space"> </span>hello.c

&#22914;&#19979;&#35821;&#21477;&#32467;&#26524;&#30456;&#21516;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>hello.c

&#20063;&#21487;&#20197;&#37319;&#29992;&#21069;&#38754;&#27493;&#39588;&#20135;&#29983;&#30340;&#20013;&#38388;&#25991;&#20214;hello.i&#25110;hello.s&#26469;&#29983;&#25104;&#30446;&#26631;&#25991;&#20214;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>hello.i
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>hello.s

&#25105;&#20204;&#21487;&#20197;&#29992;<span class="org-whitespace-space"> </span>objdump<span class="org-whitespace-space"> </span>&#26597;&#30475;<span class="org-whitespace-space"> </span>hello.o<span class="org-whitespace-space"> </span>&#30340;&#20108;&#36827;&#21046;&#30721;&#65306;
$<span class="org-whitespace-space"> </span>objdump<span class="org-whitespace-space"> </span>-s<span class="org-whitespace-space"> </span>hello.o

hello.o:<span class="org-whitespace-space">     </span>file<span class="org-whitespace-space"> </span>format<span class="org-whitespace-space"> </span>elf32-i386

Contents<span class="org-whitespace-space"> </span>of<span class="org-whitespace-space"> </span>section<span class="org-whitespace-space"> </span>.text:
<span class="org-whitespace-space"> </span>0000<span class="org-whitespace-space"> </span>8d4c2404<span class="org-whitespace-space"> </span>83e4f0ff<span class="org-whitespace-space"> </span>71fc5589<span class="org-whitespace-space"> </span>e55183ec<span class="org-whitespace-space">  </span>.L$.....q.U..Q..
<span class="org-whitespace-space"> </span>0010<span class="org-whitespace-space"> </span>04c70424<span class="org-whitespace-space"> </span>00000000<span class="org-whitespace-space"> </span>e8fcffff<span class="org-whitespace-space"> </span>ffb80000<span class="org-whitespace-space">  </span>...$............
<span class="org-whitespace-space"> </span>0020<span class="org-whitespace-space"> </span>000083c4<span class="org-whitespace-space"> </span>04595d8d<span class="org-whitespace-space"> </span>61fcc3<span class="org-whitespace-space">             </span>.....Y].a..
Contents<span class="org-whitespace-space"> </span>of<span class="org-whitespace-space"> </span>section<span class="org-whitespace-space"> </span>.rodata:
<span class="org-whitespace-space"> </span>0000<span class="org-whitespace-space"> </span>68656c6c<span class="org-whitespace-space"> </span>6f2c2077<span class="org-whitespace-space"> </span>6f726c64<span class="org-whitespace-space"> </span>2100<span class="org-whitespace-space">      </span>hello,<span class="org-whitespace-space"> </span>world!.
Contents<span class="org-whitespace-space"> </span>of<span class="org-whitespace-space"> </span>section<span class="org-whitespace-space"> </span>.comment:
<span class="org-whitespace-space"> </span>0000<span class="org-whitespace-space"> </span>00474343<span class="org-whitespace-space"> </span>3a202847<span class="org-whitespace-space"> </span>4e552920<span class="org-whitespace-space"> </span>342e312e<span class="org-whitespace-space">  </span>.GCC:<span class="org-whitespace-space"> </span>(GNU)<span class="org-whitespace-space"> </span>4.1.
<span class="org-whitespace-space"> </span>0010<span class="org-whitespace-space"> </span>31203230<span class="org-whitespace-space"> </span>30373031<span class="org-whitespace-space"> </span>30352028<span class="org-whitespace-space"> </span>52656420<span class="org-whitespace-space">  </span>1<span class="org-whitespace-space"> </span>20070105<span class="org-whitespace-space"> </span>(Red
<span class="org-whitespace-space"> </span>0020<span class="org-whitespace-space"> </span>48617420<span class="org-whitespace-space"> </span>342e312e<span class="org-whitespace-space"> </span>312d3532<span class="org-whitespace-space"> </span>2900<span class="org-whitespace-space">      </span>Hat<span class="org-whitespace-space"> </span>4.1.1-52)<span class="org-builtin">.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1cef9be" class="outline-3">
<h3 id="org1cef9be"><span class="section-number-3">2.5</span> step one by one</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-sh">$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello<span class="org-whitespace-space"> </span>hello.i
$<span class="org-whitespace-space"> </span>./hello
hello,<span class="org-whitespace-space"> </span>world!

$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello<span class="org-whitespace-space"> </span>hello.s
$<span class="org-whitespace-space"> </span>./hello
hello,<span class="org-whitespace-space"> </span>world!

$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>hello<span class="org-whitespace-space"> </span>hello.o
$<span class="org-whitespace-space"> </span>./hello
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org55352b7" class="outline-2">
<h2 id="org55352b7"><span class="section-number-2">3</span> 静态库/static library</h2>
<div class="outline-text-2" id="text-3">
<p>
linux下静态库的生成比较方便。在生成目标文件后用 ar 打包即可。在中大型项目中一个模块一般会做成一个静态库，以方便管理、提高编译、链接效率。
</p>

<p>
本小节的展示针对 main.c、func1.c、func2.c三个文件。
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">main.c</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-preprocessor">#include</span><span class="org-whitespace-space"> </span><span class="org-string">&lt;stdio.h&gt;</span>

<span class="org-keyword">extern</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">func1</span>();
<span class="org-keyword">extern</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">func2</span>();

<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">main</span>()
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">i</span>;

<span class="org-whitespace-space">        </span>i<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>func1();
<span class="org-whitespace-space">        </span>printf(<span class="org-string">"func1</span><span class="org-whitespace-space"> </span><span class="org-string">return</span><span class="org-whitespace-space"> </span><span class="org-string">=</span><span class="org-whitespace-space"> </span><span class="org-string">%d/n"</span>,i);

<span class="org-whitespace-space">        </span>i<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>func2();
<span class="org-whitespace-space">        </span>printf(<span class="org-string">"func2</span><span class="org-whitespace-space"> </span><span class="org-string">return</span><span class="org-whitespace-space"> </span><span class="org-string">=</span><span class="org-whitespace-space"> </span><span class="org-string">%d/n"</span>,i);

<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">func1.c</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">func1</span>()
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>100;
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">func2.c</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">func2</span>()
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>200;
}
</pre>
</div>

<p>
compile:
</p>
<div class="org-src-container">
<pre class="src src-sh">$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>func1.c
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>func2.c
$<span class="org-whitespace-space"> </span>ls
func1.c<span class="org-whitespace-space">  </span>func1.o<span class="org-whitespace-space">  </span>func2.c<span class="org-whitespace-space">  </span>func2.o<span class="org-whitespace-space">  </span>main.c

func1.o<span class="org-whitespace-space"> </span>&#21644;<span class="org-whitespace-space"> </span>func2.o<span class="org-whitespace-space"> </span>&#26159;&#25105;&#20204;&#29983;&#25104;&#30340;&#30446;&#26631;&#25991;&#20214;&#12290;&#25171;&#21253;&#25351;&#20196;&#22914;&#19979;&#65306;
$<span class="org-whitespace-space"> </span>ar<span class="org-whitespace-space"> </span>-r<span class="org-whitespace-space"> </span>libfunc.a<span class="org-whitespace-space"> </span>func1.o<span class="org-whitespace-space"> </span>func2.o

&#25105;&#20204;&#26597;&#30475;<span class="org-whitespace-space"> </span>libfunc.a<span class="org-whitespace-space"> </span>&#20013;&#30340;&#25991;&#20214;&#65306;
$<span class="org-whitespace-space"> </span>ar<span class="org-whitespace-space"> </span>-t<span class="org-whitespace-space"> </span>libfunc.a
func1.o
func2.o

&#29616;&#22312;&#29992;&#38745;&#24577;&#24211;&#21644;<span class="org-whitespace-space"> </span>main.c<span class="org-whitespace-space"> </span>&#20849;&#21516;&#29983;&#25104;&#30446;&#26631;&#31243;&#24207;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>main<span class="org-whitespace-space"> </span>main.c<span class="org-whitespace-space"> </span>libfunc.a
$<span class="org-whitespace-space"> </span>./main
func1<span class="org-whitespace-space"> </span>return<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>100
func2<span class="org-whitespace-space"> </span>return<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>200

&#21644;&#25105;&#20204;&#30340;&#39044;&#26399;&#30456;&#31526;&#21512;&#12290;&#19979;&#38754;&#25105;&#20204;&#36827;&#20837;&#21160;&#24577;&#24211;&#12290;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc53246" class="outline-2">
<h2 id="orgcc53246"><span class="section-number-2">4</span> 静态库/dynamic library</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-sh">&#39318;&#20808;&#25105;&#20204;&#29983;&#25104;&#30446;&#26631;&#25991;&#20214;&#65292;&#20294;&#26159;&#38656;&#35201;&#21152;&#32534;&#35793;&#22120;&#36873;&#39033;<span class="org-whitespace-space"> </span>-fpic<span class="org-whitespace-space"> </span>&#21644;&#38142;&#25509;&#22120;&#36873;&#39033;<span class="org-whitespace-space"> </span>-shared
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-fpic<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>func1.c
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-fpic<span class="org-whitespace-space"> </span>-c<span class="org-whitespace-space"> </span>func2.c
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-shared<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>libfunc.so<span class="org-whitespace-space"> </span>func1.o<span class="org-whitespace-space"> </span>func2.o
$<span class="org-whitespace-space"> </span>ls
func1.c<span class="org-whitespace-space">  </span>func1.o<span class="org-whitespace-space">  </span>func2.c<span class="org-whitespace-space">  </span>func2.o<span class="org-whitespace-space">  </span>libfunc.so<span class="org-whitespace-space">  </span>main.c
libfunc.so&#23601;&#26159;&#25105;&#20204;&#29983;&#25104;&#30340;&#30446;&#26631;&#21160;&#24577;&#24211;&#12290;&#25105;&#20204;&#29992;&#21160;&#24577;&#24211;&#21644;<span class="org-whitespace-space"> </span>main.c<span class="org-whitespace-space"> </span>&#29983;&#25104;&#30446;&#26631;&#31243;&#24207;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>main<span class="org-whitespace-space"> </span>main.c<span class="org-whitespace-space"> </span>-L.<span class="org-whitespace-space"> </span>-lfunc
&#27880;&#24847;&#65292;&#25105;&#20204;&#29992;<span class="org-whitespace-space"> </span>-L.<span class="org-whitespace-space"> </span>-lfunc<span class="org-whitespace-space"> </span>&#20316;&#20026;&#32534;&#35793;&#36873;&#39033;&#12290;-L.<span class="org-whitespace-space"> </span>&#34920;&#20174;&#24403;&#21069;&#30446;&#24405;&#26597;&#25214;&#38656;&#35201;&#30340;&#21160;&#24577;&#24211;&#65292;-lfunc<span class="org-whitespace-space"> </span>&#26159;&#21160;&#24577;&#24211;&#30340;&#35843;&#29992;&#35268;&#21017;&#12290;Linux&#31995;&#32479;&#19979;&#30340;&#21160;&#24577;&#24211;&#21629;&#21517;&#26041;&#24335;&#26159;<span class="org-whitespace-space"> </span>l<span class="org-whitespace-line">ib*.so&#65292;&#32780;&#22312;&#38142;&#25509;&#26102;&#34920;&#31034;&#20301;</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">-l*</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">&#65292;</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">*&#26159;&#33258;&#24049;&#36215;&#30340;&#24211;&#21517;&#12290;&#19979;&#38754;&#25105;&#20204;&#36816;&#34892;&#23427;&#65306;</span>
$<span class="org-whitespace-space"> </span>./main
./main:<span class="org-whitespace-space"> </span>error<span class="org-whitespace-space"> </span>while<span class="org-whitespace-space"> </span>loading<span class="org-whitespace-space"> </span>shared<span class="org-whitespace-space"> </span>libraries:<span class="org-whitespace-space"> </span>libfunc.so:<span class="org-whitespace-space"> </span>cannot<span class="org-whitespace-space"> </span>open<span class="org-whitespace-space"> </span>shared<span class="org-whitespace-space"> </span>obj<span class="org-whitespace-line">ect</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">file:</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">No</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">such</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">file</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">or</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">directory</span>
&#25552;&#31034;&#19968;&#20010;&#38169;&#35823;&#65292;&#25351;&#31034;&#26080;&#27861;&#25214;&#21040;&#21160;&#24577;&#24211;&#12290;&#22312;linux&#19979;&#26368;&#26041;&#20415;&#30340;&#35299;&#20915;&#26041;&#26696;&#26159;&#25335;&#36125;libfunc.so&#21040;&#32477;&#23545;&#30446;&#24405;<span class="org-whitespace-space"> </span>/lib<span class="org-whitespace-space"> </span>&#19979;&#12290;&#20294;&#26159;&#21482;&#26377;&#36229;&#32423;&#29992;&#25143;&#25165;&#26377;&#36825;&#20010;&#26435;&#38480;&#12290;&#21478;&#22806;&#19968;&#20010;&#26041;&#26696;&#26159;<span class="org-whitespace-line">&#26356;&#25913;&#29615;&#22659;&#21464;&#37327;</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">LD_LIBRARY_PATH&#12290;&#22914;&#19979;&#65306;</span>
$<span class="org-whitespace-space"> </span>$<span class="org-whitespace-space"> </span>export<span class="org-whitespace-space"> </span><span class="org-variable-name">LD_LIBRARY_PATH</span>=<span class="org-sh-quoted-exec">`pwd`</span>
$<span class="org-whitespace-space"> </span>./main
func1<span class="org-whitespace-space"> </span>return<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>100
func2<span class="org-whitespace-space"> </span>return<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>200
&#36816;&#34892;&#25104;&#21151;&#12290;&#29616;&#22312;&#25105;&#20204;&#26356;&#25913;&#21160;&#24577;&#24211;&#30340;&#20989;&#25968;&#32780;&#19981;&#37325;&#26032;&#38142;&#25509;&#12290;&#22914;&#19979;&#65306;
&#26356;&#25913;<span class="org-whitespace-space"> </span>func1.c<span class="org-whitespace-space"> </span>&#20026;&#65306;
int<span class="org-whitespace-space"> </span>func1()
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>101;
}
&#26356;&#25913;<span class="org-whitespace-space"> </span>func2.c<span class="org-whitespace-space"> </span>&#20026;&#65306;
int<span class="org-whitespace-space"> </span>func2()
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>202;
}
&#37325;&#26032;&#29983;&#25104;&#24211;&#65306;
$<span class="org-whitespace-space"> </span>gcc<span class="org-whitespace-space"> </span>-fpic<span class="org-whitespace-space"> </span>-shared<span class="org-whitespace-space"> </span>func1.c<span class="org-whitespace-space"> </span>func2.c<span class="org-whitespace-space"> </span>-o<span class="org-whitespace-space"> </span>libfunc.so
$<span class="org-whitespace-space"> </span>./main
func1<span class="org-whitespace-space"> </span>return<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>101
func2<span class="org-whitespace-space"> </span>return<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>202
&#21487;&#20197;&#30475;&#20986;&#65292;&#21160;&#24577;&#24211;&#24050;&#32463;&#26356;&#26032;&#20102;&#12290;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea8e553" class="outline-2">
<h2 id="orgea8e553"><span class="section-number-2">5</span> 结束语</h2>
<div class="outline-text-2" id="text-5">
<p>
本文简单介绍了linux下如何使用gcc进行编译程序、以及简单的静态、动态库的生成。静态库提供了一种打包管理方案，而动态库使程序局部更新成为了可能，更重要的是，当有多份实例存在时，动态库可减小内存的消耗（只占用一份代码空间）。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread" class="disqus container"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://ycode.org/blogs/gcc-compile-startup.html';
    this.page.identifier = 'gcc-compile-startup.html';
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://yanyg.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div class="copyright">
2012-2020 Copyright&copy; <i> YANYG - Powered by Emacs Orgmode</i>
</div>
</div>
</body>
</html>
