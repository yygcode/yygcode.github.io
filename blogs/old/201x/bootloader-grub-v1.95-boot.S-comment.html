<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<meta charset="utf-8" />
<title>grub2 1.95 源码分析之一 —— boot.S 分析及注释</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yanyg" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="/themes/blogs/css/blog.css" />
<script type="text/javascript" src="/themes/blogs/js/blog.js"> </script>
</head>
<body>
<div id="preamble" class="status">
<a href="../../../index.html">Yanyg - SAN Software Engineer</a>
<div class="sitelinks">
  <a href="../../archives.html">Archives</a> |
  <a href="../../theindex.html">Index</a> |
  <a href="../../tags.html">TAGS</a> |
  <a href="https://github.com/yygcode">Github</a> |
  <a href="../../../about.html">About Me</a>
</div>
</div>
<div id="content">
<h1 class="title">grub2 1.95 源码分析之一 —— boot.S 分析及注释</h1>
<p>
本文最早发布于CSDN：<a href="https://blog.csdn.net/cppgp/article/details/2060146">https://blog.csdn.net/cppgp/article/details/2060146</a>
</p>

<div class="org-src-container">
<pre class="src src-asm"><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">-*-Asm-*-</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">GRUB</span><span class="org-whitespace-space">  </span><span class="org-comment">--</span><span class="org-whitespace-space">  </span><span class="org-comment">GRand</span><span class="org-whitespace-space"> </span><span class="org-comment">Unified</span><span class="org-whitespace-space"> </span><span class="org-comment">Bootloader</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">Copyright</span><span class="org-whitespace-space"> </span><span class="org-comment">(C)</span><span class="org-whitespace-space"> </span><span class="org-comment">1999,2000,2001,2002,2005,2006</span><span class="org-whitespace-space">  </span><span class="org-comment">Free</span><span class="org-whitespace-space"> </span><span class="org-comment">Software</span><span class="org-whitespace-space"> </span><span class="org-comment">Foundation,</span><span class="org-whitespace-space"> </span><span class="org-comment">Inc.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">program</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">free</span><span class="org-whitespace-space"> </span><span class="org-comment">software;</span><span class="org-whitespace-space"> </span><span class="org-comment">you</span><span class="org-whitespace-space"> </span><span class="org-comment">can</span><span class="org-whitespace-space"> </span><span class="org-comment">redistribute</span><span class="org-whitespace-space"> </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">and/or</span><span class="org-whitespace-space"> </span><span class="org-comment">modify</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">under</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">terms</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">GNU</span><span class="org-whitespace-space"> </span><span class="org-comment">General</span><span class="org-whitespace-space"> </span><span class="org-comment">Public</span><span class="org-whitespace-space"> </span><span class="org-comment">License</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">published</span><span class="org-whitespace-space"> </span><span class="org-comment">by</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">Free</span><span class="org-whitespace-space"> </span><span class="org-comment">Software</span><span class="org-whitespace-space"> </span><span class="org-comment">Foundation;</span><span class="org-whitespace-space"> </span><span class="org-comment">either</span><span class="org-whitespace-space"> </span><span class="org-comment">version</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">License,</span><span class="org-whitespace-space"> </span><span class="org-comment">or</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">(at</span><span class="org-whitespace-space"> </span><span class="org-comment">your</span><span class="org-whitespace-space"> </span><span class="org-comment">option)</span><span class="org-whitespace-space"> </span><span class="org-comment">any</span><span class="org-whitespace-space"> </span><span class="org-comment">later</span><span class="org-whitespace-space"> </span><span class="org-comment">version.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">program</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">distributed</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">hope</span><span class="org-whitespace-space"> </span><span class="org-comment">that</span><span class="org-whitespace-space"> </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">will</span><span class="org-whitespace-space"> </span><span class="org-comment">be</span><span class="org-whitespace-space"> </span><span class="org-comment">useful,</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">but</span><span class="org-whitespace-space"> </span><span class="org-comment">WITHOUT</span><span class="org-whitespace-space"> </span><span class="org-comment">ANY</span><span class="org-whitespace-space"> </span><span class="org-comment">WARRANTY;</span><span class="org-whitespace-space"> </span><span class="org-comment">without</span><span class="org-whitespace-space"> </span><span class="org-comment">even</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">implied</span><span class="org-whitespace-space"> </span><span class="org-comment">warranty</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">MERCHANTABILITY</span><span class="org-whitespace-space"> </span><span class="org-comment">or</span><span class="org-whitespace-space"> </span><span class="org-comment">FITNESS</span><span class="org-whitespace-space"> </span><span class="org-comment">FOR</span><span class="org-whitespace-space"> </span><span class="org-comment">A</span><span class="org-whitespace-space"> </span><span class="org-comment">PARTICULAR</span><span class="org-whitespace-space"> </span><span class="org-comment">PURPOSE.</span><span class="org-whitespace-space">  </span><span class="org-comment">See</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">GNU</span><span class="org-whitespace-space"> </span><span class="org-comment">General</span><span class="org-whitespace-space"> </span><span class="org-comment">Public</span><span class="org-whitespace-space"> </span><span class="org-comment">License</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">more</span><span class="org-whitespace-space"> </span><span class="org-comment">details.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">You</span><span class="org-whitespace-space"> </span><span class="org-comment">should</span><span class="org-whitespace-space"> </span><span class="org-comment">have</span><span class="org-whitespace-space"> </span><span class="org-comment">received</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">copy</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">GNU</span><span class="org-whitespace-space"> </span><span class="org-comment">General</span><span class="org-whitespace-space"> </span><span class="org-comment">Public</span><span class="org-whitespace-space"> </span><span class="org-comment">License</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">along</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">program;</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">not,</span><span class="org-whitespace-space"> </span><span class="org-comment">write</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">Free</span><span class="org-whitespace-space"> </span><span class="org-comment">Software</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">Foundation,</span><span class="org-whitespace-space"> </span><span class="org-comment">Inc.,</span><span class="org-whitespace-space"> </span><span class="org-comment">675</span><span class="org-whitespace-space"> </span><span class="org-comment">Mass</span><span class="org-whitespace-space"> </span><span class="org-comment">Ave,</span><span class="org-whitespace-space"> </span><span class="org-comment">Cambridge,</span><span class="org-whitespace-space"> </span><span class="org-comment">MA</span><span class="org-whitespace-space"> </span><span class="org-comment">02139,</span><span class="org-whitespace-space"> </span><span class="org-comment">USA.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">cppgp</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27880;&#37322;&#29256;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36716;&#36733;&#35831;&#27880;&#26126;&#21407;&#20316;&#32773;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27880;&#37322;&#29256;&#26412;&#21495;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">1.00</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26085;&#26399;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">2008-01-22</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#32852;&#31995;&#26041;&#24335;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">email</span><span class="org-whitespace-space"> </span><span class="org-comment">yanyg02@163.com</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">msn</span><span class="org-whitespace-space">  </span><span class="org-comment">yanyg02@hotmail.com</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">qq</span><span class="org-whitespace-space">  </span><span class="org-comment">281607998</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27969;&#31243;&#21450;&#21151;&#33021;&#31616;&#20171;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29983;&#25104;</span><span class="org-whitespace-space"> </span><span class="org-comment">512</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;&#30340;&#26426;&#22120;&#30721;&#23384;&#20648;&#22312;&#30828;&#30424;&#25110;&#32773;&#36719;&#30424;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">MBR</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34987;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21152;&#36733;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21040;&#20869;&#23384;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C00</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">CPU</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C00</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#24320;&#22987;&#25191;&#34892;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25511;&#21046;&#26435;&#21040;&#20102;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25163;&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">.</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26681;&#25454;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#30340;&#23492;&#23384;&#22120;&#21021;&#22987;&#20540;&#21644;&#19968;&#20123;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#26029;&#35843;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21028;&#26029;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24341;&#23548;&#39537;&#21160;&#22120;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA&#30828;&#30424;/CHS&#30828;&#30424;/&#36719;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#30340;&#21738;&#19968;&#31181;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24182;&#20445;&#23384;&#30913;&#30424;&#21442;&#25968;&#21040;&#30913;&#30424;&#21442;&#25968;&#22359;&#22320;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22336;(BPB)</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#35835;&#21462;&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;&#30830;&#23450;&#30340;&#25159;&#21306;&#22359;</span><span class="org-whitespace-space"> </span><span class="org-comment">(</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21363;diskboot.img</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">bootdisk.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29983;&#25104;&#30340;&#20108;&#36827;&#21046;&#30721;&#25991;&#20214;</span><span class="org-whitespace-space"> </span><span class="org-comment">)&#20869;&#23384;&#20648;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">512</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;&#30340;&#20869;&#23481;&#21040;&#20869;&#23384;&#22320;&#22336;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x70000</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20877;&#25335;&#36125;&#21040;&#20869;&#23384;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24320;&#22987;&#25191;&#34892;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">bootdisk.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#33719;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24471;&#25511;&#21046;&#26435;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#32780;</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23601;&#21151;&#25104;&#36523;&#36864;&#20102;.</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20294;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#30340;&#23454;&#27169;&#24335;&#19979;&#30340;&#22534;&#26632;&#21450;&#23492;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#22120;&#20540;,&#20197;&#21450;&#24341;&#23548;&#39537;&#21160;&#22120;&#30340;&#27169;&#24335;&#21644;&#21442;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">bootdisk.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#37117;&#26377;&#29992;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">.</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20855;&#20307;&#35831;&#30475;&#20195;&#30721;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27880;&#37322;&#21450;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#27880;&#37322;</span><span class="org-whitespace-space"> </span><span class="org-comment">.</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#22312;&#21152;&#36733;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.img</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#36807;&#31243;&#20013;&#20986;&#38169;,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21017;&#36755;&#20986;&#38169;&#35823;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25552;&#31034;&#20449;&#24687;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;&#27515;&#24490;&#29615;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#31561;&#24453;&#25163;&#24037;&#37325;&#36215;&#25110;&#32773;&#20851;&#38381;.</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29983;&#25104;&#30340;&#26426;&#22120;&#30721;&#34987;&#21152;&#36733;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C00~0x7DFF</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20855;&#20307;&#26426;&#22120;&#30721;&#35265;&#25991;&#26723;&#26368;&#21518;&#37096;&#20998;</span>


<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36825;&#20010;&#22836;&#25991;&#20214;&#37324;&#38754;&#21482;&#23450;&#20041;&#20102;&#19968;&#20010;&#29256;&#26412;&#21495;</span>
<span class="org-preprocessor">#include</span><span class="org-whitespace-space"> </span><span class="org-string">&lt;grub/boot.h&gt;</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36825;&#20010;&#22836;&#25991;&#20214;&#21363;../.././include/grub/i386/pc/boot.h</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23450;&#20041;&#24341;&#23548;&#38656;&#35201;&#30340;&#31995;&#32479;&#24120;&#37327;&#23450;&#20041;</span>
<span class="org-preprocessor">#include</span><span class="org-whitespace-space"> </span><span class="org-string">&lt;grub/machine/boot.h&gt;</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;&#20195;&#30721;&#20013;&#20351;&#29992;&#23439;&#30340;&#22320;&#26041;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25105;&#37117;&#20570;&#20102;&#23439;&#30340;&#35828;&#26126;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35835;&#32773;&#19981;&#38656;&#35201;&#36319;&#36394;&#21040;&#23545;&#24212;</span><span class="org-whitespace-space"> </span><span class="org-comment">.h</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25991;&#20214;&#20013;&#30475;&#23439;&#23450;&#20041;</span>

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">defines</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span><span class="org-whitespace-space"> </span><span class="org-comment">go</span><span class="org-whitespace-space"> </span><span class="org-comment">here</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">Absolute</span><span class="org-whitespace-space"> </span><span class="org-comment">addresses</span>
<span class="org-whitespace-space">   </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">makes</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">assembler</span><span class="org-whitespace-space"> </span><span class="org-comment">generate</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">address</span><span class="org-whitespace-space"> </span><span class="org-comment">without</span><span class="org-whitespace-space"> </span><span class="org-comment">support</span>
<span class="org-whitespace-space">   </span><span class="org-comment">from</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">linker.</span><span class="org-whitespace-space"> </span><span class="org-comment">(ELF</span><span class="org-whitespace-space"> </span><span class="org-comment">can't</span><span class="org-whitespace-space"> </span><span class="org-comment">relocate</span><span class="org-whitespace-space"> </span><span class="org-comment">16-bit</span><span class="org-whitespace-space"> </span><span class="org-comment">addresses!)</span>
<span class="org-comment">*/</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ABS(x)&#35745;&#31639;x&#30340;&#32477;&#23545;&#22320;&#22336;,&#29992;&#26469;&#29983;&#25104;&#19981;&#21463;&#36830;&#25509;&#22120;&#38480;&#21046;&#30340;&#22320;&#22336;(ELF&#19981;&#33021;&#29983;&#25104;&#21487;&#37325;&#20837;&#30340;&#22320;&#22336;).</span>
<span class="org-preprocessor">#define</span><span class="org-whitespace-space"> </span><span class="org-function-name">ABS</span>(<span class="org-variable-name">x</span>)<span class="org-whitespace-space"> </span>(x-_start+0x7c00)

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">Print</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span><span class="org-whitespace-space"> </span><span class="org-comment">string</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25171;&#21360;</span><span class="org-whitespace-space"> </span><span class="org-comment">x</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25351;&#21521;&#30340;&#23383;&#31526;&#20018;&#21040;&#32456;&#31471;</span>
<span class="org-preprocessor">#define</span><span class="org-whitespace-space"> </span><span class="org-function-name">MSG</span>(<span class="org-variable-name">x</span>)<span class="org-whitespace-space"> </span>movw<span class="org-whitespace-space"> </span>$ABS(x),<span class="org-whitespace-space"> </span><span class="org-variable-name">%si</span><span class="org-comment-delimiter">;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="custom">XXX</span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">binutils-2.9.1.0.x</span><span class="org-whitespace-space"> </span><span class="org-comment">doesn't</span><span class="org-whitespace-space"> </span><span class="org-comment">produce</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">short</span><span class="org-whitespace-space"> </span><span class="org-comment">opcode</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">this.</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-preprocessor">#define</span><span class="org-whitespace-space"> </span><span class="org-function-name">MOV_MEM_TO_AL</span>(<span class="org-variable-name">x</span>)<span class="org-whitespace-space"> </span>.byte<span class="org-whitespace-space"> </span>0xa0<span class="org-comment-delimiter">;</span><span class="org-whitespace-space">  </span><span class="org-comment">.word</span><span class="org-whitespace-space"> </span><span class="org-comment">x</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">binutils-2.9.1.0.x&#19981;&#33021;&#29983;&#25104;short&#25805;&#20316;&#30721;,&#20351;&#29992;&#36825;&#20010;&#23439;&#20256;&#36882;x&#32473;AL</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">.file</span><span class="org-whitespace-space"> </span><span class="org-string">"boot.S"</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">.text</span>

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">Tell</span><span class="org-whitespace-space"> </span><span class="org-comment">GAS</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">generate</span><span class="org-whitespace-space"> </span><span class="org-comment">16-bit</span><span class="org-whitespace-space"> </span><span class="org-comment">instructions</span><span class="org-whitespace-space"> </span><span class="org-comment">so</span><span class="org-whitespace-space"> </span><span class="org-comment">that</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span><span class="org-whitespace-space"> </span><span class="org-comment">works</span>
<span class="org-whitespace-space">   </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">real</span><span class="org-whitespace-space"> </span><span class="org-comment">mode.</span>
<span class="org-comment">*/</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21578;&#30693;GAS&#29983;&#25104;16&#20301;&#30340;&#25351;&#20196;,&#20351;&#20197;&#19979;&#20195;&#30721;&#21487;&#20197;&#24037;&#20316;&#22312;&#23454;&#27169;&#24335;&#19979;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35828;&#26126;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">GAS&#26159;gcc&#30340;&#27719;&#32534;&#22120;</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">.code16</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20197;&#19979;&#20195;&#30721;&#34987;BIOS&#21551;&#21160;&#20363;&#31243;&#21152;&#36733;&#33267;0X7C00&#22788;&#24182;&#19988;&#36339;&#36716;&#21040;&#27492;&#22788;&#25191;&#34892;,&#36807;&#31243;&#25551;&#36848;&#22914;&#19979;:</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">(&#20026;&#38477;&#20302;&#20998;&#26512;&#22797;&#26434;&#24230;,&#25105;&#20204;&#20551;&#35774;&#20174;&#30828;&#30424;&#21551;&#21160;.)</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS&#35835;&#21462;&#30828;&#30424;&#30340;MBR&#25159;&#21306;&#20849;512&#23383;&#33410;,&#24182;&#25918;&#22312;&#22320;&#22336;0X0000:0X7C00&#22788;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#21040;0X0000:0X7C00&#22788;&#21435;&#25191;&#34892;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#26102;&#35774;&#32622;&#23492;&#23384;&#22120;&#22914;&#19979;:</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CS:IP</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0X0000:0X7C00</span><span class="org-whitespace-space"> </span><span class="org-comment">!&#21363;&#20195;&#30721;&#27573;&#22522;&#22336;&#20026;0,&#20559;&#31227;&#37327;&#20026;0X7C00</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:SI</span><span class="org-whitespace-space">   </span><span class="org-comment">!&#25351;&#21521;BIOS&#20013;&#30828;&#30424;&#20998;&#21306;&#34920;&#30340;&#22320;&#22336;.</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space">   </span><span class="org-comment">!&#24341;&#23548;&#35774;&#22791;number,00x80~0xFF</span>

<span class="org-keyword">.globl</span><span class="org-whitespace-space"> </span>_start<span class="org-comment-delimiter">;</span><span class="org-whitespace-space"> </span><span class="org-comment">_start:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">_start</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">loaded</span><span class="org-whitespace-space"> </span><span class="org-comment">at</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7c00</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">jumped</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">CS:IP</span><span class="org-whitespace-space"> </span><span class="org-comment">0:0x7c00</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Beginning</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">compatible</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">FAT/HPFS</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">parameter</span><span class="org-whitespace-space"> </span><span class="org-comment">block.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25159;&#21306;&#24320;&#22987;&#22788;&#21644;BIOS&#21442;&#25968;&#22359;&#37117;&#26159;FAT/HPFS&#26684;&#24335;&#20860;&#23481;&#30340;.</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#21040;after_BPB&#20869;&#23384;&#22788;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>after_BPB
<span class="org-whitespace-space"> </span><span class="org-keyword">nop</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">do</span><span class="org-whitespace-space"> </span><span class="org-comment">I</span><span class="org-whitespace-space"> </span><span class="org-comment">care</span><span class="org-whitespace-space"> </span><span class="org-comment">about</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">???</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">nop</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27704;&#36828;&#19981;&#20250;&#25191;&#34892;!</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">space</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">parameter</span><span class="org-whitespace-space"> </span><span class="org-comment">block!!!!</span><span class="org-whitespace-space">  </span><span class="org-comment">Don't</span><span class="org-whitespace-space"> </span><span class="org-comment">change</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">first</span><span class="org-whitespace-space"> </span><span class="org-comment">jump,</span><span class="org-whitespace-space"> </span><span class="org-comment">nor</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span><span class="org-whitespace-space"> </span><span class="org-comment">anywhere</span><span class="org-whitespace-space"> </span><span class="org-comment">but</span><span class="org-whitespace-space"> </span><span class="org-comment">right</span><span class="org-whitespace-space"> </span><span class="org-comment">after</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">area.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20197;&#19979;&#31354;&#38388;&#26159;&#30041;&#32473;BIOS&#21442;&#25968;&#22359;&#30340;!!!</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#19981;&#35201;&#26356;&#25913;&#36339;&#36716;&#25351;&#20196;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#38500;&#20102;&#24688;&#22312;BIOS&#21442;&#25968;&#22359;&#21518;&#30340;&#20301;&#32622;,&#20063;&#19981;&#35201;&#24320;&#22987;&#25191;&#34892;&#25351;&#20196;</span>

<span class="org-whitespace-space"> </span>.<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>_start<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>4
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20445;&#30041;&#31354;&#38388;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20351;&#26412;&#33410;&#20195;&#30721;&#21344;&#29992;&#30340;&#31354;&#38388;&#21040;_start+4&#22788;.&#22914;&#19979;&#20998;&#26512;:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">jmp</span><span class="org-whitespace-space"> </span><span class="org-comment">after_BPB</span><span class="org-whitespace-space">  </span><span class="org-comment">&#21344;&#29992;2&#23383;&#33410;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">nop</span><span class="org-whitespace-space">   </span><span class="org-comment">&#21344;&#29992;1&#23383;&#33410;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#27492;&#22810;&#20445;&#30041;&#19968;&#23383;&#33410;&#22320;&#22336;&#24182;&#20197;0&#22635;&#20805;.</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20107;&#23454;&#19978;,&#22312;&#29983;&#25104;&#30340;.img&#25991;&#20214;&#20013;,&#24320;&#22987;&#22788;&#22235;&#23383;&#33410;&#30340;&#26426;&#22120;&#30721;&#26159;:eb4b9000</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Address</span><span class="org-whitespace-space">  </span><span class="org-comment">0x7C00</span><span class="org-whitespace-space">  </span><span class="org-comment">0x7C01</span><span class="org-whitespace-space">  </span><span class="org-comment">0x7C02</span><span class="org-whitespace-space">  </span><span class="org-comment">0x7C03</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Value</span><span class="org-whitespace-space">  </span><span class="org-comment">eb</span><span class="org-whitespace-space">  </span><span class="org-comment">4b</span><span class="org-whitespace-space">  </span><span class="org-comment">90</span><span class="org-whitespace-space">  </span><span class="org-comment">00</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Operator</span><span class="org-whitespace-space"> </span><span class="org-comment">jmp</span><span class="org-whitespace-space">  </span><span class="org-comment">sfter_BPB</span><span class="org-whitespace-space"> </span><span class="org-comment">nop</span><span class="org-whitespace-space">  </span><span class="org-comment">00</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">scratch</span><span class="org-whitespace-space"> </span><span class="org-comment">space</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">&#20445;&#30041;&#30340;&#31354;&#38388;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">&#21344;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x00</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x03</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#30424;&#20449;&#24687;&#21442;&#25968;&#22359;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23547;&#22336;&#26041;&#24335;&#29992;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">11</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x04</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x0E</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#20381;&#27425;&#26159;&#36890;&#36807;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x08</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#24471;&#26469;&#30340;"&#25159;&#21306;/&#30913;&#22836;/&#26609;&#38754;"&#21442;&#25968;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23547;&#22336;&#26041;&#24335;&#29992;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">16</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x04</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x14</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#20250;&#36890;&#36807;&#27492;&#21518;&#25968;&#25454;&#22359;&#30340;&#20540;&#21644;&#35843;&#29992;&#35201;&#27714;&#22635;&#20805;&#30913;&#30424;&#21442;&#25968;&#22359;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#26102;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35832;&#22914;</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors/heads/cylinders</span><span class="org-whitespace-space"> </span><span class="org-comment">&#31561;&#26631;&#31614;&#26159;&#26080;&#29992;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20855;&#20307;&#21442;&#25968;&#26684;&#24335;&#35265;</span><span class="org-whitespace-space"> </span><span class="org-comment">lba_mode</span><span class="org-whitespace-space"> </span><span class="org-comment">&#19968;&#33410;&#23545;&#20195;&#30721;&#30340;&#27880;&#37322;</span>

<span class="org-function-name">mode</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.byte</span><span class="org-whitespace-space"> </span>0
<span class="org-function-name">disk_address_packet</span>:
<span class="org-function-name">sectors</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.long</span><span class="org-whitespace-space"> </span>0
<span class="org-function-name">heads</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.long</span><span class="org-whitespace-space"> </span>0
<span class="org-function-name">cylinders</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.word</span><span class="org-whitespace-space"> </span>0

<span class="org-function-name">sector_start</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.byte</span><span class="org-whitespace-space"> </span>0
<span class="org-function-name">head_start</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.byte</span><span class="org-whitespace-space"> </span>0
<span class="org-function-name">cylinder_start</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.word</span><span class="org-whitespace-space"> </span>0
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">more</span><span class="org-whitespace-space"> </span><span class="org-comment">space...</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span>.<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>_start<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_BPB_END
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">&#20445;&#30041;&#31354;&#38388;</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">End</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">parameter</span><span class="org-whitespace-space"> </span><span class="org-comment">block.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">BIOS&#21442;&#25968;&#22359;&#32467;&#26463;&#22320;&#22336;</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;,&#31354;&#38388;&#24050;&#32463;&#20998;&#37197;&#21040;&#20102;_start</span><span class="org-whitespace-space"> </span><span class="org-comment">+</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_BPB_END</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20854;&#20013;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25968;&#25454;&#31354;&#38388;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x04</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x12</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20445;&#30041;&#31354;&#38388;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x3D</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">grub&#33258;&#36523;&#20449;&#24687;&#20445;&#23384;&#22320;&#22336;:</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20849;</span><span class="org-whitespace-space"> </span><span class="org-comment">14</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">_start</span><span class="org-whitespace-space"> </span><span class="org-comment">+</span><span class="org-whitespace-space"> </span><span class="org-comment">0x3E</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start</span><span class="org-whitespace-space"> </span><span class="org-comment">+</span><span class="org-whitespace-space"> </span><span class="org-comment">0x4B</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">boot_version</span><span class="org-whitespace-space"> </span><span class="org-comment">!&#29256;&#26412;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_address</span><span class="org-whitespace-space"> </span><span class="org-comment">!&#20869;&#26680;&#21152;&#36733;&#22320;&#22336;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_segment</span><span class="org-whitespace-space"> </span><span class="org-comment">!&#20869;&#26680;&#21152;&#36733;&#27573;&#22320;&#22336;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">!&#25159;&#21306;&#32477;&#23545;&#22320;&#22336;,&#40664;&#35748;&#20026;0&#30913;&#22836;0&#26609;&#38754;1&#25159;&#21306;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">boot_drive</span><span class="org-whitespace-space"> </span><span class="org-comment">!&#20174;&#21738;&#20010;&#30913;&#30424;&#21152;&#36733;,0xff&#34920;&#31034;&#20351;&#29992;boot&#39537;&#21160;&#22120;&#21152;&#36733;</span>
<span class="org-function-name">boot_version</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.byte</span><span class="org-whitespace-space"> </span>GRUB_BOOT_VERSION_MAJOR,<span class="org-whitespace-space"> </span>GRUB_BOOT_VERSION_MINOR
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">4</span><span class="org-whitespace-space">   </span><span class="org-comment">0</span>
<span class="org-function-name">kernel_address</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.word</span><span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_KERNEL_ADDR
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">0x8000</span>
<span class="org-function-name">kernel_segment</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.word</span><span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_KERNEL_SEG
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">0x800</span>
<span class="org-function-name">kernel_sector</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.long</span><span class="org-whitespace-space"> </span>1,<span class="org-whitespace-space"> </span>0
<span class="org-function-name">boot_drive</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.byte</span><span class="org-whitespace-space"> </span>0xff<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">load</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel</span><span class="org-whitespace-space"> </span><span class="org-comment">from</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space">   </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0xff</span><span class="org-whitespace-space"> </span><span class="org-comment">means</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">boot</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-function-name">after_BPB</span>:

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">general</span><span class="org-whitespace-space"> </span><span class="org-comment">setup</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#39318;&#20808;&#23631;&#34109;&#25481;&#19968;&#20999;&#21487;&#23631;&#34109;&#30340;&#20013;&#26029;!</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">cli</span><span class="org-whitespace-space">  </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">we're</span><span class="org-whitespace-space"> </span><span class="org-comment">not</span><span class="org-whitespace-space"> </span><span class="org-comment">safe</span><span class="org-whitespace-space"> </span><span class="org-comment">here!</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">workaround</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">buggy</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOSes</span><span class="org-whitespace-space"> </span><span class="org-comment">which</span><span class="org-whitespace-space"> </span><span class="org-comment">don't</span><span class="org-whitespace-space"> </span><span class="org-comment">pass</span><span class="org-whitespace-space"> </span><span class="org-comment">boot</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">correctly.</span><span class="org-whitespace-space"> </span><span class="org-comment">If</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">installed</span><span class="org-whitespace-space"> </span><span class="org-comment">into</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">HDD,</span><span class="org-whitespace-space"> </span><span class="org-comment">check</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">masked</span><span class="org-whitespace-space"> </span><span class="org-comment">correctly.</span><span class="org-whitespace-space"> </span><span class="org-comment">If</span><span class="org-whitespace-space"> </span><span class="org-comment">not,</span><span class="org-whitespace-space"> </span><span class="org-comment">assume</span><span class="org-whitespace-space"> </span><span class="org-comment">that</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">passed</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">bogus</span><span class="org-whitespace-space"> </span><span class="org-comment">value</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">0x80,</span><span class="org-whitespace-space"> </span><span class="org-comment">since</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">only</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">possible</span><span class="org-whitespace-space"> </span><span class="org-comment">boot</span><span class="org-whitespace-space"> </span><span class="org-comment">drive.</span><span class="org-whitespace-space"> </span><span class="org-comment">If</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">installed</span><span class="org-whitespace-space"> </span><span class="org-comment">into</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy,</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">does</span><span class="org-whitespace-space"> </span><span class="org-comment">nothing</span><span class="org-whitespace-space"> </span><span class="org-comment">(only</span><span class="org-whitespace-space"> </span><span class="org-comment">jump).</span>
<span class="org-whitespace-space">         </span><span class="org-comment">*/</span>

<span class="org-function-name">boot_drive_check</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#33267;&#19979;&#19968;&#20010;1&#22788;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#22788;&#21363;&#24448;&#19979;&#31532;5&#34892;&#22788;</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">jmp</span><span class="org-whitespace-space">     </span>1f
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20197;&#19979;&#19977;&#34892;&#26377;&#20160;&#20040;&#20316;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">?</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25105;&#19981;&#26126;&#30333;</span><span class="org-whitespace-space"> </span><span class="org-comment">?</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20272;&#35745;&#26159;&#27531;&#30041;&#19979;&#26469;&#30340;&#19996;&#35199;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#19978;&#38754;&#33521;&#25991;&#27880;&#37322;&#35828;&#26159;&#20026;&#20102;&#20462;&#27491;&#24067;&#28385;</span><span class="org-whitespace-space"> </span><span class="org-comment">bug</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">testb</span><span class="org-whitespace-space">   </span>$0x80,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">jnz</span><span class="org-whitespace-space">     </span>1f
<span class="org-whitespace-space">        </span><span class="org-keyword">movb</span><span class="org-whitespace-space">    </span>$0x80,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>
<span class="org-function-name">1</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20351;</span><span class="org-whitespace-space"> </span><span class="org-comment">CS</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">IP</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C00</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">ljmp</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">next</span><span class="org-whitespace-space"> </span><span class="org-comment">instruction</span><span class="org-whitespace-space"> </span><span class="org-comment">because</span><span class="org-whitespace-space"> </span><span class="org-comment">some</span><span class="org-whitespace-space"> </span><span class="org-comment">bogus</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOSes</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">jump</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">07C0:0000</span><span class="org-whitespace-space"> </span><span class="org-comment">instead</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">0000:7C00.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">ljmp&#36339;&#36716;&#21040;$0,</span><span class="org-whitespace-space"> </span><span class="org-comment">$ABS(real_start)&#25351;&#23450;&#30340;&#32477;&#23545;&#20301;&#32622;&#25191;&#34892;&#25351;&#20196;</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#20026;&#19968;&#20123;&#31967;&#31957;&#30340;BIOS&#20351;&#29992;07C0:0000&#20195;&#26367;0000:7C00&#26469;&#23454;&#29616;&#36339;&#36716;</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">real_start</span><span class="org-whitespace-space"> </span><span class="org-comment">&#33410;&#30340;&#32477;&#23545;&#22320;&#22336;&#24182;&#25191;&#34892;&#37027;&#37324;&#30340;&#20195;&#30721;.</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">cs</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ip</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">$ABS(real_start)</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">ljmp</span><span class="org-whitespace-space"> </span>$0,<span class="org-whitespace-space"> </span>$ABS(real_start)

<span class="org-function-name">real_start</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">up</span><span class="org-whitespace-space"> </span><span class="org-comment">%ds</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">%ss</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">offset</span><span class="org-whitespace-space"> </span><span class="org-comment">from</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ax/ds/ss</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28165;&#38646;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ds</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ss</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ds</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">ss</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">up</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">REAL</span><span class="org-whitespace-space"> </span><span class="org-comment">stack</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_STACK_SEG</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#23439;&#23450;&#20041;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#31561;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x2000</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#23454;&#27169;&#24335;&#19979;&#30340;&#22534;&#26632;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#34920;&#31034;&#26632;&#39030;&#25351;&#38024;&#30340;&#21464;&#22336;&#23492;&#23384;&#22120;</span><span class="org-whitespace-space"> </span><span class="org-comment">sp</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x2000</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">ss</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">sp</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">0x2000</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_STACK_SEG,<span class="org-whitespace-space"> </span><span class="org-variable-name">%sp</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25968;&#25454;&#27573;&#22534;&#26632;&#27573;&#35774;&#32622;&#27491;&#30830;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20801;&#35768;&#20013;&#26029;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#26029;&#26631;&#24535;&#20301;IF&#32622;1</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">sti</span><span class="org-whitespace-space">  </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">we're</span><span class="org-whitespace-space"> </span><span class="org-comment">safe</span><span class="org-whitespace-space"> </span><span class="org-comment">again</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">Check</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">we</span><span class="org-whitespace-space"> </span><span class="org-comment">have</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">forced</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">reference</span><span class="org-whitespace-space"> </span><span class="org-comment">here</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;</span><span class="org-whitespace-space"> </span><span class="org-comment">boot_drive</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#30340;&#20540;&#23384;&#20648;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">address(boot_drive)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">_start+0x4B</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C00+0x4B</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C4B</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#22788;&#20540;&#40664;&#35748;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0xff</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21487;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">setup</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36807;&#31243;&#22635;&#20805;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#31561;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">0xff</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#20351;&#29992;&#40664;&#35748;&#39537;&#21160;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21363;&#20174;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20256;&#36882;&#36807;&#26469;&#30340;&#39537;&#21160;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#19981;&#31561;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21017;&#23558;&#20540;&#23384;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#20351;&#29992;&#30001;&#35813;&#20540;&#30830;&#23450;&#30340;&#24341;&#23548;&#39537;&#21160;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MOV_MEM_TO_AL</span>(ABS(boot_drive))<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">movb</span><span class="org-whitespace-space"> </span><span class="org-comment">ABS(boot_drive),</span><span class="org-whitespace-space"> </span><span class="org-comment">%al</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">cmpb</span><span class="org-whitespace-space"> </span>$0xff,<span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">je</span><span class="org-whitespace-space"> </span>1f
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>
<span class="org-function-name">1</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">reference</span><span class="org-whitespace-space"> </span><span class="org-comment">first</span><span class="org-whitespace-space"> </span><span class="org-comment">thing!</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">&#39537;&#21160;&#20449;&#24687;&#21387;&#26632;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">dl</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#20445;&#23384;&#39537;&#21160;number</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#20160;&#20040;&#37117;&#19981;&#26159;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">pushw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">print</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">notification</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">screen</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36755;&#20986;&#23383;&#31526;&#20018;</span><span class="org-whitespace-space"> </span><span class="org-comment">notification_string</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21040;&#23631;&#24149;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">notification_string</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">"GRUB"</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">MSG&#23439;&#32463;&#23637;&#24320;&#20197;&#21518;&#26159;&#36825;&#26679;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(notification_string-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20854;&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">$(notification_string-_start+0x7c00)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#23383;&#31526;&#20018;</span><span class="org-whitespace-space"> </span><span class="org-comment">notification_string</span><span class="org-whitespace-space"> </span><span class="org-comment">&#32477;&#23545;&#22320;&#22336;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25105;&#20204;&#30693;&#36947;</span><span class="org-whitespace-space"> </span><span class="org-comment">ds</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">si</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">address(notification_string)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#32780;&#22312;&#20989;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20250;&#36890;&#36807;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25552;&#20379;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x10</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#36880;&#23383;&#31526;&#26174;&#31034;&#21040;&#32456;&#31471;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20855;&#20307;&#35265;</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20989;&#25968;&#23450;&#20041;&#37096;&#20998;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27880;&#24847;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#26102;&#19981;&#38656;&#35201;&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">DF</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MSG</span>(notification_string)

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">%si</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">address</span><span class="org-whitespace-space"> </span><span class="org-comment">packet</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#21464;&#22336;&#23492;&#23384;&#22120;si&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">disk_address_packet</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#32477;&#23545;&#22320;&#22336;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23637;&#24320;&#20197;&#21518;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(disk_address_packet-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$ABS(disk_address_packet),<span class="org-whitespace-space"> </span><span class="org-variable-name">%si</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">do</span><span class="org-whitespace-space"> </span><span class="org-comment">not</span><span class="org-whitespace-space"> </span><span class="org-comment">probe</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#39537;&#21160;&#22120;&#26159;&#36719;&#30424;,&#21017;&#19981;&#21028;&#26029;&#26159;&#21542;&#26159;&#25903;&#25345;LBA&#30340;&#30913;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#32780;&#30452;&#25509;&#36339;&#36716;&#21040;chs_mod</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26681;&#25454;&#21069;&#38754;&#36164;&#26009;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25105;&#20204;&#30693;&#36947;&#30913;&#30424;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20540;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0X80~0XFF</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26368;&#39640;&#20301;&#24517;&#28982;&#20026;1</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_BIOS_HD_FLAG&#23439;&#23450;&#20041;</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x80</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#27492;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#26159;&#30913;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">ZF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21542;&#21017;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#36719;&#30424;&#24341;&#23548;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">ZF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">testb</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_BIOS_HD_FLAG,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jz</span><span class="org-whitespace-space"> </span>chs_mode

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">check</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">supported</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24050;&#32463;&#30830;&#23450;&#26159;&#30913;&#30424;&#24341;&#23548;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21028;&#26029;&#26159;&#21482;&#25903;&#25345;</span><span class="org-whitespace-space"> </span><span class="org-comment">8G</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23547;&#22336;&#30340;&#32769;&#24335;&#30340;&#30913;&#30424;&#36824;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#30424;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36890;&#36807;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26469;&#30830;&#23450;&#26159;&#21542;&#25903;&#25345;&#25193;&#23637;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35814;&#32454;&#35265;&#20855;&#20307;&#20195;&#30721;&#37096;&#20998;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25193;&#23637;&#21151;&#33021;&#20998;&#20004;&#20010;&#23376;&#38598;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">&#31532;&#19968;&#20010;&#23376;&#38598;&#25552;&#20379;&#20102;&#35775;&#38382;&#22823;&#30828;&#30424;&#25152;&#24517;&#39035;&#30340;&#21151;&#33021;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21253;&#25324;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">1.&#26816;&#26597;&#25193;&#23637;&#26159;&#21542;&#23384;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">41h</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">bx</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x55aa</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">dl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive(</span><span class="org-whitespace-space"> </span><span class="org-comment">0x80</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">0xff</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">2.&#25193;&#23637;&#35835;</span><span class="org-whitespace-space">  </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">42h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">3.&#25193;&#23637;&#20889;</span><span class="org-whitespace-space">  </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">43h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">4.&#26657;&#39564;&#25159;&#21306;</span><span class="org-whitespace-space">  </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">44h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">5.&#25193;&#23637;&#23450;&#20301;</span><span class="org-whitespace-space">  </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">47h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">6.&#21462;&#24471;&#39537;&#21160;&#22120;&#21442;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">48h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">&#31532;&#20108;&#20010;&#23376;&#38598;&#25552;&#20379;&#20102;&#23545;&#36719;&#20214;&#25511;&#21046;&#39537;&#21160;&#22120;&#38145;&#23450;&#21644;&#24377;&#20986;&#30340;&#25903;&#25345;</span><span class="org-whitespace-space"> </span><span class="org-comment">,&#21253;&#25324;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">1.&#26816;&#26597;&#25193;&#23637;</span><span class="org-whitespace-space">  </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">41h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">2.&#38145;&#23450;/&#35299;&#38145;&#39537;&#21160;&#22120;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">45h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">3.&#24377;&#20986;&#39537;&#21160;&#22120;</span><span class="org-whitespace-space">  </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">46h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">4.&#21462;&#24471;&#39537;&#21160;&#22120;&#21442;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">48h</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">5.&#21462;&#24471;&#25193;&#23637;&#39537;&#21160;&#22120;&#25913;&#21464;&#29366;&#24577;:</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">49h</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">&#19979;&#38754;&#24320;&#22987;&#20855;&#20307;&#26816;&#27979;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#39318;&#20808;&#26816;&#27979;&#25193;&#23637;&#26159;&#21542;&#23384;&#22312;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#26102;&#23492;&#23384;&#22120;&#30340;&#20540;&#21644;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#20998;&#21035;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x41</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">BX</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x55AA</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">driver(</span><span class="org-whitespace-space"> </span><span class="org-comment">0x80</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">0xFF</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space">  </span><span class="org-comment">13H</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36820;&#22238;&#32467;&#26524;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#25903;&#25345;</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21542;&#21017;</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">(&#25903;&#25345;LBA)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26102;&#30340;&#23492;&#23384;&#22120;&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25193;&#23637;&#21151;&#33021;&#30340;&#20027;&#29256;&#26412;&#21495;(</span><span class="org-whitespace-space"> </span><span class="org-comment">major</span><span class="org-whitespace-space"> </span><span class="org-comment">version</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">extensions</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20869;&#37096;&#20351;&#29992;(</span><span class="org-whitespace-space"> </span><span class="org-comment">internal</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">bx</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">AA55h</span><span class="org-whitespace-space"> </span><span class="org-comment">(</span><span class="org-whitespace-space"> </span><span class="org-comment">magic</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">cx</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">Bits</span><span class="org-whitespace-space">  </span><span class="org-comment">Description</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">0</span><span class="org-whitespace-space">  </span><span class="org-comment">extended</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">access</span><span class="org-whitespace-space"> </span><span class="org-comment">functions</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">1</span><span class="org-whitespace-space">  </span><span class="org-comment">removable</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">controller</span><span class="org-whitespace-space"> </span><span class="org-comment">functions</span><span class="org-whitespace-space"> </span><span class="org-comment">supported</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">2</span><span class="org-whitespace-space">  </span><span class="org-comment">enhanced</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">(EDD)</span><span class="org-whitespace-space"> </span><span class="org-comment">functions</span><span class="org-whitespace-space"> </span><span class="org-comment">(AH=48h,AH=4Eh)</span><span class="org-whitespace-space"> </span><span class="org-comment">supported.</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">    </span><span class="org-comment">Extended</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">parameter</span><span class="org-whitespace-space"> </span><span class="org-comment">table</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">valid</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space">  </span><span class="org-comment">3~15</span><span class="org-whitespace-space">  </span><span class="org-comment">reserved</span><span class="org-whitespace-space"> </span><span class="org-comment">(0)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">(&#19981;&#25903;&#25345;LBA)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26102;&#30340;&#23492;&#23384;&#22120;&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x01</span><span class="org-whitespace-space"> </span><span class="org-comment">(</span><span class="org-whitespace-space"> </span><span class="org-comment">invalid</span><span class="org-whitespace-space"> </span><span class="org-comment">function</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$0x41,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ah</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$0x55aa,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x13

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">%dl</span><span class="org-whitespace-space"> </span><span class="org-comment">may</span><span class="org-whitespace-space"> </span><span class="org-comment">have</span><span class="org-whitespace-space"> </span><span class="org-comment">been</span><span class="org-whitespace-space"> </span><span class="org-comment">clobbered</span><span class="org-whitespace-space"> </span><span class="org-comment">by</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">13,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH=41H.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">happens,</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">example,</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">AST</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">1.04.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">dl</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21487;&#33021;&#24050;&#34987;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">13</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">41H</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">BX</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">55AAH</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#20462;&#25913;,&#37325;&#26032;&#25913;&#22238;!</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20363;&#22914;</span><span class="org-whitespace-space"> </span><span class="org-comment">AST</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">1.04</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;&#23384;&#22312;&#36825;&#31181;&#20462;&#25913;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">popw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">pushw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">fails</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#25193;&#23637;&#26816;&#27979;&#35843;&#29992;&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20998;&#21035;&#36890;&#36807;&#26816;&#27979;</span><span class="org-whitespace-space"> </span><span class="org-comment">CF/BX/CX</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30830;&#35748;&#26159;&#21542;&#25903;&#25345;</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26816;&#27979;</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#22833;&#36133;&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jc</span><span class="org-whitespace-space"> </span>chs_mode

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26816;&#27979;</span><span class="org-whitespace-space"> </span><span class="org-comment">BX</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#19981;&#31561;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">0xAA55</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">cmpw</span><span class="org-whitespace-space"> </span>$0xaa55,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jne</span><span class="org-whitespace-space"> </span>chs_mode

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#19981;&#25903;&#25345;&#25193;&#23637;&#31532;&#19968;&#23376;&#38598;(&#35265;&#19978;)</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">CX.bit0</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">andw</span><span class="org-whitespace-space"> </span>$1,<span class="org-whitespace-space"> </span><span class="org-variable-name">%cx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jz</span><span class="org-whitespace-space"> </span>chs_mode

<span class="org-function-name">lba_mode</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26412;&#33410;&#20195;&#30721;&#30340;&#21151;&#33021;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21152;&#36733;</span><span class="org-whitespace-space"> </span><span class="org-comment">bootdisk.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29983;&#25104;&#30340;&#26426;&#22120;&#30721;&#21040;&#32477;&#23545;&#22320;&#22336;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24182;&#36339;&#36716;&#25191;&#34892;</span><span class="org-whitespace-space"> </span><span class="org-comment">copy_buffer</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;&#21040;&#36825;&#37324;&#26102;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24050;&#25506;&#27979;&#21040;&#31995;&#32479;&#25903;&#25345;</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25193;&#23637;&#30340;&#31532;&#19968;&#23376;&#38598;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#19979;&#38754;&#39318;&#20808;&#20026;&#25193;&#23637;&#35835;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#35774;&#32622;&#21442;&#25968;&#22359;&#20540;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20851;&#20110;&#25193;&#23637;&#35835;&#35843;&#29992;&#30340;&#35814;&#32454;&#24773;&#20917;&#21644;&#32467;&#26524;&#20540;&#35265;&#35843;&#29992;&#37096;&#20998;&#27880;&#37322;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25193;&#23637;&#35835;&#38656;&#35201;&#30340;&#30913;&#30424;&#21442;&#25968;&#22359;&#35828;&#26126;&#22914;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#30424;&#21442;&#25968;&#22359;&#30340;&#35268;&#23450;&#26684;&#24335;&#22914;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Format</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">address</span><span class="org-whitespace-space"> </span><span class="org-comment">packet:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Offset</span><span class="org-whitespace-space"> </span><span class="org-comment">Size</span><span class="org-whitespace-space"> </span><span class="org-comment">Bits</span><span class="org-whitespace-space"> </span><span class="org-comment">Description</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">00h</span><span class="org-whitespace-space"> </span><span class="org-comment">BYTE</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">size</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">packet</span><span class="org-whitespace-space"> </span><span class="org-comment">(10h</span><span class="org-whitespace-space"> </span><span class="org-comment">or</span><span class="org-whitespace-space"> </span><span class="org-comment">18h)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">01h</span><span class="org-whitespace-space"> </span><span class="org-comment">BYTE</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">reserved</span><span class="org-whitespace-space"> </span><span class="org-comment">(0)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">02h</span><span class="org-whitespace-space"> </span><span class="org-comment">WORD</span><span class="org-whitespace-space"> </span><span class="org-comment">16</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">blocks</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">transfer</span><span class="org-whitespace-space"> </span><span class="org-comment">(max</span><span class="org-whitespace-space"> </span><span class="org-comment">007Fh</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">Phoenix</span><span class="org-whitespace-space"> </span><span class="org-comment">EDD)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">04h</span><span class="org-whitespace-space"> </span><span class="org-comment">DWORD</span><span class="org-whitespace-space"> </span><span class="org-comment">32</span><span class="org-whitespace-space"> </span><span class="org-comment">-&gt;</span><span class="org-whitespace-space"> </span><span class="org-comment">transfer</span><span class="org-whitespace-space"> </span><span class="org-comment">buffer</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">08h</span><span class="org-whitespace-space"> </span><span class="org-comment">QWORD</span><span class="org-whitespace-space"> </span><span class="org-comment">64</span><span class="org-whitespace-space"> </span><span class="org-comment">starting</span><span class="org-whitespace-space"> </span><span class="org-comment">absolute</span><span class="org-whitespace-space"> </span><span class="org-comment">block</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25105;&#20204;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">ds</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">si</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">$ABS(disk_address_packet)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25105;&#20204;&#21462;&#25193;&#23637;&#35835;&#30913;&#30424;&#21442;&#25968;&#22359;&#30340;&#22320;&#22336;&#26631;&#21495;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x00)</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x0F)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20849;</span><span class="org-whitespace-space"> </span><span class="org-comment">16</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23545;&#20110;&#21508;&#20010;&#20540;&#30340;&#35774;&#32622;&#35265;&#19979;&#38754;&#20195;&#30721;</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span>4(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x04)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x05)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#37324;&#38754;&#20250;&#29992;&#21040;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25193;&#23637;&#35835;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23547;&#22336;&#35835;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">incw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">non-zero</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">-1(%si)&#21363;&#20026;mode&#25152;&#22312;&#22788;&#22320;&#22336;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#26102;</span><span class="org-whitespace-space"> </span><span class="org-comment">AX</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0001</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x01</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>,<span class="org-whitespace-space"> </span>-1(<span class="org-variable-name">%si</span>)

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">blocks</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span>2(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x02)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x01</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x03)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">size</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">reserved</span><span class="org-whitespace-space"> </span><span class="org-comment">byte</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$0x0010,<span class="org-whitespace-space"> </span>(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x00)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x10</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x01)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">absolute</span><span class="org-whitespace-space"> </span><span class="org-comment">address</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;(kernel_sector~kernel_sector+3)&#21333;&#20803;(&#32477;&#23545;&#22320;&#22336;)&#30340;&#20540;&#32473;</span><span class="org-whitespace-space"> </span><span class="org-comment">ebx</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#40664;&#35748;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">grub-mkimage</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21629;&#20196;&#20013;&#34987;&#20462;&#25913;</span><span class="org-whitespace-space"> </span><span class="org-comment">,&#23384;&#20648;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29983;&#25104;&#20195;&#30721;&#30340;&#23384;&#20648;&#25159;&#21306;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span>ABS(kernel_sector),<span class="org-whitespace-space"> </span><span class="org-variable-name">%ebx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ebx</span>,<span class="org-whitespace-space"> </span>8(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x08~0x0B)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">0001</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;(kernel_sector+4~kernel_sector+7)&#21333;&#20803;(&#32477;&#23545;&#22320;&#22336;)&#30340;&#20540;&#32473;</span><span class="org-whitespace-space"> </span><span class="org-comment">ebx</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#40664;&#35748;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span>ABS(kernel_sector<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>4),<span class="org-whitespace-space"> </span><span class="org-variable-name">%ebx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ebx</span>,<span class="org-whitespace-space"> </span>12(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x0C~0x0F)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">0000</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">segment</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">buffer</span><span class="org-whitespace-space"> </span><span class="org-comment">address</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_BUFFER_SEG</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23450;&#20041;</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_BUFFER_SEG,<span class="org-whitespace-space"> </span>6(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR_LBA_BPB(0x06~0x07)</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23545;&#24212;&#22914;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Offset</span><span class="org-whitespace-space">  </span><span class="org-comment">Size/Bits</span><span class="org-whitespace-space">  </span><span class="org-comment">Value</span><span class="org-whitespace-space">  </span><span class="org-comment">Description</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">00h</span><span class="org-whitespace-space">  </span><span class="org-comment">BYTE/8</span><span class="org-whitespace-space">   </span><span class="org-comment">0x10</span><span class="org-whitespace-space">  </span><span class="org-comment">size</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">packet</span><span class="org-whitespace-space"> </span><span class="org-comment">(10h</span><span class="org-whitespace-space"> </span><span class="org-comment">or</span><span class="org-whitespace-space"> </span><span class="org-comment">18h)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">01h</span><span class="org-whitespace-space">  </span><span class="org-comment">BYTE/8</span><span class="org-whitespace-space">   </span><span class="org-comment">0x00</span><span class="org-whitespace-space">  </span><span class="org-comment">reserved</span><span class="org-whitespace-space"> </span><span class="org-comment">(0)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">02h</span><span class="org-whitespace-space">  </span><span class="org-comment">WORD/16</span><span class="org-whitespace-space">   </span><span class="org-comment">0x0001</span><span class="org-whitespace-space">  </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">blocks</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">transfer</span><span class="org-whitespace-space"> </span><span class="org-comment">(max</span><span class="org-whitespace-space"> </span><span class="org-comment">007Fh</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">Phoenix</span><span class="org-whitespace-space"> </span><span class="org-comment">E</span><span class="org-comment"><span class="org-whitespace-line">DD)</span></span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">04h</span><span class="org-whitespace-space">  </span><span class="org-comment">DWORD/32</span><span class="org-whitespace-space">  </span><span class="org-comment">0x70000000</span><span class="org-whitespace-space"> </span><span class="org-comment">-&gt;</span><span class="org-whitespace-space"> </span><span class="org-comment">transfer</span><span class="org-whitespace-space"> </span><span class="org-comment">buffer</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">08h</span><span class="org-whitespace-space">  </span><span class="org-comment">QWORD/64</span><span class="org-whitespace-space">  </span><span class="org-comment">0x01</span><span class="org-whitespace-space">  </span><span class="org-comment">starting</span><span class="org-whitespace-space"> </span><span class="org-comment">absolute</span><span class="org-whitespace-space"> </span><span class="org-comment">block</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">"INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">Function</span><span class="org-whitespace-space"> </span><span class="org-comment">0x42"</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">read</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">from</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">into</span><span class="org-whitespace-space"> </span><span class="org-comment">memory</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Call</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">%ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x42</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%dl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%ds:%si</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">segment:offset</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">address</span><span class="org-whitespace-space"> </span><span class="org-comment">packet</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Return:</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%al</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">success;</span><span class="org-whitespace-space"> </span><span class="org-comment">err</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">failure</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$0x42,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ah</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#21644;&#30913;&#30424;&#21442;&#25968;&#22359;&#35774;&#32622;&#23436;&#27605;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x42</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">driver</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">DS</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">SI</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">ABS(disk_address_</span><span class="org-comment"><span class="org-whitespace-line">packet)</span></span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">disk_address_packet</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21508;&#20010;&#20540;&#35265;&#19978;&#38754;&#27880;&#37322;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36825;&#27425;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#23558;&#23436;&#25104;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36890;&#36807;&#25193;&#23637;&#35835;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20174;&#30913;&#30424;&#35835;&#21462;&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;8&#23383;&#33410;&#38271;&#24230;&#30830;&#23450;&#30340;&#26576;&#19968;&#25159;&#21306;&#30340;&#20869;&#23481;&#21040;&#20869;&#23384;&#22320;&#22336;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x70000(0x7000:0x0000)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25104;&#21151;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">&#38169;&#35823;&#30721;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#32467;&#26463;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#30424;&#22320;&#22336;&#22359;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">block</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35745;&#25968;&#39033;</span><span class="org-whitespace-space"> </span><span class="org-comment">(ADDR_LBA_BPB(0x02))</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#25104;&#21151;&#25104;&#21151;&#20256;&#36865;&#30340;&#25968;&#25454;&#22359;&#25968;.</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x13

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA&#25193;&#23637;&#35835;&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">read</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">not</span><span class="org-whitespace-space"> </span><span class="org-comment">supported,</span><span class="org-whitespace-space"> </span><span class="org-comment">so</span><span class="org-whitespace-space"> </span><span class="org-comment">fallback</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS.</span><span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jc</span><span class="org-whitespace-space"> </span>chs_mode

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#20648;</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_BUFFER_SEG</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">bx</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">copy_buffer</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_BUFFER_SEG</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25968;&#25454;&#23492;&#23384;&#22120;</span><span class="org-whitespace-space"> </span><span class="org-comment">BX</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_BUFFER_SEG,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>copy_buffer

<span class="org-function-name">chs_mode</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;&#27492;&#22788;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24050;&#32463;&#21028;&#23450;&#26159;&#19981;&#25903;&#25345;&#30913;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25193;&#23637;&#20102;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20294;&#26159;&#20174;&#30913;&#30424;&#24341;&#23548;&#36824;&#26159;&#36719;&#30424;&#24341;&#23548;&#23578;&#26410;&#30830;&#23450;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#27492;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS&#30913;&#30424;&#24341;&#23548;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25110;&#32773;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36719;&#30424;&#24341;&#23548;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22343;&#20174;&#27492;&#22788;&#22788;&#29702;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">Determine</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">geometry</span><span class="org-whitespace-space"> </span><span class="org-comment">from</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS!</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">We</span><span class="org-whitespace-space"> </span><span class="org-comment">do</span><span class="org-whitespace-space"> </span><span class="org-comment">this</span><span class="org-whitespace-space"> </span><span class="org-comment">first,</span><span class="org-whitespace-space"> </span><span class="org-comment">so</span><span class="org-whitespace-space"> </span><span class="org-comment">that</span><span class="org-whitespace-space"> </span><span class="org-comment">LS-120</span><span class="org-whitespace-space"> </span><span class="org-comment">IDE</span><span class="org-whitespace-space"> </span><span class="org-comment">floppies</span><span class="org-whitespace-space"> </span><span class="org-comment">work</span><span class="org-whitespace-space"> </span><span class="org-comment">correctly.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36890;&#36807;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x08</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#27979;&#23450;&#30913;&#30424;&#30340;&#29289;&#29702;&#21442;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35813;&#30340;&#35814;&#32454;&#35299;&#37322;&#22914;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20316;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21462;&#24471;&#30913;&#30424;&#21442;&#25968;</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x08</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">(bit</span><span class="org-whitespace-space"> </span><span class="org-comment">7</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">disk)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:DI</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">guard</span><span class="org-whitespace-space"> </span><span class="org-comment">against</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">bugs</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25104;&#21151;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">00h</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">00h</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">at</span><span class="org-whitespace-space"> </span><span class="org-comment">least</span><span class="org-whitespace-space"> </span><span class="org-comment">some</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOSes</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">BL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">type</span><span class="org-whitespace-space"> </span><span class="org-comment">(AT/PS2</span><span class="org-whitespace-space"> </span><span class="org-comment">floppies</span><span class="org-whitespace-space"> </span><span class="org-comment">only)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">low</span><span class="org-whitespace-space"> </span><span class="org-comment">eight</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">maximum</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">maximum</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">(bits</span><span class="org-whitespace-space"> </span><span class="org-comment">5-0)</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">high</span><span class="org-whitespace-space"> </span><span class="org-comment">two</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">maximum</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">nu</span><span class="org-comment"><span class="org-whitespace-line">mber</span></span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">(bits</span></span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">7-6)</span></span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">DH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">maximum</span><span class="org-whitespace-space"> </span><span class="org-comment">head</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">drives</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:DI</span><span class="org-whitespace-space"> </span><span class="org-comment">-&gt;</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">parameter</span><span class="org-whitespace-space"> </span><span class="org-comment">table</span><span class="org-whitespace-space"> </span><span class="org-comment">(floppies</span><span class="org-whitespace-space"> </span><span class="org-comment">only)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">status</span><span class="org-whitespace-space"> </span><span class="org-comment">(07h)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$8,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ah</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x13
<span class="org-whitespace-space"> </span><span class="org-keyword">jnc</span><span class="org-whitespace-space"> </span>final_init
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#35843;&#29992;&#25104;&#21151;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">final_init</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;!</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;&#24050;&#32463;&#30830;&#23450;&#19981;&#25903;&#25345;</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27979;&#35797;&#26159;&#21542;&#26159;&#36719;&#30424;&#24341;&#23548;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#26159;&#36719;&#30424;&#24341;&#23548;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy_probe</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21542;&#21017;&#20986;&#38169;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">hd_probe_error</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">The</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">failed,</span><span class="org-whitespace-space"> </span><span class="org-comment">so</span><span class="org-whitespace-space"> </span><span class="org-comment">maybe</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy</span><span class="org-whitespace-space"> </span><span class="org-comment">probe</span><span class="org-whitespace-space"> </span><span class="org-comment">instead.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26368;&#39640;&#20301;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,&#21017;&#20026;&#36719;&#30424;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">testb</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_BIOS_HD_FLAG,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#26159;&#36719;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy_probe</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jz</span><span class="org-whitespace-space"> </span>floppy_probe

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30693;&#36947;&#25105;&#20204;&#30830;&#23454;&#26159;&#19968;&#20010;&#30913;&#30424;(&#30828;&#30424;)</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20294;&#26159;&#23454;&#22312;&#19981;&#30693;&#36947;&#35813;&#24590;&#20040;&#35835;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21435;</span><span class="org-whitespace-space"> </span><span class="org-comment">hd_probe_error</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29609;&#29609;&#21543;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">Nope,</span><span class="org-whitespace-space"> </span><span class="org-comment">we</span><span class="org-whitespace-space"> </span><span class="org-comment">definitely</span><span class="org-whitespace-space"> </span><span class="org-comment">have</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">disk,</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">we're</span><span class="org-whitespace-space"> </span><span class="org-comment">screwed.</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>hd_probe_error

<span class="org-function-name">final_init</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#29992;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29992;&#26469;&#21028;&#26029;&#24341;&#23548;&#30913;&#30424;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35835;&#36824;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35835;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">zero</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">DH</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#30913;&#22836;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36825;&#21477;&#23436;&#25104;&#20102;2&#20010;&#21151;&#33021;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">eax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">eax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#20854;&#23427;&#20301;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movzbl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dh</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ah</span>,<span class="org-whitespace-space"> </span>-1(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20445;&#23384;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#22836;/&#26609;&#38754;/&#25159;&#21306;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">heads</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#30913;&#22836;&#32534;&#21495;&#26159;&#25353;&#29031;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">n-1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#22788;&#21152;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24182;&#20445;&#23384;&#21040;&#30913;&#30424;&#21442;&#25968;&#22359;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">incw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>,<span class="org-whitespace-space"> </span>4(<span class="org-variable-name">%si</span>)

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">cl</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">0~5</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#25159;&#21306;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">6~7</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#26609;&#38754;&#25968;&#30340;&#39640;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movzbw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%cl</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">shlw</span><span class="org-whitespace-space"> </span>$2,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26609;&#38754;&#25968;&#30340;&#20302;</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ch</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;&#26159;&#30913;&#22836;&#25968;&#30340;&#39640;&#20004;&#20301;!</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dh</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ah</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#26609;&#38754;&#25968;&#30340;&#39640;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#26609;&#38754;&#25968;&#30340;&#20302;</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#25972;&#20010;&#26609;&#38754;&#21442;&#25968;</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinders</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#26609;&#38754;&#32534;&#21495;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">n-1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#22788;&#21152;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24182;&#20445;&#23384;&#21040;&#30913;&#30424;&#21442;&#25968;&#22359;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">incw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span>8(<span class="org-variable-name">%si</span>)

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">dl</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">0~2bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;0</span><span class="org-whitespace-space">  </span><span class="org-comment">,5~7bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#25159;&#21306;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movzbw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">shrb</span><span class="org-whitespace-space"> </span>$2,<span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21491;&#31227;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">0~5</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#25159;&#21306;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">6~7</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#25159;&#21306;&#32534;&#21495;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">n</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30452;&#25509;&#20445;&#23384;&#21040;&#30913;&#30424;&#21442;&#25968;&#22359;!</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>,<span class="org-whitespace-space"> </span>(<span class="org-variable-name">%si</span>)

<span class="org-function-name">setup_sectors</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20351;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27169;&#24335;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25552;&#20379;&#30340;&#35835;&#35843;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21152;&#36733;&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30830;&#23450;&#30340;&#19968;&#20010;&#25159;&#21306;&#21040;&#20869;&#23384;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x70000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">load</span><span class="org-whitespace-space"> </span><span class="org-comment">logical</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">(top</span><span class="org-whitespace-space"> </span><span class="org-comment">half)</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">+</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#20648;&#20869;&#23384;&#20559;&#31227;&#37327;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35835;&#20013;&#24517;&#39035;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21542;&#21017;&#20986;&#38169;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span>ABS(kernel_sector<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>4),<span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">orl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;</span><span class="org-whitespace-space"> </span><span class="org-comment">eax</span><span class="org-whitespace-space"> </span><span class="org-comment">!=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">0000</span><span class="org-whitespace-space"> </span><span class="org-comment">0000</span><span class="org-whitespace-space"> </span><span class="org-comment">0000</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21017;&#26080;&#27861;&#24341;&#23548;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;</span><span class="org-whitespace-space"> </span><span class="org-comment">geometry_error</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#29702;</span><span class="org-whitespace-space"> </span><span class="org-comment">!</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jnz</span><span class="org-whitespace-space"> </span>geometry_error

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">load</span><span class="org-whitespace-space"> </span><span class="org-comment">logical</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">(bottom</span><span class="org-whitespace-space"> </span><span class="org-comment">half)</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#20540;&#40664;&#35748;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">grub-mkimage</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21629;&#20196;&#20013;&#35774;&#32622;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.img(diskboot.S&#29983;&#25104;)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#20648;&#30340;</span><span class="org-comment"><span class="org-whitespace-line">&#25159;&#21306;&#21495;</span></span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movl</span><span class="org-whitespace-space"> </span>ABS(kernel_sector),<span class="org-whitespace-space"> </span><span class="org-variable-name">%eax</span>


<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20197;&#19979;&#36890;&#36807;&#38500;&#27861;&#36816;&#31639;&#30340;&#21830;&#21644;&#20313;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35745;&#31639;&#24341;&#23548;&#25159;&#21306;&#25152;&#22312;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#22836;/&#26609;&#38754;/&#25159;&#21306;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">eax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;&#23384;&#20648;&#30340;&#26159;&#24341;&#23548;&#25159;&#21306;&#32534;&#21495;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">zero</span><span class="org-whitespace-space"> </span><span class="org-comment">%edx</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">xorl</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%edx</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%edx</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">divide</span><span class="org-whitespace-space"> </span><span class="org-comment">by</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">(%si)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#23384;&#25918;&#25159;&#21306;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">divl</span><span class="org-whitespace-space"> </span>(<span class="org-variable-name">%si</span>)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">(%si)&#20013;&#23384;&#25918;sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">(%si)/%eax</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">eax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors/eax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#21830;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21462;&#40664;&#35748;&#20540;&#26102;&#31561;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">edx</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#29616;&#22312;&#26159;&#20313;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20026;&#40664;&#35748;&#26102;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">edx</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#20648;&#36215;&#22987;&#25159;&#21306;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#20026;&#25159;&#21306;&#32534;&#21495;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">1~n</span><span class="org-whitespace-space"> </span><span class="org-comment">,&#38656;&#35201;</span><span class="org-whitespace-space"> </span><span class="org-comment">cl+=1(&#35265;&#21518;&#38754;&#25805;&#20316;)</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%cl</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">zero</span><span class="org-whitespace-space"> </span><span class="org-comment">%edx</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">divl</span><span class="org-whitespace-space"> </span>4(<span class="org-variable-name">%si</span>)<span class="org-whitespace-space">  </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">divide</span><span class="org-whitespace-space"> </span><span class="org-comment">by</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">heads</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">4(%si)</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#30913;&#22836;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#22836;&#25968;&#38500;&#20197;&#25159;&#21306;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">eax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#23384;&#25918;&#26609;&#38754;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">edx</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23384;&#25918;&#20313;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#36215;&#22987;&#30913;&#22836;</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">do</span><span class="org-whitespace-space"> </span><span class="org-comment">we</span><span class="org-whitespace-space"> </span><span class="org-comment">need</span><span class="org-whitespace-space"> </span><span class="org-comment">too</span><span class="org-whitespace-space"> </span><span class="org-comment">many</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinders?</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">8(%si)&#26159;&#26609;&#38754;&#25968;</span><span class="org-whitespace-space">  </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;</span><span class="org-whitespace-space"> </span><span class="org-comment">ax</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#25968;&#20540;&#22823;&#20110;&#26609;&#38754;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#36229;&#20986;&#33539;&#22260;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">geometry_error</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#29702;!</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">cmpw</span><span class="org-whitespace-space"> </span>8(<span class="org-variable-name">%si</span>),<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jge</span><span class="org-whitespace-space"> </span>geometry_error

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">normalize</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">(1-based)</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25159;&#21306;</span><span class="org-whitespace-space"> </span><span class="org-comment">+=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#20026;&#25159;&#21306;&#32534;&#21495;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">1~n</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">incb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%cl</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">low</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#26609;&#38754;&#30340;&#20302;</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ch</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">high</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#26609;&#38754;&#30340;&#39640;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25805;&#20316;&#20043;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">cl</span><span class="org-whitespace-space"> </span><span class="org-comment">&#39640;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;&#23384;&#20648;&#26609;&#38754;&#30340;&#39640;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">xorb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">shrw</span><span class="org-whitespace-space"> </span>$2,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">orb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%cl</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20445;&#23384;&#36215;&#22987;&#30913;&#22836;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">head</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dl</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#37325;&#26032;&#35774;&#32622;DL&#20026;&#24341;&#23548;&#39537;&#21160;&#22120;&#32534;&#21495;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">restore</span><span class="org-whitespace-space"> </span><span class="org-comment">%dl</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">popw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%dx</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">head</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#29616;&#22312;&#26159;&#36215;&#22987;&#30913;&#22836;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dh</span>

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">"INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">Function</span><span class="org-whitespace-space"> </span><span class="org-comment">0x2"</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">read</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">from</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">into</span><span class="org-whitespace-space"> </span><span class="org-comment">memory</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Call</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">%ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x2</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%al</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%ch</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%cl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">(bits</span><span class="org-whitespace-space"> </span><span class="org-comment">6-7</span><span class="org-whitespace-space"> </span><span class="org-comment">are</span><span class="org-whitespace-space"> </span><span class="org-comment">high</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">"cylinder")</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%dh</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">head</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%dl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">(0x80</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">disk,</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy</span><span class="org-whitespace-space"> </span><span class="org-comment">disk)</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%es:%bx</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">segment:offset</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">buffer</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Return:</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">%al</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">success;</span><span class="org-whitespace-space"> </span><span class="org-comment">err</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">failure</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x02</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">read</span><span class="org-whitespace-space"> </span><span class="org-comment">(must</span><span class="org-whitespace-space"> </span><span class="org-comment">be</span><span class="org-whitespace-space"> </span><span class="org-comment">nonzero)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">low</span><span class="org-whitespace-space"> </span><span class="org-comment">eight</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">1-63</span><span class="org-whitespace-space"> </span><span class="org-comment">(bits</span><span class="org-whitespace-space"> </span><span class="org-comment">0-5),high</span><span class="org-whitespace-space"> </span><span class="org-comment">two</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">(bits</span><span class="org-whitespace-space"> </span><span class="org-comment">6-7,</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">disk</span></span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">only)</span></span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">DH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">head</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">(bit</span><span class="org-whitespace-space"> </span><span class="org-comment">7</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">disk)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:BX</span><span class="org-whitespace-space"> </span><span class="org-comment">-&gt;</span><span class="org-whitespace-space"> </span><span class="org-comment">data</span><span class="org-whitespace-space"> </span><span class="org-comment">buffer</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25104;&#21151;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">status</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">transferred</span><span class="org-whitespace-space"> </span><span class="org-comment">(only</span><span class="org-whitespace-space"> </span><span class="org-comment">valid</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">set</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">some</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOSes)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">BX</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">11h</span><span class="org-whitespace-space"> </span><span class="org-comment">(corrected</span><span class="org-whitespace-space"> </span><span class="org-comment">ECC</span><span class="org-whitespace-space"> </span><span class="org-comment">error),</span><span class="org-whitespace-space"> </span><span class="org-comment">AL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">burst</span><span class="org-whitespace-space"> </span><span class="org-comment">length</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#30913;&#30424;&#35835;&#21462;&#32531;&#20914;&#21306;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25805;&#20316;&#23436;&#27605;&#20043;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">bx</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">es</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_BUFFER_SEG,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%es</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">load</span><span class="org-whitespace-space"> </span><span class="org-comment">%es</span><span class="org-whitespace-space"> </span><span class="org-comment">segment</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">buffer</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">%bx</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0,</span><span class="org-whitespace-space"> </span><span class="org-comment">put</span><span class="org-whitespace-space"> </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">at</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">segment</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$0x0201,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">function</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27169;&#24335;&#35835;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#20540;&#24050;&#32463;&#35774;&#32622;&#22914;&#19979;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#21517;</span><span class="org-whitespace-space">  </span><span class="org-comment">&#20540;</span><span class="org-whitespace-space">  </span><span class="org-comment">&#24847;&#20041;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space">   </span><span class="org-comment">0x02</span><span class="org-whitespace-space">  </span><span class="org-comment">CHS&#27169;&#24335;&#35835;&#38656;&#35201;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">AL</span><span class="org-whitespace-space">   </span><span class="org-comment">0x01</span><span class="org-whitespace-space">  </span><span class="org-comment">&#38656;&#35201;&#35835;&#30340;&#25159;&#21306;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CH</span><span class="org-whitespace-space">   </span><span class="org-comment">&#24050;&#35774;&#32622;</span><span class="org-whitespace-space">  </span><span class="org-comment">&#26609;&#38754;&#25968;&#30340;&#20302;</span><span class="org-whitespace-space"> </span><span class="org-comment">8</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CL</span><span class="org-whitespace-space">   </span><span class="org-comment">&#24050;&#35774;&#32622;</span><span class="org-whitespace-space">  </span><span class="org-comment">0~5bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25159;&#21306;&#21495;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">bits</span><span class="org-whitespace-space"> </span><span class="org-comment">6-7bits</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26609;&#38754;&#30340;&#39640;</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20301;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">DH</span><span class="org-whitespace-space">   </span><span class="org-comment">&#24050;&#35774;&#32622;</span><span class="org-whitespace-space">  </span><span class="org-comment">&#30913;&#22836;&#25968;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space">   </span><span class="org-comment">&#24050;&#24674;&#22797;</span><span class="org-whitespace-space">  </span><span class="org-comment">&#39537;&#21160;&#21495;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:BX</span><span class="org-whitespace-space">   </span><span class="org-comment">0x7000:0x0000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25968;&#25454;&#32531;&#20914;&#21306;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20854;&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">CH/CL/DH</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20445;&#23384;&#36215;&#22987;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#22836;/&#26609;&#38754;/&#25159;&#21306;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#35774;&#32622;&#30340;&#20540;&#32463;&#36816;&#31639;&#24471;&#26469;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20854;&#20013;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">CH/CL/DH</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20445;&#23384;&#36215;&#22987;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#22836;/&#26609;&#38754;/&#25159;&#21306;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26159;&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20013;&#35774;&#32622;&#30340;&#20540;&#32463;&#36816;&#31639;&#24471;&#26469;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20855;&#20307;&#35265;&#19978;&#38754;&#36816;&#31639;&#36807;&#31243;</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x13

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35835;&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;</span><span class="org-whitespace-space"> </span><span class="org-comment">read_error</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jc</span><span class="org-whitespace-space"> </span>read_error

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">bx</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">copy_buffer</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29992;&#21040;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%es</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>

<span class="org-function-name">copy_buffer</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20197;&#19979;&#20195;&#30721;&#25226;&#36890;&#36807;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#35835;&#36827;&#26469;&#30340;&#19968;&#25159;&#21306;&#30340;&#25968;&#25454;&#31227;&#21160;&#21040;&#20869;&#23384;&#22320;&#22336;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>ABS(kernel_segment),<span class="org-whitespace-space"> </span><span class="org-variable-name">%es</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">es</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x800</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">We</span><span class="org-whitespace-space"> </span><span class="org-comment">need</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">save</span><span class="org-whitespace-space"> </span><span class="org-comment">%cx</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">%si</span><span class="org-whitespace-space"> </span><span class="org-comment">because</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">startup</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel</span><span class="org-whitespace-space"> </span><span class="org-comment">uses</span><span class="org-whitespace-space"> </span><span class="org-comment">them</span><span class="org-whitespace-space"> </span><span class="org-comment">without</span><span class="org-whitespace-space"> </span><span class="org-comment">initializing</span><span class="org-whitespace-space"> </span><span class="org-comment">them.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36825;&#37324;&#38656;&#35201;&#20445;&#23384;</span><span class="org-whitespace-space"> </span><span class="org-comment">cx</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21644;</span><span class="org-whitespace-space"> </span><span class="org-comment">si</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#20540;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#20026;&#20869;&#26680;</span><span class="org-whitespace-space"> </span><span class="org-comment">startup</span><span class="org-whitespace-space"> </span><span class="org-comment">&#37324;&#38754;&#30340;&#20195;&#30721;&#26410;&#32463;&#21021;&#22987;&#21270;&#23601;&#20351;&#29992;&#20102;&#23427;(</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20854;&#23454;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20195;&#30721;</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">pusha</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">pushw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ds</span>


<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#24490;&#29615;&#27425;&#25968;&#21644;&#28304;/&#30446;&#30340;&#20018;&#27573;&#23492;&#23384;&#22120;&#21644;&#20559;&#31227;&#25351;&#38024;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#23436;&#27605;&#20043;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CX</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x100</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:SI=0x800:0x0000</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">LBA&#35835;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">DS:SI</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000:0x0000</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS&#35835;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">DS:SI</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">?</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$0x100,<span class="org-whitespace-space"> </span><span class="org-variable-name">%cx</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">cx</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x100</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">256</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ds</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">ds</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%si</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%si</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">si</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%di</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%di</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">di</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">cld</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-comment">DF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">(&#26041;&#21521;&#26631;&#24535;)</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25805;&#20316;&#20018;&#30001;</span><span class="org-whitespace-space"> </span><span class="org-comment">DS:SI</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21644;</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:DI</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25351;&#23450;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;</span><span class="org-whitespace-space"> </span><span class="org-comment">DS:SI</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25351;&#21521;&#30340;&#23383;&#20256;&#36865;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">ES:DI</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25351;&#21521;&#30340;&#20869;&#23384;&#21333;&#20803;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">DF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#27492;</span><span class="org-whitespace-space"> </span><span class="org-comment">SI</span><span class="org-whitespace-space"> </span><span class="org-comment">+=</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">DI</span><span class="org-whitespace-space"> </span><span class="org-comment">+=</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">rep</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movsw</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;</span><span class="org-whitespace-space"> </span><span class="org-comment">ds:si</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#30340;&#36830;&#32493;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">512</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;&#25968;&#25454;&#25644;&#31227;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">es:di</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22320;&#22336;&#22788;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21363;&#23558;&#21018;&#35835;&#36827;&#26469;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">512</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;&#30340;&#25968;&#25454;&#25644;&#31227;&#21040;&#20869;&#23384;&#22320;&#22336;&#22320;&#22336;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#36824;&#21407;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">popw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ds</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">popa</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29616;&#22312;</span><span class="org-whitespace-space"> </span><span class="org-comment">boot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30340;&#25152;&#26377;&#20219;&#21153;&#20840;&#37096;&#23436;&#25104;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20877;&#25191;&#34892;&#19968;&#26465;&#36339;&#36716;&#25351;&#20196;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25226;&#25511;&#21046;&#26435;&#20132;&#32473;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21518;&#23601;&#21151;&#25104;&#36523;&#36864;&#20102;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">boot</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">kernel_address</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>*(kernel_address)
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#23384;&#25918;&#20102;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#29983;&#25104;&#30340;&#26426;&#22120;&#30721;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#33267;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">0x8000</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">512</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;&#20195;&#30721;&#23436;&#25104;&#20160;&#20040;&#21151;&#33021;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35265;</span><span class="org-whitespace-space"> </span><span class="org-comment">diskboot.S</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27880;&#37322;</span>

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">END</span><span class="org-whitespace-space"> </span><span class="org-comment">OF</span><span class="org-whitespace-space"> </span><span class="org-comment">MAIN</span><span class="org-whitespace-space"> </span><span class="org-comment">LOOP</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">Geometry</span><span class="org-whitespace-space"> </span><span class="org-comment">translation</span><span class="org-whitespace-space"> </span><span class="org-comment">error</span><span class="org-whitespace-space"> </span><span class="org-comment">(past</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">end</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">geometry!).</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-function-name">geometry_error</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25171;&#21360;&#38169;&#35823;&#20449;&#24687;&#20018;</span><span class="org-whitespace-space"> </span><span class="org-comment">geometry_error_string</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#36339;&#36716;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">general_error</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23637;&#24320;&#21518;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(geometry_error_string-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">geometry_error_string</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">"Geom"</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MSG</span>(geometry_error_string)
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>general_error

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Disk</span><span class="org-whitespace-space"> </span><span class="org-comment">probe</span><span class="org-whitespace-space"> </span><span class="org-comment">failure.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-function-name">hd_probe_error</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25171;&#21360;&#38169;&#35823;&#20449;&#24687;&#20018;</span><span class="org-whitespace-space"> </span><span class="org-comment">hd_probe_error_string</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#36339;&#36716;&#21040;</span><span class="org-whitespace-space"> </span><span class="org-comment">general_error</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23637;&#24320;&#21518;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(hd_probe_error_string-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">hd_probe_error_string</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">"Hard</span><span class="org-whitespace-space"> </span><span class="org-comment">Disk"</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MSG</span>(hd_probe_error_string)
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>general_error

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Read</span><span class="org-whitespace-space"> </span><span class="org-comment">error</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">disk.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-function-name">read_error</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25171;&#21360;&#38169;&#35823;&#20449;&#24687;&#20018;</span><span class="org-whitespace-space"> </span><span class="org-comment">read_error_string</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23637;&#24320;&#21518;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(read_error_string-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">read_error_string</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">"Read"</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MSG</span>(read_error_string)

<span class="org-function-name">general_error</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25171;&#21360;&#38169;&#35823;&#20449;&#24687;&#20018;</span><span class="org-whitespace-space"> </span><span class="org-comment">general_error_string</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25552;&#20379;&#30340;&#35843;&#29992;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x18</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21578;&#35785;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24341;&#23548;&#22833;&#36133;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36827;&#20837;&#27515;&#24490;&#29615;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#31561;&#24453;&#25163;&#21160;&#37325;&#36215;</span><span class="org-whitespace-space"> </span><span class="org-comment">(</span><span class="org-whitespace-space"> </span><span class="org-comment">&#19979;&#38754;&#31532;</span><span class="org-whitespace-space"> </span><span class="org-comment">4</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34892;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#20195;&#30721;</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23637;&#24320;&#21518;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(general_error_string-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MSG</span>(general_error_string)

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">go</span><span class="org-whitespace-space"> </span><span class="org-comment">here</span><span class="org-whitespace-space"> </span><span class="org-comment">when</span><span class="org-whitespace-space"> </span><span class="org-comment">you</span><span class="org-whitespace-space"> </span><span class="org-comment">need</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">stop</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">machine</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">after</span><span class="org-whitespace-space"> </span><span class="org-comment">an</span><span class="org-whitespace-space"> </span><span class="org-comment">error</span><span class="org-whitespace-space"> </span><span class="org-comment">condition</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">tell</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">boot</span><span class="org-whitespace-space"> </span><span class="org-comment">failure,</span><span class="org-whitespace-space"> </span><span class="org-comment">which</span><span class="org-whitespace-space"> </span><span class="org-comment">may</span><span class="org-whitespace-space"> </span><span class="org-comment">result</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">no</span><span class="org-whitespace-space"> </span><span class="org-comment">effect</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x18
<span class="org-function-name">stop</span>:<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>stop

<span class="org-function-name">notification_string</span>:<span class="org-whitespace-space"> </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"GRUB</span><span class="org-whitespace-space"> </span><span class="org-string">"</span>
<span class="org-function-name">geometry_error_string</span>:<span class="org-whitespace-space"> </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"Geom"</span>
<span class="org-function-name">hd_probe_error_string</span>:<span class="org-whitespace-space"> </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"Hard</span><span class="org-whitespace-space"> </span><span class="org-string">Disk"</span>
<span class="org-function-name">read_error_string</span>:<span class="org-whitespace-space"> </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"Read"</span>
<span class="org-function-name">general_error_string</span>:<span class="org-whitespace-space"> </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">Error"</span>

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">message:</span><span class="org-whitespace-space"> </span><span class="org-comment">write</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">string</span><span class="org-whitespace-space"> </span><span class="org-comment">pointed</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">by</span><span class="org-whitespace-space"> </span><span class="org-comment">%si</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">   </span><span class="org-comment">WARNING:</span><span class="org-whitespace-space"> </span><span class="org-comment">trashes</span><span class="org-whitespace-space"> </span><span class="org-comment">%si,</span><span class="org-whitespace-space"> </span><span class="org-comment">%ax,</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Use</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">"int</span><span class="org-whitespace-space"> </span><span class="org-comment">10H</span><span class="org-whitespace-space"> </span><span class="org-comment">Function</span><span class="org-whitespace-space"> </span><span class="org-comment">0Eh"</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">write</span><span class="org-whitespace-space"> </span><span class="org-comment">character</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">teletype</span><span class="org-whitespace-space"> </span><span class="org-comment">mode</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">%ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0xe</span><span class="org-whitespace-space"> </span><span class="org-comment">%al</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">character</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">%bh</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">page</span><span class="org-whitespace-space"> </span><span class="org-comment">%bl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">foreground</span><span class="org-whitespace-space"> </span><span class="org-comment">color</span><span class="org-whitespace-space"> </span><span class="org-comment">(graphics</span><span class="org-whitespace-space"> </span><span class="org-comment">modes)</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36890;&#36807;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25552;&#20379;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x10</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x0E</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25226;</span><span class="org-whitespace-space"> </span><span class="org-comment">ds:si</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#31526;&#20018;&#36880;&#20010;&#36755;&#20986;&#21040;&#32456;&#31471;</span>
<span class="org-function-name">1</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$0x0001,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$0xe,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ah</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x10<span class="org-whitespace-space">  </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">display</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">byte</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-function-name">message</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">lodsb</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">cmpb</span><span class="org-whitespace-space"> </span>$0,<span class="org-whitespace-space"> </span><span class="org-variable-name">%al</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jne</span><span class="org-whitespace-space"> </span>1b<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">not</span><span class="org-whitespace-space"> </span><span class="org-comment">end</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">string,</span><span class="org-whitespace-space"> </span><span class="org-comment">jmp</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">display</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">ret</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">Windows</span><span class="org-whitespace-space"> </span><span class="org-comment">NT</span><span class="org-whitespace-space"> </span><span class="org-comment">breaks</span><span class="org-whitespace-space"> </span><span class="org-comment">compatibility</span><span class="org-whitespace-space"> </span><span class="org-comment">by</span><span class="org-whitespace-space"> </span><span class="org-comment">embedding</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">magic</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">here.</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">Windows</span><span class="org-whitespace-space"> </span><span class="org-comment">NT</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;&#27492;&#35774;&#32622;&#20102;&#24187;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#27492;&#22788;&#20445;&#30041;&#24050;&#20445;&#35777;&#20860;&#23481;&#24615;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_WINDOWS_NT_MAGIC</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x1B8</span>
<span class="org-whitespace-space"> </span>.<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>_start<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_WINDOWS_NT_MAGIC
<span class="org-function-name">nt_magic</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.long</span><span class="org-whitespace-space"> </span>0
<span class="org-whitespace-space"> </span><span class="org-keyword">.word</span><span class="org-whitespace-space"> </span>0

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">This</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">where</span><span class="org-whitespace-space"> </span><span class="org-comment">an</span><span class="org-whitespace-space"> </span><span class="org-comment">MBR</span><span class="org-whitespace-space"> </span><span class="org-comment">would</span><span class="org-whitespace-space"> </span><span class="org-comment">go</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">hard</span><span class="org-whitespace-space"> </span><span class="org-comment">disk.</span><span class="org-whitespace-space">  </span><span class="org-comment">The</span><span class="org-whitespace-space"> </span><span class="org-comment">code</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">here</span><span class="org-whitespace-space"> </span><span class="org-comment">isn't</span><span class="org-whitespace-space"> </span><span class="org-comment">even</span><span class="org-whitespace-space"> </span><span class="org-comment">referenced</span><span class="org-whitespace-space"> </span><span class="org-comment">unless</span><span class="org-whitespace-space"> </span><span class="org-comment">we're</span><span class="org-whitespace-space"> </span><span class="org-comment">on</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy.</span><span class="org-whitespace-space">  </span><span class="org-comment">Kinda</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">sneaky,</span><span class="org-whitespace-space"> </span><span class="org-comment">huh?</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#26159;&#30828;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20197;&#19979;&#26159;&#20998;&#21306;&#34920;&#22320;&#22336;&#22495;</span>
<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21542;&#21017;&#22914;&#26524;&#26159;&#36719;&#30424;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21017;&#23384;&#20648;</span>
<span class="org-function-name">part_start</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_PART_START</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x1BE</span>
<span class="org-whitespace-space"> </span>.<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>_start<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_PART_START

<span class="org-function-name">probe_values</span>:
<span class="org-whitespace-space"> </span><span class="org-keyword">.byte</span><span class="org-whitespace-space"> </span>36,<span class="org-whitespace-space"> </span>18,<span class="org-whitespace-space"> </span>15,<span class="org-whitespace-space"> </span>9,<span class="org-whitespace-space"> </span>0

<span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36719;&#30424;&#24341;&#23548;&#25506;&#27979;</span>
<span class="org-function-name">floppy_probe</span>:
<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space">  </span><span class="org-comment">Perform</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy</span><span class="org-whitespace-space"> </span><span class="org-comment">probe.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#23637;&#24320;&#20043;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(probe_values-1</span><span class="org-whitespace-space"> </span><span class="org-comment">-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$ABS(probe_values-1),<span class="org-whitespace-space"> </span><span class="org-variable-name">%si</span>

<span class="org-function-name">probe_loop</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">reset</span><span class="org-whitespace-space"> </span><span class="org-comment">floppy</span><span class="org-whitespace-space"> </span><span class="org-comment">controller</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">13h</span><span class="org-whitespace-space"> </span><span class="org-comment">AH=0</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30913;&#30424;/&#36719;&#30424;&#22797;&#20301;&#35843;&#29992;</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">INT</span><span class="org-whitespace-space"> </span><span class="org-comment">0x13</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span><span class="org-whitespace-space"> </span><span class="org-comment">;</span><span class="org-whitespace-space"> </span><span class="org-comment">DL</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25104;&#21151;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22833;&#36133;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">CF</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">AH</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">&#38169;&#35823;&#29366;&#24577;</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Note:</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Forces</span><span class="org-whitespace-space"> </span><span class="org-comment">controller</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">recalibrate</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">heads</span><span class="org-whitespace-space"> </span><span class="org-comment">(seek</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">track</span><span class="org-whitespace-space"> </span><span class="org-comment">0).</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">For</span><span class="org-whitespace-space"> </span><span class="org-comment">PS/2</span><span class="org-whitespace-space"> </span><span class="org-comment">35SX,</span><span class="org-whitespace-space"> </span><span class="org-comment">35LS,</span><span class="org-whitespace-space"> </span><span class="org-comment">40SX</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">L40SX,</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">well</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">many</span><span class="org-whitespace-space"> </span><span class="org-comment">other</span><span class="org-whitespace-space"> </span><span class="org-comment">systems,</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">both</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">master</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">slave</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span><span class="org-whitespace-space"> </span><span class="org-comment">respond</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">Reset</span><span class="org-whitespace-space"> </span><span class="org-comment">function</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">that</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">issued</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">either</span><span class="org-whitespace-space"> </span><span class="org-comment">drive</span>
<span class="org-whitespace-space">  </span><span class="org-comment">*/</span>


<span class="org-whitespace-space"> </span><span class="org-keyword">xorw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x13

<span class="org-whitespace-space"> </span><span class="org-keyword">incw</span><span class="org-whitespace-space"> </span><span class="org-variable-name">%si</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>(<span class="org-variable-name">%si</span>),<span class="org-whitespace-space"> </span><span class="org-variable-name">%cl</span>

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">sectors</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">0,</span><span class="org-whitespace-space"> </span><span class="org-comment">display</span><span class="org-whitespace-space"> </span><span class="org-comment">error</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">die</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#25159;&#21306;&#25968;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20986;&#38169;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21542;&#21017;&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">1f</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">cmpb</span><span class="org-whitespace-space"> </span>$0,<span class="org-whitespace-space"> </span><span class="org-variable-name">%cl</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jne</span><span class="org-whitespace-space"> </span>1f

<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">Floppy</span><span class="org-whitespace-space"> </span><span class="org-comment">disk</span><span class="org-whitespace-space"> </span><span class="org-comment">probe</span><span class="org-whitespace-space"> </span><span class="org-comment">failure.</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23439;&#26367;&#25442;&#21518;</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">movw</span><span class="org-whitespace-space"> </span><span class="org-comment">$(fd_probe_error_string-_start+0x7c00),</span><span class="org-whitespace-space"> </span><span class="org-comment">%si;</span><span class="org-whitespace-space"> </span><span class="org-comment">call</span><span class="org-whitespace-space"> </span><span class="org-comment">message</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">fd_probe_error_string</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">"Flobby"</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">MSG</span>(fd_probe_error_string)
<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>general_error

<span class="org-function-name">fd_probe_error_string</span>:<span class="org-whitespace-space"> </span>.string<span class="org-whitespace-space"> </span><span class="org-string">"Floppy"</span>

<span class="org-function-name">1</span>:
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#36719;&#30424;&#35835;&#21462;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#21644;</span><span class="org-whitespace-space"> </span><span class="org-comment">CHS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35835;&#21462;&#30340;</span><span class="org-whitespace-space"> </span><span class="org-comment">BIOS</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35843;&#29992;&#23436;&#20840;&#19968;&#33268;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35814;&#32454;&#35265;</span><span class="org-whitespace-space"> </span><span class="org-comment">chs_mod</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22788;&#30340;&#27880;&#37322;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23492;&#23384;&#22120;&#20540;</span><span class="org-whitespace-space"> </span><span class="org-comment">ah</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x02</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">al</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x01</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">ch</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">cl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">dl</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">driver</span><span class="org-whitespace-space"> </span><span class="org-comment">n</span><span class="org-comment"><span class="org-whitespace-line">umber</span></span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">perform</span><span class="org-whitespace-space"> </span><span class="org-comment">read</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_BUFFER_SEG</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7000</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$GRUB_BOOT_MACHINE_BUFFER_SEG,<span class="org-whitespace-space"> </span><span class="org-variable-name">%bx</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movw</span><span class="org-whitespace-space"> </span>$0x201,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ax</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$0,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ch</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$0,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dh</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">int</span><span class="org-whitespace-space"> </span>$0x13

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">error,</span><span class="org-whitespace-space"> </span><span class="org-comment">jump</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">"probe_loop"</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22914;&#26524;&#35835;&#22833;&#36133;&#36820;&#22238;</span><span class="org-whitespace-space"> </span><span class="org-comment">probe_loop</span><span class="org-whitespace-space"> </span><span class="org-comment">&#37325;&#35835;</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">jc</span><span class="org-whitespace-space"> </span>probe_loop

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">%cl</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">already</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">correct</span><span class="org-whitespace-space"> </span><span class="org-comment">value!</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25159;&#21306;/&#26609;&#38754;/&#30913;&#22836;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">cl</span><span class="org-whitespace-space"> </span><span class="org-comment">&#21363;</span><span class="org-whitespace-space"> </span><span class="org-comment">start</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24050;&#35774;&#32622;&#27491;&#30830;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">79</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#26609;&#38754;&#26368;&#22823;&#20540;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">79(80&#26609;:0~79)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">dh</span><span class="org-whitespace-space"> </span><span class="org-comment">&#35774;&#32622;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#34920;&#31034;&#30913;&#22836;&#25968;&#26368;&#22823;&#20540;&#20026;</span><span class="org-whitespace-space"> </span><span class="org-comment">1(2&#22836;:0~1)</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#28982;&#21518;&#36339;&#36716;&#33267;</span><span class="org-whitespace-space"> </span><span class="org-comment">final_init</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#26597;&#30475;</span><span class="org-whitespace-space"> </span><span class="org-comment">final_init</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#30693;&#36947;&#20445;&#23384;&#26102;&#20250;&#25226;&#26609;&#38754;&#21644;&#30913;&#22836;&#20998;&#21035;&#21152;</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#25159;&#21306;&#19981;&#21464;</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22240;&#27492;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#22312;&#36719;&#30424;&#21152;&#36733;&#26102;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23558;&#35774;&#32622;</span><span class="org-whitespace-space"> </span><span class="org-comment">Cylinder</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">Head</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">Sector</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">80</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">:</span><span class="org-whitespace-space"> </span><span class="org-comment">start_sector</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$1,<span class="org-whitespace-space"> </span><span class="org-variable-name">%dh</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">movb</span><span class="org-whitespace-space"> </span>$79,<span class="org-whitespace-space"> </span><span class="org-variable-name">%ch</span>

<span class="org-whitespace-space"> </span><span class="org-keyword">jmp</span><span class="org-whitespace-space"> </span>final_init

<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_PART_END</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0x1FE</span>
<span class="org-whitespace-space"> </span>.<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>_start<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_PART_END
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#31354;&#38388;&#20445;&#30041;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20998;&#21306;&#20449;&#24687;&#21344;&#29992;&#20869;&#23384;&#22320;&#22336;&#26159;</span><span class="org-whitespace-space"> </span><span class="org-comment">_start</span><span class="org-whitespace-space"> </span><span class="org-comment">+</span><span class="org-whitespace-space"> </span><span class="org-comment">0x1BE</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">_start</span><span class="org-whitespace-space"> </span><span class="org-comment">+</span><span class="org-whitespace-space"> </span><span class="org-comment">0x1FD</span>

<span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">last</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">bytes</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">sector</span><span class="org-whitespace-space"> </span><span class="org-comment">0</span><span class="org-whitespace-space"> </span><span class="org-comment">contain</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">signature</span><span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">&#24341;&#23548;&#24187;&#25968;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">2</span><span class="org-whitespace-space"> </span><span class="org-comment">&#23383;&#33410;</span><span class="org-whitespace-space"> </span><span class="org-comment">,</span><span class="org-whitespace-space"> </span><span class="org-comment">&#31561;&#20110;</span><span class="org-whitespace-space"> </span><span class="org-comment">0xAA55</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">GRUB_BOOT_MACHINE_SIGNATURE</span><span class="org-whitespace-space"> </span><span class="org-comment">=</span><span class="org-whitespace-space"> </span><span class="org-comment">0xAA55</span>
<span class="org-whitespace-space"> </span><span class="org-keyword">.word</span><span class="org-whitespace-space"> </span>GRUB_BOOT_MACHINE_SIGNATURE


<span class="org-comment-delimiter">//</span><span class="org-comment">&#26412;&#27573;&#20195;&#30721;&#22312;&#32534;&#35793;&#38142;&#25509;&#25104;&#30340;&#26426;&#22120;&#30721;&#22914;&#19979;:(</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7C00</span><span class="org-whitespace-space"> </span><span class="org-comment">~</span><span class="org-whitespace-space"> </span><span class="org-comment">0x7DFF</span><span class="org-whitespace-space"> </span><span class="org-comment">&#20849;512&#23383;&#33410;</span><span class="org-whitespace-space"> </span><span class="org-comment">)</span>
<span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">ADDR</span><span class="org-whitespace-space"> </span><span class="org-comment">---------------CODE----------------</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c00</span><span class="org-whitespace-space"> </span><span class="org-comment">eb4b9000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c10</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c20</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c30</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000400</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c40</span><span class="org-whitespace-space"> </span><span class="org-comment">00800008</span><span class="org-whitespace-space"> </span><span class="org-comment">01000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">fffaeb07</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c50</span><span class="org-whitespace-space"> </span><span class="org-comment">f6c28075</span><span class="org-whitespace-space"> </span><span class="org-comment">02b280ea</span><span class="org-whitespace-space"> </span><span class="org-comment">5c7c0000</span><span class="org-whitespace-space"> </span><span class="org-comment">31c08ed8</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c60</span><span class="org-whitespace-space"> </span><span class="org-comment">8ed0bc00</span><span class="org-whitespace-space"> </span><span class="org-comment">20fba04c</span><span class="org-whitespace-space"> </span><span class="org-comment">7c3cff74</span><span class="org-whitespace-space"> </span><span class="org-comment">0288c252</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c70</span><span class="org-whitespace-space"> </span><span class="org-comment">be717de8</span><span class="org-whitespace-space"> </span><span class="org-comment">2301be05</span><span class="org-whitespace-space"> </span><span class="org-comment">7cf6c280</span><span class="org-whitespace-space"> </span><span class="org-comment">7448b441</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c80</span><span class="org-whitespace-space"> </span><span class="org-comment">bbaa55cd</span><span class="org-whitespace-space"> </span><span class="org-comment">135a5272</span><span class="org-whitespace-space"> </span><span class="org-comment">3d81fb55</span><span class="org-whitespace-space"> </span><span class="org-comment">aa753783</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7c90</span><span class="org-whitespace-space"> </span><span class="org-comment">e1017432</span><span class="org-whitespace-space"> </span><span class="org-comment">31c08944</span><span class="org-whitespace-space"> </span><span class="org-comment">04408844</span><span class="org-whitespace-space"> </span><span class="org-comment">ff894402</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7ca0</span><span class="org-whitespace-space"> </span><span class="org-comment">c7041000</span><span class="org-whitespace-space"> </span><span class="org-comment">668b1e44</span><span class="org-whitespace-space"> </span><span class="org-comment">7c66895c</span><span class="org-whitespace-space"> </span><span class="org-comment">08668b1e</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7cb0</span><span class="org-whitespace-space"> </span><span class="org-comment">487c6689</span><span class="org-whitespace-space"> </span><span class="org-comment">5c0cc744</span><span class="org-whitespace-space"> </span><span class="org-comment">060070b4</span><span class="org-whitespace-space"> </span><span class="org-comment">42cd1372</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7cc0</span><span class="org-whitespace-space"> </span><span class="org-comment">05bb0070</span><span class="org-whitespace-space"> </span><span class="org-comment">eb73b408</span><span class="org-whitespace-space"> </span><span class="org-comment">cd13730a</span><span class="org-whitespace-space"> </span><span class="org-comment">f6c2800f</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7cd0</span><span class="org-whitespace-space"> </span><span class="org-comment">84f000e9</span><span class="org-whitespace-space"> </span><span class="org-comment">8300660f</span><span class="org-whitespace-space"> </span><span class="org-comment">b6c68864</span><span class="org-whitespace-space"> </span><span class="org-comment">ff406689</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7ce0</span><span class="org-whitespace-space"> </span><span class="org-comment">44040fb6</span><span class="org-whitespace-space"> </span><span class="org-comment">d1c1e202</span><span class="org-whitespace-space"> </span><span class="org-comment">88e888f4</span><span class="org-whitespace-space"> </span><span class="org-comment">40894408</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7cf0</span><span class="org-whitespace-space"> </span><span class="org-comment">0fb6c2c0</span><span class="org-whitespace-space"> </span><span class="org-comment">e8026689</span><span class="org-whitespace-space"> </span><span class="org-comment">0466a148</span><span class="org-whitespace-space"> </span><span class="org-comment">7c6609c0</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d00</span><span class="org-whitespace-space"> </span><span class="org-comment">754f66a1</span><span class="org-whitespace-space"> </span><span class="org-comment">447c6631</span><span class="org-whitespace-space"> </span><span class="org-comment">d266f734</span><span class="org-whitespace-space"> </span><span class="org-comment">88d131d2</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d10</span><span class="org-whitespace-space"> </span><span class="org-comment">66f77404</span><span class="org-whitespace-space"> </span><span class="org-comment">3b44087d</span><span class="org-whitespace-space"> </span><span class="org-comment">38fec188</span><span class="org-whitespace-space"> </span><span class="org-comment">c530c0c1</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d20</span><span class="org-whitespace-space"> </span><span class="org-comment">e80208c1</span><span class="org-whitespace-space"> </span><span class="org-comment">88d05a88</span><span class="org-whitespace-space"> </span><span class="org-comment">c6bb0070</span><span class="org-whitespace-space"> </span><span class="org-comment">8ec331db</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d30</span><span class="org-whitespace-space"> </span><span class="org-comment">b80102cd</span><span class="org-whitespace-space"> </span><span class="org-comment">13722a8c</span><span class="org-whitespace-space"> </span><span class="org-comment">c38e0642</span><span class="org-whitespace-space"> </span><span class="org-comment">7c601eb9</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d40</span><span class="org-whitespace-space"> </span><span class="org-comment">00018edb</span><span class="org-whitespace-space"> </span><span class="org-comment">31f631ff</span><span class="org-whitespace-space"> </span><span class="org-comment">fcf3a51f</span><span class="org-whitespace-space"> </span><span class="org-comment">61ff2640</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d50</span><span class="org-whitespace-space"> </span><span class="org-comment">7cbe777d</span><span class="org-whitespace-space"> </span><span class="org-comment">e84200eb</span><span class="org-whitespace-space"> </span><span class="org-comment">0ebe7c7d</span><span class="org-whitespace-space"> </span><span class="org-comment">e83a00eb</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d60</span><span class="org-whitespace-space"> </span><span class="org-comment">06be867d</span><span class="org-whitespace-space"> </span><span class="org-comment">e83200be</span><span class="org-whitespace-space"> </span><span class="org-comment">8b7de82c</span><span class="org-whitespace-space"> </span><span class="org-comment">00cd18eb</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d70</span><span class="org-whitespace-space"> </span><span class="org-comment">fe475255</span><span class="org-whitespace-space"> </span><span class="org-comment">42200047</span><span class="org-whitespace-space"> </span><span class="org-comment">656f6d00</span><span class="org-whitespace-space"> </span><span class="org-comment">48617264</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d80</span><span class="org-whitespace-space"> </span><span class="org-comment">20446973</span><span class="org-whitespace-space"> </span><span class="org-comment">6b005265</span><span class="org-whitespace-space"> </span><span class="org-comment">61640020</span><span class="org-whitespace-space"> </span><span class="org-comment">4572726f</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7d90</span><span class="org-whitespace-space"> </span><span class="org-comment">7200bb01</span><span class="org-whitespace-space"> </span><span class="org-comment">00b40ecd</span><span class="org-whitespace-space"> </span><span class="org-comment">10ac3c00</span><span class="org-whitespace-space"> </span><span class="org-comment">75f4c300</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7da0</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7db0</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">00002412</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7dc0</span><span class="org-whitespace-space"> </span><span class="org-comment">0f0900be</span><span class="org-whitespace-space"> </span><span class="org-comment">bd7d31c0</span><span class="org-whitespace-space"> </span><span class="org-comment">cd13468a</span><span class="org-whitespace-space"> </span><span class="org-comment">0c80f900</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7dd0</span><span class="org-whitespace-space"> </span><span class="org-comment">750fbeda</span><span class="org-whitespace-space"> </span><span class="org-comment">7de8c1ff</span><span class="org-whitespace-space"> </span><span class="org-comment">eb8d466c</span><span class="org-whitespace-space"> </span><span class="org-comment">6f707079</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7de0</span><span class="org-whitespace-space"> </span><span class="org-comment">00bb0070</span><span class="org-whitespace-space"> </span><span class="org-comment">b80102b5</span><span class="org-whitespace-space"> </span><span class="org-comment">00b600cd</span><span class="org-whitespace-space"> </span><span class="org-comment">1372d7b6</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">7df0</span><span class="org-whitespace-space"> </span><span class="org-comment">01b54fe9</span><span class="org-whitespace-space"> </span><span class="org-comment">e0fe0000</span><span class="org-whitespace-space"> </span><span class="org-comment">00000000</span><span class="org-whitespace-space"> </span><span class="org-comment">000055aa</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*/</span>
</pre>
</div>

<script src="https://utteranc.es/client.js"
        repo="yygcode/yygcode.github.io"
        issue-term="pathname"
        label=" Utterances"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>
</div>
<div id="postamble" class="status">
<div class="copyright">
2012-2020 Copyright&copy; <i> YANYG - Powered by Emacs Orgmode</i>
</div>
</div>
</body>
</html>
