<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<!-- 2018-04-21 Sat 07:29 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Linux Systemd Introduce and Analysis</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yanyg" />
<link rel="stylesheet" type="text/css" href="../r/org-code.css" />
<link rel="stylesheet" type="text/css" href="../r/blog-bluetopbar.css" />
<script type="text/javascript" src="../r/MathJax.js?config=TeX-AMS_HTML"> </script>
<script type="text/javascript" src="../r/bootstrap.min.js"></script>
<script type="text/javascript" src="../r/jquery.stickytableheaders.min.js"></script>
</head>
<body>
<div id="preamble" class="status">
<a href="../index.html">Yanyg - SAN Software Engineer</a>
<div class="sitelinks">
  <a href="archives.html">Archives</a> |
  <a href="theindex.html">Index</a> |
  <a href="tags.html">TAGS</a> |
  <a href="https://github.com/yygcode">Github</a> |
  <a href="../about.html">About Me</a>
</div>
</div>
<div id="content">
<h1 class="title">Linux Systemd Introduce and Analysis</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc0820a5">1. 介绍</a></li>
<li><a href="#orgaf40301">2. 使用命令</a>
<ul>
<li><a href="#org8b93fc8">2.1. 版本：systemctl &#x2013;version</a></li>
<li><a href="#org874a582">2.2. 主机名称控制：hostnamectl</a>
<ul>
<li><a href="#org4fadb04">2.2.1. Example</a></li>
<li><a href="#orgd006d4a">2.2.2. Manpage</a></li>
</ul>
</li>
<li><a href="#orgc6dbe13">2.3. 系统本地化与键盘布局：localectl</a>
<ul>
<li><a href="#org0a0e9a6">2.3.1. example</a></li>
<li><a href="#orgbf93eb9">2.3.2. Manpage</a></li>
</ul>
</li>
<li><a href="#orgc51a584">2.4. 系统时间和日期：timedatectl</a>
<ul>
<li><a href="#orgf989477">2.4.1. example</a></li>
<li><a href="#orgf4be4e9">2.4.2. help</a></li>
</ul>
</li>
<li><a href="#org3da8cbe">2.5. 系统登录管理：loginctl</a>
<ul>
<li><a href="#orgd748263">2.5.1. example</a></li>
<li><a href="#org6bba433">2.5.2. help</a></li>
</ul>
</li>
<li><a href="#orgd45a499">2.6. Systemd系统和服务管理：systemctl</a>
<ul>
<li><a href="#orge787dc0">2.6.1. example</a>
<ul>
<li><a href="#orga23975d">2.6.1.1. 显示已知units：systemctl list-units [PATTERN&#x2026;]</a></li>
<li><a href="#org892bfe6">2.6.1.2. 显示安装的unit文件：list-unit-files [PATTERN&#x2026;]</a></li>
<li><a href="#org6e234d1">2.6.1.3. systemctl candidates: systemctl with two tabs</a></li>
</ul>
</li>
<li><a href="#org1e88d91">2.6.2. help</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga3a2d64">3. 学习笔记</a></li>
<li><a href="#org8e0aef9">4. 作者</a></li>
<li><a href="#org2f12d2c">5. References</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc0820a5" class="outline-2">
<h2 id="orgc0820a5"><span class="section-number-2">1</span> 介绍</h2>
<div class="outline-text-2" id="text-1">
<p>
一言以蔽之，<a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>是<a href="https://savannah.nongnu.org/projects/sysvinit">sysvinit</a>的后继，通过并行启动方式，提供更快的系统启动速度。缺点是庞大复杂，不如sysvinit清晰。目前主流发行版本已全部切换到Systemd。
</p>

<p>
Homepage: <a href="https://freedesktop.org/wiki/Software/systemd/">https://freedesktop.org/wiki/Software/systemd/</a>
ArchWiki: <a href="https://wiki.archlinux.org/index.php/systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">https://wiki.archlinux.org/index.php/systemd_(简体中文)</a>
</p>

<p>
systemd是一个Linux系统基础组件的集合，提供了一个系统和服务管理器，运行为PID 1并负责启动其它程序。功能包括：
</p>
<ul class="org-ul">
<li>支持并行化任务；</li>
<li>采用socket式与D-Bus总线式激活服务；</li>
<li>按需启动守护进程（daemon）；</li>
<li>利用Linux的cgroups监视进程；</li>
<li>支持快照和系统恢复；</li>
<li>维护挂载点和自动挂载点；</li>
<li>各服务间基于依赖关系进行精密控制。</li>
</ul>

<p>
systemd 支持 SysV 和 LSB 初始脚本，可以替代 sysvinit。除此之外，功能还包括日志进程、控制基础系统配置，维护登陆用户列表以及系统账户、运行时目录和设置，可以运行容器和虚拟机，可以简单的管理网络配置、网络时间同步、日志转发和名称解析等。
</p>

<blockquote>
<p>
systemd is a suite of basic building blocks for a Linux system. It provides a
system and service manager that runs as PID 1 and starts the rest of the system.
systemd provides aggressive(积极主动的) parallelization capabilities, uses
socket and D-Bus activation for starting services, offers on-demand starting of
daemons, keeps track of processes using Linux control groups, maintains mount
and automount points, and implements an elaborate(详尽的) transactional
dependency-based service control logic. systemd supports SysV and LSB init
scripts and works as a replacement for sysvinit. Other parts include a logging
daemon, utilities to control basic system configuration like the hostname, date,
locale, maintain a list of logged-in users and running containers and virtual
machines, system accounts, runtime directories and settings, and daemons to
manage simple network configuration, network time synchronization, log
forwarding, and name resolution. See <a href="http://0pointer.de/blog/projects/systemd.html">Lennart's blog story</a> for a longer
introduction, and the <a href="http://0pointer.de/blog/projects/systemd-update.html">three status updates</a> since then. Also see the <a href="http://en.wikipedia.org/wiki/Systemd">Wikipedia
article</a>. If you are wondering whether systemd is for you, please have a look at
<a href="http://0pointer.de/blog/projects/why.html">this comparison of init systems by one of the creators of systemd.</a>
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgaf40301" class="outline-2">
<h2 id="orgaf40301"><span class="section-number-2">2</span> 使用命令</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org8b93fc8" class="outline-3">
<h3 id="org8b93fc8"><span class="section-number-3">2.1</span> 版本：systemctl &#x2013;version</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-sh">~$ systemctl --version
systemd 215
+PAM +AUDIT +SELINUX +IMA +SYSVINIT +LIBCRYPTSETUP +GCRYPT +ACL +XZ -SECCOMP -APPARMOR
</pre>
</div>
</div>
</div>

<div id="outline-container-org874a582" class="outline-3">
<h3 id="org874a582"><span class="section-number-3">2.2</span> 主机名称控制：hostnamectl</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org4fadb04" class="outline-4">
<h4 id="org4fadb04"><span class="section-number-4">2.2.1</span> Example</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-sh">~$ hostnamectl
   Static hostname: t
         Icon name: computer-laptop
           Chassis: laptop
        Machine ID: 3f8fab35efba44a482161bc965a1d153
           Boot ID: cdaca32c1ba6410281c5eab7af23957e
  Operating System: Debian GNU/Linux 8 (jessie)
            Kernel: Linux 3.16.0-4-amd64
      Architecture: x86-64
~$ sudo hostnamectl set-hostname yyy
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd006d4a" class="outline-4">
<h4 id="orgd006d4a"><span class="section-number-4">2.2.2</span> Manpage</h4>
<div class="outline-text-4" id="text-2-2-2">
<blockquote>
<p>
DESCRIPTION
       hostnamectl may be used to query and change the system hostname and
       related settings.
</p>

<p>
This tool distinguishes three different hostnames: the high-level "pretty"
hostname which might include all kinds of special characters (e.g.
"Lennart's Laptop"), the static hostname which is used to initialize the
kernel hostname at boot (e.g. "lennarts-laptop"), and the transient
hostname which is a default received from network configuration. If a
static hostname is set, and is valid (something other than localhost),
then the transient hostname is not used.
</p>

<p>
Note that the pretty hostname has little restrictions on the characters
used, while the static and transient hostnames are limited to the usually
accepted characters of Internet domain names.
</p>

<p>
The static hostname is stored in /etc/hostname, see hostname(5) for more
information. The pretty hostname, chassis type, and icon name are stored
in /etc/machine-info, see machine-id(5).
</p>

<p>
OPTIONS
       The following options are understood:
</p>

<p>
&#x2013;no-ask-password
    Do not query the user for authentication for privileged operations.
</p>

<p>
&#x2013;static, &#x2013;transient, &#x2013;pretty
    If status is used (or no explicit command is given) and one of those
    fields is given, hostnamectl will print out just this selected
    hostname.
</p>

<p>
If used with set-hostname, only the selected hostname(s) will be
updated. When more than one of those options is used, all the
specified hostnames will be updated.
</p>

<p>
-H, &#x2013;host=
    Execute the operation remotely. Specify a hostname, or a username and
    hostname separated by "@", to connect to. The hostname may optionally
    be suffixed by a container name, separated by ":", which connects
    directly to a specific container on the specified host. This will use
    SSH to talk to the remote machine manager instance. Container names
    may be enumerated with machinectl -H HOST.
</p>


<p>
-h, &#x2013;help
    Print a short help text and exit.
</p>

<p>
&#x2013;version
    Print a short version string and exit.
</p>

<p>
The following commands are understood:
</p>

<p>
status
    Show current system hostname and related information.
</p>

<p>
set-hostname NAME
    Set the system hostname to NAME. By default, this will alter the
    pretty, the static, and the transient hostname alike; however, if one
    or more of &#x2013;static, &#x2013;transient, &#x2013;pretty are used, only the selected
    hostnames are changed. If the pretty hostname is being set, and static
    or transient are being set as well, the specified hostname will be
    simplified in regards to the character set used before the latter are
    updated. This is done by replacing spaces with "-" and removing
    special characters. This ensures that the pretty and the static
    hostname are always closely related while still following the validity
    rules of the specific name. This simplification of the hostname string
    is not done if only the transient and/or static host names are set,
    and the pretty host name is left untouched.
</p>

<p>
Pass the empty string "" as the hostname to reset the selected
hostnames to their default (usually "localhost").
</p>

<p>
set-icon-name NAME
    Set the system icon name to NAME. The icon name is used by some
    graphical applications to visualize this host. The icon name should
    follow the Icon Naming Specification[1].
</p>

<p>
Pass an empty string to reset the icon name to the default value,
which is determined from chassis type (see below) and possibly other
parameters.
</p>

<p>
set-chassis TYPE
    Set the chassis type to TYPE. The chassis type is used by some
    graphical applications to visualize the host or alter user
    interaction. Currently, the following chassis types are defined:
    "desktop", "laptop", "server", "tablet", "handset", "watch", as well
    as the special chassis types "vm" and "container" for virtualized
    systems that lack an immediate physical chassis.
</p>

<p>
Pass an empty string to reset the chassis type to the default value
which is determined from the firmware and possibly other parameters.
</p>

<p>
EXIT STATUS
       On success, 0 is returned, a non-zero failure code otherwise.
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgc6dbe13" class="outline-3">
<h3 id="orgc6dbe13"><span class="section-number-3">2.3</span> 系统本地化与键盘布局：localectl</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org0a0e9a6" class="outline-4">
<h4 id="org0a0e9a6"><span class="section-number-4">2.3.1</span> example</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">
<pre class="src src-sh">~$ localectl
   System Locale: <span class="org-variable-name">LANG</span>=en_US.UTF-8
                  <span class="org-variable-name">LANGUAGE</span>=en_US:en
       VC Keymap: n/a
      X11 Layout: us
       X11 Model: pc105
~$ sudo localectl set-locale <span class="org-variable-name">LANG</span>=zh_CN.utf8
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf93eb9" class="outline-4">
<h4 id="orgbf93eb9"><span class="section-number-4">2.3.2</span> Manpage</h4>
<div class="outline-text-4" id="text-2-3-2">
<blockquote>
<p>
NAME
       localectl - Control the system locale and keyboard layout settings
</p>

<p>
SYNOPSIS
       localectl [OPTIONS&#x2026;] {COMMAND}
</p>

<p>
DESCRIPTION
       localectl may be used to query and change the system locale and keyboard
       layout settings.
</p>

<p>
The system locale controls the language settings of system services and of
the UI before the user logs in, such as the display manager, as well as
the default for users after login.
</p>

<p>
The keyboard settings control the keyboard layout used on the text console
and of the graphical UI before the user logs in, such as the display
manager, as well as the default for users after login.
</p>

<p>
OPTIONS
</p>

<p>
The following options are understood:
&#x2013;no-ask-password
    Do not query the user for authentication for privileged operations.
</p>

<p>
&#x2013;no-convert
    If set-keymap or set-x11-keymap is invoked and this option is passed,
    then the keymap will not be converted from the console to X11, or X11
    to console, respectively.
</p>

<p>
-H, &#x2013;host=
    Execute the operation remotely. Specify a hostname, or a username and
    hostname separated by "@", to connect to. The hostname may optionally
    be suffixed by a container name, separated by ":", which connects
    directly to a specific container on the specified host. This will use
    SSH to talk to the remote machine manager instance. Container names
    may be enumerated with machinectl -H HOST.
</p>

<p>
-h, &#x2013;help
    Print a short help text and exit.
</p>

<p>
&#x2013;version
    Print a short version string and exit.
</p>

<p>
&#x2013;no-pager
    Do not pipe output into a pager.
</p>

<p>
The following commands are understood:
</p>

<p>
status
    Show current settings of the system locale and keyboard mapping.
</p>

<p>
set-locale LOCALE&#x2026;
    Set the system locale. This takes one or more assignments such as
    "LANG=de_DE.utf8", "LC_MESSAGES=en_GB.utf8", and so on. See locale(7)
    for details on the available settings and their meanings. Use
    list-locales for a list of available locales (see below).
</p>

<p>
list-locales
    List available locales useful for configuration with set-locale.
</p>

<p>
set-keymap MAP [TOGGLEMAP]
    Set the system keyboard mapping for the console. This takes a keyboard
    mapping name (such as "de" or "us"), and possibly a second one to
    define a toggle keyboard mapping. Unless &#x2013;no-convert is passed, the
    selected setting is also applied to the default keyboard mapping of
    X11, after converting it to the closest matching X11 keyboard mapping.
    Use list-keymaps for a list of available keyboard mappings (see
    below).
</p>

<p>
list-keymaps
    List available keyboard mappings for the console, useful for
    configuration with set-keymap.
</p>

<p>
set-x11-keymap LAYOUT [MODEL] [VARIANT] [OPTIONS]
    Set the system default keyboard mapping for X11. This takes a keyboard
    mapping name (such as "de" or "us"), and possibly a model, variant and
    options, see kbd(4) for details. Unless &#x2013;no-convert is passed, the
    selected setting is also applied to the system console keyboard
    mapping, after converting it to the closest matching console keyboard
    mapping.
</p>

<p>
list-x11-keymap-models, list-x11-keymap-layouts, list-x11-keymap-variants
[LAYOUT], list-x11-keymap-options
    List available X11 keymap models, layouts, variants and options,
    useful for configuration with set-keymap. The command
    list-x11-keymap-variants optionally takes a layout parameter to limit
    the output to the variants suitable for the specific layout.
</p>

<p>
EXIT STATUS
       On success, 0 is returned, a non-zero failure code otherwise.
</p>

<p>
ENVIRONMENT
       $SYSTEMD_PAGER
           Pager to use when &#x2013;no-pager is not given; overrides $PAGER. Setting
           this to an empty string or the value "cat" is equivalent to passing
           &#x2013;no-pager.
</p>

<p>
$SYSTEMD_LESS
    Override the default options passed to less ("FRSXMK").
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgc51a584" class="outline-3">
<h3 id="orgc51a584"><span class="section-number-3">2.4</span> 系统时间和日期：timedatectl</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-orgf989477" class="outline-4">
<h4 id="orgf989477"><span class="section-number-4">2.4.1</span> example</h4>
<div class="outline-text-4" id="text-2-4-1">
<div class="org-src-container">
<pre class="src src-sh">~$ timedatectl
      Local time: Fri 2018-03-30 11:11:25 CST
  Universal time: Fri 2018-03-30 03:11:25 UTC
        RTC time: Fri 2018-03-30 03:11:25
       Time zone: Asia/Shanghai (CST, +0800)
     NTP enabled: yes
NTP synchronized: yes
 RTC<span class="org-keyword"> in</span> local TZ: no
      DST active: n/a

~$ sudo timedatectl set-time HH:MM:SS
~$ sudo timedatectl set-time YYYY-MM-DD
~$ sudo timedatectl set-timezone Asia/Shanghai
~$ timedatectl set-ntp true
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4be4e9" class="outline-4">
<h4 id="orgf4be4e9"><span class="section-number-4">2.4.2</span> help</h4>
<div class="outline-text-4" id="text-2-4-2">
<div class="org-src-container">
<pre class="src src-sh">timedatectl --help
timedatectl [OPTIONS...] COMMAND ...

Query or change system time and date settings.

  -h --help                Show this help message
     --version             Show package version
     --no-pager            Do not pipe output into a pager
     --no-ask-password     Do not prompt for password
  -H --host=[USER@]HOST    Operate on remote host
  -M --machine=CONTAINER   Operate on local container
     --adjust-system-clock Adjust system clock when changing local RTC mode

Commands:
  status                   Show current time settings
  set-time TIME            Set system time
  set-timezone ZONE        Set system time zone
  list-timezones           Show known time zones
  set-local-rtc BOOL       Control whether RTC is<span class="org-keyword"> in</span> local time
  set-ntp BOOL             Control whether NTP is enabled
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3da8cbe" class="outline-3">
<h3 id="org3da8cbe"><span class="section-number-3">2.5</span> 系统登录管理：loginctl</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-orgd748263" class="outline-4">
<h4 id="orgd748263"><span class="section-number-4">2.5.1</span> example</h4>
<div class="outline-text-4" id="text-2-5-1">
<div class="org-src-container">
<pre class="src src-sh">~$ loginctl show-user yanyg
<span class="org-variable-name">UID</span>=1000
<span class="org-variable-name">GID</span>=1000
<span class="org-variable-name">Name</span>=yanyg
<span class="org-variable-name">Timestamp</span>=Fri 2018-03-30 09:57:52 CST
<span class="org-variable-name">TimestampMonotonic</span>=34018185
<span class="org-variable-name">RuntimePath</span>=/run/user/1000
<span class="org-variable-name">Service</span>=user@1000.service
<span class="org-variable-name">Slice</span>=user-1000.slice
<span class="org-variable-name">State</span>=active
<span class="org-variable-name">IdleHint</span>=no
<span class="org-variable-name">IdleSinceHint</span>=0
<span class="org-variable-name">IdleSinceHintMonotonic</span>=0
<span class="org-variable-name">Linger</span>=no

~$ loginctl list-sessions
   SESSION        UID USER             SEAT
        c1        119 Debian-gdm       seat0
         1       1000 yanyg            seat0

2 sessions listed.
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bba433" class="outline-4">
<h4 id="org6bba433"><span class="section-number-4">2.5.2</span> help</h4>
<div class="outline-text-4" id="text-2-5-2">
<div class="org-src-container">
<pre class="src src-sh">~$ loginctl --help
loginctl [OPTIONS...] {COMMAND} ...

Send control commands to or query the login manager.

  -h --help              Show this help
     --version           Show package version
     --no-pager          Do not pipe output into a pager
     --no-legend         Do not show the headers and footers
     --no-ask-password   Don<span class="org-string">'t prompt for password</span>
<span class="org-string">  -H --host=[USER@]HOST  Operate on remote host</span>
<span class="org-string">  -M --machine=CONTAINER Operate on local container</span>
<span class="org-string">  -p --property=NAME     Show only properties by this name</span>
<span class="org-string">  -a --all               Show all properties, including empty ones</span>
<span class="org-string">  -l --full              Do not ellipsize output</span>
<span class="org-string">     --kill-who=WHO      Who to send signal to</span>
<span class="org-string">  -s --signal=SIGNAL     Which signal to send</span>

<span class="org-string">Commands:</span>
<span class="org-string">  list-sessions            List sessions</span>
<span class="org-string">  session-status ID...     Show session status</span>
<span class="org-string">  show-session [ID...]     Show properties of sessions or the manager</span>
<span class="org-string">  activate ID              Activate a session</span>
<span class="org-string">lock-session ID...       Screen lock one or more sessions</span>
<span class="org-string">unlock-session ID...     Screen unlock one or more sessions</span>
<span class="org-string">lock-sessions            Screen lock all current sessions</span>
<span class="org-string">unlock-sessions          Screen unlock all current sessions</span>
<span class="org-string">terminate-session ID...  Terminate one or more sessions</span>
<span class="org-string">kill-session ID...       Send signal to processes of a session</span>
<span class="org-string">list-users               List users</span>
<span class="org-string">user-status USER...      Show user status</span>
<span class="org-string">show-user [USER...]      Show properties of users or the manager</span>
<span class="org-string">enable-linger USER...    Enable linger state of one or more users</span>
<span class="org-string">disable-linger USER...   Disable linger state of one or more users</span>
<span class="org-string">terminate-user USER...   Terminate all sessions of one or more users</span>
<span class="org-string">kill-user USER...        Send signal to processes of a user</span>
<span class="org-string">list-seats               List seats</span>
<span class="org-string">seat-status NAME...      Show seat status</span>
<span class="org-string">show-seat NAME...        Show properties of one or more seats</span>
<span class="org-string">attach NAME DEVICE...    Attach one or more devices to a seat</span>
<span class="org-string">flush-devices            Flush all device associations</span>
<span class="org-string">terminate-seat NAME...   Terminate all sessions on one or more seats</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd45a499" class="outline-3">
<h3 id="orgd45a499"><span class="section-number-3">2.6</span> Systemd系统和服务管理：systemctl</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-orge787dc0" class="outline-4">
<h4 id="orge787dc0"><span class="section-number-4">2.6.1</span> example</h4>
<div class="outline-text-4" id="text-2-6-1">
</div>
<div id="outline-container-orga23975d" class="outline-5">
<h5 id="orga23975d"><span class="section-number-5">2.6.1.1</span> 显示已知units：systemctl list-units [PATTERN&#x2026;]</h5>
<div class="outline-text-5" id="text-2-6-1-1">
<div class="org-src-container">
<pre class="src src-sh">~$ systemctl list-units
  UNIT                         LOAD   ACTIVE SUB       DESCRIPTION
  proc-sys-fs-binfmt_misc.automount loaded active running   Arbitrary Executable Fil
  sys-devices-pci0000:00-0000:00:02.0-drm-card0-card0\x2dLVDS\x2d1-intel_backlight.d
  sys-devices-pci0000:00-0000:00:14.0-usb3-3\x2d2-3\x2d2:1.0-host6-target6:0:0-6:0:0
  sys-devices-pci0000:00-0000:00:14.0-usb3-3\x2d2-3\x2d2:1.0-host6-target6:0:0-6:0:0
  sys-devices-pci0000:00-0000:00:16.3-tty-ttyS0.device loaded active plugged   7 Ser
  sys-devices-pci0000:00-0000:00:19.0-net-eth0.device loaded active plugged   82579L
  sys-devices-pci0000:00-0000:00:1a.0-usb1-1\x2d1-1\x2d1.4-1\x2d1.4:1.0-bluetooth-hc
  sys-devices-pci0000:00-0000:00:1a.0-usb1-1\x2d1-1\x2d1.4-1\x2d1.4:1.0-bluetooth-hc
  sys-devices-pci0000:00-0000:00:1b.0-sound-card0.device loaded active plugged   7 S
  sys-devices-pci0000:00-0000:00:1c.1-0000:03:00.0-ieee80211-phy0-rfkill2.device loa
  sys-devices-pci0000:00-0000:00:1c.1-0000:03:00.0-net-wlan0.device loaded active pl
  sys-devices-pci0000:00-0000:00:1f.2-ata1-host0-target0:0:0-0:0:0:0-block-sda-sda1.
  sys-devices-pci0000:00-0000:00:1f.2-ata1-host0-target0:0:0-0:0:0:0-block-sda-sda2.
~$ systemctl list-units <span class="org-string">'*ssh*'</span>
UNIT        LOAD   ACTIVE SUB     DESCRIPTION
ssh.service loaded active running OpenBSD Secure Shell server

LOAD   = Reflects whether the unit definition was properly loaded.
ACTIVE = The high-level unit activation state, i.e. generalization of SUB.
SUB    = The low-level unit activation state, values depend on unit type.

1 loaded units listed. Pass --all to see loaded but inactive units, too.
To show all installed unit files use <span class="org-string">'systemctl list-unit-files'</span>.

~$ systemctl list-units --all
  UNIT                        LOAD      ACTIVE   SUB       DESCRIPTION
  proc-sys-fs-binfmt_misc.automount loaded    active   running   Arbitrary Executabl
  dev-disk-by\x2did-ata\x2dSamsung_SSD_850_EVO_250GB_S2R7NX0H704812X.device loaded
  dev-disk-by\x2did-ata\x2dSamsung_SSD_850_EVO_250GB_S2R7NX0H704812X\x2dpart1.device
  dev-disk-by\x2did-ata\x2dSamsung_SSD_850_EVO_250GB_S2R7NX0H704812X\x2dpart2.device
  dev-disk-by\x2did-ata\x2dSamsung_SSD_850_EVO_250GB_S2R7NX0H704812X\x2dpart3.device
  dev-disk-by\x2did-ata\x2dSamsung_SSD_850_EVO_250GB_S2R7NX0H704812X\x2dpart4.device
  dev-disk-by\x2did-ata\x2dST2000LM007\x2d1R8174_WCC12JNZ.device loaded    active
  dev-disk-by\x2did-ata\x2dST2000LM007\x2d1R8174_WCC12JNZ\x2dpart1.device loaded
&#9679; var-lock.mount              not-found inactive dead      var-lock.mount
&#9679; var-run.mount               not-found inactive dead      var-run.mount
  acpid.path                  loaded    active   running   ACPI Events Check
  alsa-restore.service        loaded    inactive dead      Restore Sound Card State
</pre>
</div>
</div>
</div>

<div id="outline-container-org892bfe6" class="outline-5">
<h5 id="org892bfe6"><span class="section-number-5">2.6.1.2</span> 显示安装的unit文件：list-unit-files [PATTERN&#x2026;]</h5>
<div class="outline-text-5" id="text-2-6-1-2">
<div class="org-src-container">
<pre class="src src-sh">~$ systemctl list-unit-files | wc -l
263

~$ systemctl list-unit-files
UNIT FILE                                  STATE
proc-sys-fs-binfmt_misc.automount          static
dev-hugepages.mount                        static
dev-mqueue.mount                           static
proc-sys-fs-binfmt_misc.mount              static
sys-fs-fuse-connections.mount              static
sys-kernel-config.mount                    static
sys-kernel-debug.mount                     static
tmp.mount                                  disabled
acpid.path                                 enabled
cups.path                                  enabled
systemd-ask-password-console.path          static
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e234d1" class="outline-5">
<h5 id="org6e234d1"><span class="section-number-5">2.6.1.3</span> systemctl candidates: systemctl with two tabs</h5>
<div class="outline-text-5" id="text-2-6-1-3">
<div class="org-src-container">
<pre class="src src-sh">~$ systemctl
cancel                 is-active              reload-or-restart
cat                    is-enabled             reload-or-try-restart
condreload             is-failed              rescue
condrestart            isolate                reset-failed
condstop               kexec                  restart
daemon-reexec          kill                   set-default
daemon-reload          link                   set-environment
default                list-dependencies      show
delete                 list-jobs              show-environment
disable                list-sockets           snapshot
emergency              list-timers            start
<span class="org-builtin">enable</span>                 list-unit-files        status
<span class="org-keyword">exit</span>                   list-units             stop
force-reload           mask                   suspend
get-default            poweroff               try-restart
halt                   preset                 unmask
<span class="org-builtin">help</span>                   reboot                 unset-environment
hibernate              reenable
hybrid-sleep           reload
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e88d91" class="outline-4">
<h4 id="org1e88d91"><span class="section-number-4">2.6.2</span> help</h4>
<div class="outline-text-4" id="text-2-6-2">
<div class="org-src-container">
<pre class="src src-sh">~$ systemctl [OPTIONS...] {COMMAND} ...

Query or send control commands to the systemd manager.

  -h --help           Show this help
     --version        Show package version
     --system         Connect to system manager
     --user           Connect to user service manager
  -H --host=[USER@]HOST
                      Operate on remote host
  -M --machine=CONTAINER
                      Operate on local container
  -t --type=TYPE      List only units of a particular type
     --state=STATE    List only units with particular LOAD or SUB or ACTIVE state
  -p --property=NAME  Show only properties by this name
  -a --all            Show all loaded units/properties, including dead/empty
                      ones. To list all units installed on the system, use
                      the <span class="org-string">'list-unit-files'</span> command instead.
  -l --full           Don<span class="org-string">'t ellipsize unit names on output</span>
<span class="org-string">  -r --recursive      Show unit list of host and local containers</span>
<span class="org-string">     --reverse        Show reverse dependencies with '</span>list-dependencies<span class="org-string">'</span>
<span class="org-string">     --job-mode=MODE  Specify how to deal with already queued jobs, when</span>
<span class="org-string">                      queueing a new job</span>
<span class="org-string">     --show-types     When showing sockets, explicitly show their type</span>
<span class="org-string">  -i --ignore-inhibitors</span>
<span class="org-string">                      When shutting down or sleeping, ignore inhibitors</span>
<span class="org-string">     --kill-who=WHO   Who to send signal to</span>
<span class="org-string">  -s --signal=SIGNAL  Which signal to send</span>
<span class="org-string">  -q --quiet          Suppress output</span>
<span class="org-string">     --no-block       Do not wait until operation finished</span>
<span class="org-string">     --no-wall        Don'</span>t send wall message before halt/power-off/reboot
     --no-reload      When enabling/disabling unit files, don<span class="org-string">'t reload daemon</span>
<span class="org-string">                      configuration</span>
<span class="org-string">     --no-legend      Do not print a legend (column headers and hints)</span>
<span class="org-string">     --no-pager       Do not pipe output into a pager</span>
<span class="org-string">     --no-ask-password</span>
<span class="org-string">                      Do not ask for system passwords</span>
<span class="org-string">     --global         Enable/disable unit files globally</span>
<span class="org-string">     --runtime        Enable unit files only temporarily until next reboot</span>
<span class="org-string">  -f --force          When enabling unit files, override existing symlinks</span>
<span class="org-string">                      When shutting down, execute action immediately</span>
<span class="org-string">     --preset-mode=   Specifies whether fully apply presets, or only enable,</span>
<span class="org-string">                      or only disable</span>
<span class="org-string">     --root=PATH      Enable unit files in the specified root directory</span>
<span class="org-string">  -n --lines=INTEGER  Number of journal entries to show</span>
<span class="org-string">  -o --output=STRING  Change journal output mode (short, short-monotonic,</span>
<span class="org-string">                      verbose, export, json, json-pretty, json-sse, cat)</span>
<span class="org-string">     --plain          Print unit dependencies as a list instead of a tree</span>
<span class="org-string">Unit Commands:</span>
<span class="org-string">  list-units [PATTERN...]         List loaded units</span>
<span class="org-string">  list-sockets [PATTERN...]       List loaded sockets ordered by address</span>
<span class="org-string">  list-timers [PATTERN...]        List loaded timers ordered by next elapse</span>
<span class="org-string">  start NAME...                   Start (activate) one or more units</span>
<span class="org-string">  stop NAME...                    Stop (deactivate) one or more units</span>
<span class="org-string">  reload NAME...                  Reload one or more units</span>
<span class="org-string">  restart NAME...                 Start or restart one or more units</span>
<span class="org-string">  try-restart NAME...             Restart one or more units if active</span>
<span class="org-string">  reload-or-restart NAME...       Reload one or more units if possible,</span>
<span class="org-string">                                  otherwise start or restart</span>
<span class="org-string">  reload-or-try-restart NAME...   Reload one or more units if possible,</span>
<span class="org-string">                                  otherwise restart if active</span>
<span class="org-string">  isolate NAME                    Start one unit and stop all others</span>
<span class="org-string">  kill NAME...                    Send signal to processes of a unit</span>
<span class="org-string">  is-active PATTERN...            Check whether units are active</span>
<span class="org-string">  is-failed PATTERN...            Check whether units are failed</span>
<span class="org-string">  status [PATTERN...|PID...]      Show runtime status of one or more units</span>
<span class="org-string">  show [PATTERN...|JOB...]        Show properties of one or more</span>
<span class="org-string">                                  units/jobs or the manager</span>
<span class="org-string">  cat PATTERN...                  Show files and drop-ins of one or more units</span>
<span class="org-string">  set-property NAME ASSIGNMENT... Sets one or more properties of a unit</span>
<span class="org-string">  help PATTERN...|PID...          Show manual for one or more units</span>
<span class="org-string">  reset-failed [PATTERN...]       Reset failed state for all, one, or more</span>
<span class="org-string">                                  units</span>
<span class="org-string">  list-dependencies [NAME]        Recursively show units which are required</span>
<span class="org-string">                                  or wanted by this unit or by which this</span>
<span class="org-string">                                  unit is required or wanted</span>

<span class="org-string">Unit File Commands:</span>
<span class="org-string">  list-unit-files [PATTERN...]    List installed unit files</span>
<span class="org-string">  enable NAME...                  Enable one or more unit files</span>
<span class="org-string">  disable NAME...                 Disable one or more unit files</span>
<span class="org-string">  reenable NAME...                Reenable one or more unit files</span>
<span class="org-string">  preset NAME...                  Enable/disable one or more unit files</span>
<span class="org-string">                                  based on preset configuration</span>
<span class="org-string">  preset-all                      Enable/disable all unit files based on</span>
<span class="org-string">                                  preset configuration</span>
<span class="org-string">  is-enabled NAME...              Check whether unit files are enabled</span>

<span class="org-string">  mask NAME...                    Mask one or more units</span>
<span class="org-string">  unmask NAME...                  Unmask one or more units</span>
<span class="org-string">  link PATH...                    Link one or more units files into</span>
<span class="org-string">                                  the search path</span>
<span class="org-string">  get-default                     Get the name of the default target</span>
<span class="org-string">  set-default NAME                Set the default target</span>

<span class="org-string">Machine Commands:</span>
<span class="org-string">  list-machines [PATTERN...]      List local containers and host</span>

<span class="org-string">Job Commands:</span>
<span class="org-string">  list-jobs [PATTERN...]          List jobs</span>
<span class="org-string">  cancel [JOB...]                 Cancel all, one, or more jobs</span>

<span class="org-string">Snapshot Commands:</span>
<span class="org-string">  snapshot [NAME]                 Create a snapshot</span>
<span class="org-string">  delete NAME...                  Remove one or more snapshots</span>

<span class="org-string">Environment Commands:</span>
<span class="org-string">  show-environment                Dump environment</span>
<span class="org-string">  set-environment NAME=VALUE...   Set one or more environment variables</span>
<span class="org-string">  unset-environment NAME...       Unset one or more environment variables</span>
<span class="org-string">  import-environment NAME...      Import all, one or more environment variables</span>

<span class="org-string">Manager Lifecycle Commands:</span>
<span class="org-string">  daemon-reload                   Reload systemd manager configuration</span>
<span class="org-string">  daemon-reexec                   Reexecute systemd manager</span>

<span class="org-string">System Commands:</span>
<span class="org-string">  is-system-running               Check whether system is fully running</span>
<span class="org-string">  default                         Enter system default mode</span>
<span class="org-string">  rescue                          Enter system rescue mode</span>
<span class="org-string">  emergency                       Enter system emergency mode</span>
<span class="org-string">  halt                            Shut down and halt the system</span>
<span class="org-string">  poweroff                        Shut down and power-off the system</span>
<span class="org-string">  reboot [ARG]                    Shut down and reboot the system</span>
<span class="org-string">  kexec                           Shut down and reboot the system with kexec</span>
<span class="org-string">  exit                            Request user instance exit</span>
<span class="org-string">  switch-root ROOT [INIT]         Change to a different root file system</span>
<span class="org-string">  suspend                         Suspend the system</span>
<span class="org-string">  hibernate                       Hibernate the system</span>
<span class="org-string">  hybrid-sleep                    Hibernate and suspend the system</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orga3a2d64" class="outline-2">
<h2 id="orga3a2d64"><span class="section-number-2">3</span> 学习笔记</h2>
<div class="outline-text-2" id="text-3">
<p>
参考：<a href="systemd.html">systemd学习笔记</a>。
</p>
</div>
</div>

<div id="outline-container-org8e0aef9" class="outline-2">
<h2 id="org8e0aef9"><span class="section-number-2">4</span> 作者</h2>
<div class="outline-text-2" id="text-4">
<p>
Systemd作者<a href="http://0pointer.net/blog/">Lennart Poettering</a>(<a href="http://0pointer.de/lennart/">Homepage</a>, <a href="https://github.com/poettering">GitHub</a>)。
</p>

<p>
因Systemd复杂性，作者受到了很多攻击。他在G+上有过一次口水战：
</p>
<blockquote>
<p>
Much of the Open Source community tries to advertise the community as one happy
place to the outside. Where contributions are valued only by their technical
quality, and everybody meets at conferences for beers.
</p>

<p>
Well, it is not like that. It's quite a sick place to be in.
</p>

<p>
I don't usually talk about this too much, and hence I figure that people are
really not aware of this, but yes, the Open Source community is full of
assholes, and I probably more than most others am one of their most favourite
targets. I get hate mail for hacking on Open Source. People have started
multiple "petitions" on petition web sites, asking me to stop working (google
for it). Recently, people started collecting Bitcoins to hire a hitman for me
(this really happened!). Just the other day, some idiot posted a "song" on
youtube, a creepy work, filled with expletives about me and suggestions of
violence. People post websites about boycotting my projects, containing pretty
personal attacks. On IRC, people /msg me sometimes, with nasty messages, and
references to artwork in 4chan style. And there's more. A lot more.
</p>

<p>
I am used to rough discussions on mailing lists, and yes, when I was younger
I did not always stay technical in flamewars, but nowadays I am pretty good
at that, I am sometimes articulate, but never personal. I have a thick skin
(and so do most of the others involved in systemd, apparently), and I figure
that plays a major role why we managed to bring systemd to success, despite
all the pressure in the opposite direction. But from time to time, I just
have to stand back and say "Wow, what an awful community Linux has!".
</p>

<p>
The Internet is full of deranged people, no doubt, so one might just discount
all of this on the grounds that the Open Source community isn't any different
than any other community on the Internet or even offline. But I don't think so.
I am pretty sure there are certain things that foster bad behaviour. On one hand
there are certain communities where it appears to be a lot more accepted to vent
hate, communities that attract a certain kind of people (Hey, Gentoo!) more than
others do. (Yes, the folks who post the stuff they do usually pretty clearly
state from wich community they come).
</p>

<p>
But more importantly, I'd actually put some blame on a certain circle of folks
that play a major role in kernel development, and first and foremost Linus
Torvalds himself. By many he is a considered a role model, but he is quite a bad
one. If he posts words like "[specific folks] &#x2026;should be retroactively aborted.
Who the f*ck does idiotic things like that? How did they not die as babies,
considering that they were likely too stupid to find a tit to suck on?" (google
for it), than that's certainly bad. But what I find particularly appalling is
the fact that he regularly defends this, and advertises this as an efficient way
to run a community. (But it is not just Linus, it's a certain group of people
around him who use the exact same style, some of which semi-publically even
phantasize about the best ways to, &#x2026; well, kill me).
</p>

<p>
But no, it's not an efficient way to run a community. If Linux had success,
then that certainly happened despite, not because of this behaviour.
I am pretty sure the damage being done by this is quite obvious, it not only
sours the tone in the Linux community, it is also teaches new contributors
to adopt the same style, but that only if it doesn't scare them away in the
first place.
</p>

<p>
In other words: A fish rots from the head down.
</p>

<p>
I don't mind using strong language, I don't mind the use of words such as
"fuck", I use the word all the time too, it's really not about that. I must
simply say that I wished it would stay at that, because what actually is
happening is so much worse, and and so much more hateful.
</p>

<p>
If you are a newcomer to Linux, either grow a really thick skin. Or run away,
it's not a friendly place to be in. It is sad that it is that way, but it
certainly is.
</p>

<p>
The Linux community is dominated by western, white, straight, males in their
30s and 40s these days. I perfectly fit in that pattern, and the rubbish they
pour over me is awful. I can only imagine that it is much worse for members
of minorities, or people from different cultural backgrounds, in particular
ones where losing face is a major issue.
</p>

<p>
You know, I can deal with all this shit, and I guess in a way with the energy
we are pushing the changes we propose with we are calling for opposition, so
this post is really not intended to be a call for sympathy. The main point I
want to make with this is to correct a few things about our communities, and
how their are percieved. Open Source isn't a kindergarten. Open Source is
awful in many ways, and people should be aware of this.
</p>

<p>
Not everybody in the Linux community is like this, the vast majority isn't.
Not even all our different communities really have a problem with this at all.
But many do, and the most prominent one, the Linux community as a whole
certainly has.
</p>

<p>
I am not the one to fix any of this, I cannot tell you how one could do it.
And quite frankly, I really don't want to be involved in fixing this. I am
a technical guy, I want to do technical things.
</p>

<p>
My personal conclusion out of all this is mostly just that I don't want to
have much to do with the worst offenders, and the communities they run.
My involvement with the kernel community ended pretty much before it even
started, I never post on LKML, and haven't done in years. Also, in our
own project we are policying posts. We regularly put a few folks on
moderation on the mailing list, and we will continue to do so. Currently,
the systemd community is fantastic, and I really hope we can keep it that way.
</p>

<p>
And that's all about this topic from me. I have no intentions to ever talk
about this again on a public forum.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org2f12d2c" class="outline-2">
<h2 id="org2f12d2c"><span class="section-number-2">5</span> References</h2>
<div class="outline-text-2" id="text-5">
<dl class="org-dl">
<dt>IBM developer works</dt><dd><a href="https://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/index.html">https://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/index.html</a></dd>

<dt>Freedesktop systemd</dt><dd><a href="https://www.freedesktop.org/wiki/Software/systemd/">https://www.freedesktop.org/wiki/Software/systemd/</a></dd>

<dt>CoolShell LINUX PID 1 and Systemd</dt><dd><a href="https://coolshell.cn/articles/17998.html">https://coolshell.cn/articles/17998.html</a></dd>

<dt>ArchLinux Wiki</dt><dd><a href="https://wiki.archlinux.org/index.php/systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">https://wiki.archlinux.org/index.php/systemd_(简体中文)</a></dd>

<dt>阮一峰博客</dt><dd><a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a></dd>

<dt>Dracut project</dt><dd><a href="https://dracut.wiki.kernel.org/index.php/Main_Page">https://dracut.wiki.kernel.org/index.php/Main_Page</a></dd>

<dt>Zh WIKI</dt><dd><a href="https://zh.wikipedia.org/wiki/Systemd">https://zh.wikipedia.org/wiki/Systemd</a></dd>

<dt>Lennart Pottering</dt><dd><a href="http://0pointer.net/blog/">http://0pointer.net/blog/</a></dd>
</dl>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread" class="disqus container"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://ycode.org/blogs/linux-boot-systemd.html';
    this.page.identifier = 'linux-boot-systemd.html';
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://yanyg.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div class="copyright">
2012-2020 Copyright&copy; <i> YANYG - Powered by Emacs Orgmode</i>
</div>
</div>
</body>
</html>
