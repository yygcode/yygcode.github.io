<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<!-- 2019-03-14 Thu 01:08 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Linux Proc Filesystem/Linux Proc文件系统</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yanyg" />
<link rel="stylesheet" type="text/css" href="css/htmlize.css" />
<link rel="stylesheet" type="text/css" href="css/readtheorg.css" />
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="js/readtheorg.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">Linux Proc Filesystem/Linux Proc文件系统</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1d4ca41">1. 介绍</a></li>
<li><a href="#orgc5b7401">2. 分类描述</a>
<ul>
<li><a href="#orgedea9c3">2.1. 内存相关</a></li>
</ul>
</li>
<li><a href="#org0fcfbf5">3. 清单化呈现(字母顺序排序)</a>
<ul>
<li><a href="#buddyinfo">3.1. proc/buddyinfo</a></li>
<li><a href="#orgc86c7aa">3.2. proc/cgroups</a></li>
<li><a href="#orgec91223">3.3. proc/cmdline</a></li>
<li><a href="#orgdf059df">3.4. proc/consoles</a></li>
<li><a href="#org4026a1b">3.5. proc/cpuinfo</a></li>
<li><a href="#orgd874653">3.6. proc/crypto</a></li>
<li><a href="#org17df211">3.7. proc/devices</a></li>
<li><a href="#org6b161cd">3.8. proc/diskstats</a></li>
<li><a href="#org883e48a">3.9. proc/dma</a></li>
<li><a href="#org49a3bf7">3.10. proc/execdomains</a></li>
<li><a href="#org8151505">3.11. proc/fb</a></li>
<li><a href="#org6884369">3.12. proc/filesystems</a></li>
<li><a href="#orgdeb47d6">3.13. proc/fs</a></li>
<li><a href="#orgcf0f2f7">3.14. proc/interrups</a></li>
<li><a href="#iomem">3.15. iomem</a></li>
<li><a href="#org92a15c3">3.16. proc/ioports</a></li>
<li><a href="#orgbeb1fa6">3.17. proc/kallsyms</a></li>
<li><a href="#org3522b40">3.18. proc/meminfo</a></li>
<li><a href="#org1b4996a">3.19. proc/&lt;pid&gt;</a>
<ul>
<li><a href="#org468e188">3.19.1. proc/&lt;pid&gt;/oom_adj</a></li>
<li><a href="#org74ca80c">3.19.2. proc/&lt;pid&gt;/oom_score</a></li>
<li><a href="#orga6d148d">3.19.3. proc/&lt;pid&gt;/oom_score_adj</a></li>
<li><a href="#orgd2b620f">3.19.4. proc/&lt;pid&gt;/stack</a></li>
<li><a href="#org75125d5">3.19.5. proc/&lt;pid&gt;/stat</a></li>
<li><a href="#org676c69d">3.19.6. proc/&lt;pid&gt;/statm</a></li>
<li><a href="#org4289172">3.19.7. proc/&lt;pid&gt;/status</a></li>
<li><a href="#orgdf165b6">3.19.8. proc/&lt;pid&gt;/syscall</a></li>
</ul>
</li>
<li><a href="#org5306b71">3.20. proc/self</a></li>
<li><a href="#org0126384">3.21. oom_score</a></li>
</ul>
</li>
<li><a href="#org1dee46d">4. 内核实现</a></li>
<li><a href="#org2af8850">5. 参考资料</a></li>
</ul>
</div>
</div>

<div id="outline-container-org1d4ca41" class="outline-2">
<h2 id="org1d4ca41"><span class="section-number-2">1</span> 介绍</h2>
<div class="outline-text-2" id="text-1">
<p>
proc虚拟文件系统提供用户态与内核态数据交互的方式，一般挂载在/proc，由initrd启动初始化时挂载。proc下绝大多数文件用以导出内核信息，但也有部分允许修改，这些改变一般用于控制内核模块的功能或行为。
</p>
</div>
</div>

<div id="outline-container-orgc5b7401" class="outline-2">
<h2 id="orgc5b7401"><span class="section-number-2">2</span> 分类描述</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgedea9c3" class="outline-3">
<h3 id="orgedea9c3"><span class="section-number-3">2.1</span> 内存相关</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li><a href="#buddyinfo">proc/buddyinfo</a></li>
<li>/proc/slabinfo</li>
<li>/proc/meminfo</li>
<li>/proc/iomem</li>
<li>/proc/ioports</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org0fcfbf5" class="outline-2">
<h2 id="org0fcfbf5"><span class="section-number-2">3</span> 清单化呈现(字母顺序排序)</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgf6b20d7" class="outline-3">
<h3 id="buddyinfo"><a id="orgf6b20d7"></a><span class="section-number-3">3.1</span> proc/buddyinfo</h3>
<div class="outline-text-3" id="text-buddyinfo">
<p>
buddyinfo的内容是Linux系统伙伴管理系统的内存呈现，10列分别表示2<sup>nil</sup>0至2^10{} PAGE
内存数量。如下是某系统读取到的内容示例：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/buddyinfo
Node<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span>zone<span class="org-whitespace-space">      </span>DMA<span class="org-whitespace-space">      </span>1<span class="org-whitespace-space">      </span>1<span class="org-whitespace-space">      </span>1<span class="org-whitespace-space">      </span>0<span class="org-whitespace-space">      </span>2<span class="org-whitespace-space">      </span>1<span class="org-whitespace-space">      </span>1<span class="org-whitespace-space">      </span>0<span class="org-whitespace-space">   </span><span class="org-whitespace-space"><span class="org-whitespace-line">   </span></span><span class="org-whitespace-line">1</span><span class="org-whitespace-space"><span class="org-whitespace-line">      </span></span><span class="org-whitespace-line">1</span><span class="org-whitespace-space"><span class="org-whitespace-line">      </span></span><span class="org-whitespace-line">3</span>
Node<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span>zone<span class="org-whitespace-space">    </span>DMA32<span class="org-whitespace-space">    </span>645<span class="org-whitespace-space">    </span>775<span class="org-whitespace-space">    </span>517<span class="org-whitespace-space">    </span>199<span class="org-whitespace-space">     </span>83<span class="org-whitespace-space">      </span>7<span class="org-whitespace-space">     </span>20<span class="org-whitespace-space">     </span>93<span class="org-whitespace-space">   </span><span class="org-whitespace-space"><span class="org-whitespace-line">  </span></span><span class="org-whitespace-line">50</span><span class="org-whitespace-space"><span class="org-whitespace-line">      </span></span><span class="org-whitespace-line">8</span><span class="org-whitespace-space"><span class="org-whitespace-line">    </span></span><span class="org-whitespace-line">294</span>
Node<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span>zone<span class="org-whitespace-space">   </span>Normal<span class="org-whitespace-space">    </span>143<span class="org-whitespace-space">    </span>100<span class="org-whitespace-space">     </span>14<span class="org-whitespace-space">     </span>14<span class="org-whitespace-space">      </span>5<span class="org-whitespace-space">      </span>1<span class="org-whitespace-space">      </span>3<span class="org-whitespace-space">      </span>2<span class="org-whitespace-space">   </span><span class="org-whitespace-space"><span class="org-whitespace-line">   </span></span><span class="org-whitespace-line">1</span><span class="org-whitespace-space"><span class="org-whitespace-line">      </span></span><span class="org-whitespace-line">2</span><span class="org-whitespace-space"><span class="org-whitespace-line">      </span></span><span class="org-whitespace-line">0</span>
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/mm/vmstat.c#L1539">linux/mm/vmstat.c</a>:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">buddyinfo_file_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>fragmentation_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc86c7aa" class="outline-3">
<h3 id="orgc86c7aa"><span class="section-number-3">3.2</span> proc/cgroups</h3>
<div class="outline-text-3" id="text-3-2">
<p>
cgroups(Control Groups)是Linux资源管理的特性，实现分级分组进行资源限制和监控。通过伪文件系统cgroupfs提供交互接口。<a href="http://man7.org/linux/man-pages/man7/cgroups.7.html">man 7 cgroups</a>获取详细信息。
</p>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/cmdline.c">fs/proc/cmdline.c</a>:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">cmdline_proc_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span>seq_printf(m,<span class="org-whitespace-space"> </span><span class="org-string">"%s\n"</span>,<span class="org-whitespace-space"> </span>saved_command_line);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">cmdline_proc_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>single_open(file,<span class="org-whitespace-space"> </span>cmdline_proc_show,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">cmdline_proc_fops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>cmdline_proc_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>single_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_cmdline_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"cmdline"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;cmdline_proc_fops);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">fs_initcall</span>(proc_cmdline_init);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/cgroups
<span class="org-comment-delimiter">#</span><span class="org-comment">subsys_name</span><span class="org-whitespace-space">    </span><span class="org-comment">hierarchy</span><span class="org-whitespace-space">       </span><span class="org-comment">num_cgroups</span><span class="org-whitespace-space">     </span><span class="org-comment">enabled</span>
cpuset<span class="org-whitespace-space">  </span>2<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
cpu<span class="org-whitespace-space">     </span>3<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
cpuacct<span class="org-whitespace-space"> </span>3<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
memory<span class="org-whitespace-space">  </span>0<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>0
devices<span class="org-whitespace-space"> </span>4<span class="org-whitespace-space">       </span>76<span class="org-whitespace-space">      </span>1
freezer<span class="org-whitespace-space"> </span>5<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
net_cls<span class="org-whitespace-space"> </span>6<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
blkio<span class="org-whitespace-space">   </span>7<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
perf_event<span class="org-whitespace-space">      </span>8<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
net_prio<span class="org-whitespace-space">        </span>6<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space">       </span>1
</pre>
</div>

<p>
<a href="http://man7.org/linux/man-pages/man7/cgroups.7.html">Man7</a>信息截取：
</p>
<blockquote>
<p>
Control cgroups, usually referred to as cgroups, are a Linux kernel
feature which allow processes to be organized into hierarchical
groups whose usage of various types of resources can then be limited
and monitored.  The kernel's cgroup interface is provided through a
pseudo-filesystem called cgroupfs.  Grouping is implemented in the
core cgroup kernel code, while resource tracking and limits are
implemented in a set of per-resource-type subsystems (memory, CPU,
and so on).
</p>

<p>
Terminology
    A cgroup is a collection of processes that are bound to a set of
    limits or parameters defined via the cgroup filesystem.
</p>

<p>
A subsystem is a kernel component that modifies the behavior of the
processes in a cgroup.  Various subsystems have been implemented,
making it possible to do things such as limiting the amount of CPU
time and memory available to a cgroup, accounting for the CPU time
used by a cgroup, and freezing and resuming execution of the
processes in a cgroup.  Subsystems are sometimes also known as
resource controllers (or simply, controllers).
</p>

<p>
The cgroups for a controller are arranged in a hierarchy.  This
hierarchy is defined by creating, removing, and renaming
subdirectories within the cgroup filesystem.  At each level of the
hierarchy, attributes (e.g., limits) can be defined.  The limits,
control, and accounting provided by cgroups generally have effect
throughout the subhierarchy underneath the cgroup where the
attributes are defined.  Thus, for example, the limits placed on a
cgroup at a higher level in the hierarchy cannot be exceeded by
descendant cgroups.
</p>

<p>
Cgroups version 1 controllers
    Each of the cgroups version 1 controllers is governed by a kernel
    configuration option (listed below).  Additionally, the availability
    of the cgroups feature is governed by the CONFIG_CGROUPS kernel con‐
    figuration option.
</p>

<p>
cpu (since Linux 2.6.24; CONFIG_CGROUP_SCHED)
       Cgroups can be guaranteed a minimum number of "CPU shares"
       when a system is busy.  This does not limit a cgroup's CPU
       usage if the CPUs are not busy.  For further information, see
       Documentation/scheduler/sched-design-CFS.txt.
</p>

<p>
In Linux 3.2, this controller was extended to provide CPU
"bandwidth" control.  If the kernel is configured with CON‐
FIG_CFS_BANDWIDTH, then within each scheduling period (defined
via a file in the cgroup directory), it is possible to define
an upper limit on the CPU time allocated to the processes in a
cgroup.  This upper limit applies even if there is no other
competition for the CPU.  Further information can be found in
the kernel source file Documentation/scheduler/sched-bwc.txt.
</p>

<p>
cpuacct (since Linux 2.6.24; CONFIG_CGROUP_CPUACCT)
       This provides accounting for CPU usage by groups of processes.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/cpuacct.txt.
</p>

<p>
cpuset (since Linux 2.6.24; CONFIG_CPUSETS)
       This cgroup can be used to bind the processes in a cgroup to a
       specified set of CPUs and NUMA nodes.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/cpusets.txt.
</p>

<p>
memory (since Linux 2.6.25; CONFIG_MEMCG)
       The memory controller supports reporting and limiting of
       process memory, kernel memory, and swap used by cgroups.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/memory.txt.
</p>

<p>
devices (since Linux 2.6.26; CONFIG_CGROUP_DEVICE)
       This supports controlling which processes may create (mknod)
       devices as well as open them for reading or writing.  The
       policies may be specified as whitelists and blacklists.  Hier‐
       archy is enforced, so new rules must not violate existing
       rules for the target or ancestor cgroups.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/devices.txt.
</p>

<p>
freezer (since Linux 2.6.28; CONFIG_CGROUP_FREEZER)
       The freezer cgroup can suspend and restore (resume) all pro‐
       cesses in a cgroup.  Freezing a cgroup /A also causes its
       children, for example, processes in /A/B, to be frozen.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/freezer-subsystem.txt.
</p>

<p>
net_cls (since Linux 2.6.29; CONFIG_CGROUP_NET_CLASSID)
       This places a classid, specified for the cgroup, on network
       packets created by a cgroup.  These classids can then be used
       in firewall rules, as well as used to shape traffic using
       tc(8).  This applies only to packets leaving the cgroup, not
       to traffic arriving at the cgroup.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/net_cls.txt.
</p>

<p>
blkio (since Linux 2.6.33; CONFIG_BLK_CGROUP)
       The blkio cgroup controls and limits access to specified block
       devices by applying IO control in the form of throttling and
       upper limits against leaf nodes and intermediate nodes in the
       storage hierarchy.
</p>

<p>
Two policies are available.  The first is a proportional-
weight time-based division of disk implemented with CFQ.  This
is in effect for leaf nodes using CFQ.  The second is a throt‐
tling policy which specifies upper I/O rate limits on a
device.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/blkio-controller.txt.
</p>

<p>
perf_event (since Linux 2.6.39; CONFIG_CGROUP_PERF)
       This controller allows perf monitoring of the set of processes
       grouped in a cgroup.
</p>

<p>
Further information can be found in the kernel source file
tools/perf/Documentation/perf-record.txt.
</p>

<p>
net_prio (since Linux 3.3; CONFIG_CGROUP_NET_PRIO)
       This allows priorities to be specified, per network interface,
       for cgroups.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/net_prio.txt.
</p>

<p>
hugetlb (since Linux 3.5; CONFIG_CGROUP_HUGETLB)
       This supports limiting the use of huge pages by cgroups.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/hugetlb.txt.
</p>

<p>
pids (since Linux 4.3; CONFIG_CGROUP_PIDS)
       This controller permits limiting the number of process that
       may be created in a cgroup (and its descendants).
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/pids.txt.
</p>

<p>
rdma (since Linux 4.11; CONFIG_CGROUP_RDMA)
       The RDMA controller permits limiting the use of RDMA/IB-spe‐
       cific resources per cgroup.
</p>

<p>
Further information can be found in the kernel source file
Documentation/cgroup-v1/rdma.txt.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgec91223" class="outline-3">
<h3 id="orgec91223"><span class="section-number-3">3.3</span> proc/cmdline</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Linux系统引导参数：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/cmdline
<span class="org-variable-name">BOOT_IMAGE</span>=/vmlinuz-3.16.0-4-amd64<span class="org-whitespace-space"> </span><span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=62c7ce2d-be7b-43d1-b9e1-6002ee63577<span class="org-whitespace-line">d</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">ro</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">quiet</span>
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/cmdline.c">fs/proc/cmdline.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">cmdline_proc_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span>seq_printf(m,<span class="org-whitespace-space"> </span><span class="org-string">"%s\n"</span>,<span class="org-whitespace-space"> </span>saved_command_line);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">cmdline_proc_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>single_open(file,<span class="org-whitespace-space"> </span>cmdline_proc_show,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">cmdline_proc_fops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>cmdline_proc_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>single_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_cmdline_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"cmdline"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;cmdline_proc_fops);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">fs_initcall</span>(proc_cmdline_init);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf059df" class="outline-3">
<h3 id="orgdf059df"><span class="section-number-3">3.4</span> proc/consoles</h3>
<div class="outline-text-3" id="text-3-4">
<p>
consoles显示系统中所有可见的console信息。
</p>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/consoles.c">fs/proc/consoles.c</a>:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">consoles_op</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-tab">  </span>=<span class="org-whitespace-space"> </span>c_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>c_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>c_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>show_console_dev
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">consoles_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;consoles_op);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_consoles_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>consoles_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_consoles_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"consoles"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_consoles_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">fs_initcall</span>(proc_consoles_init);
</pre>
</div>
</div>
</div>

<div id="outline-container-org4026a1b" class="outline-3">
<h3 id="org4026a1b"><span class="section-number-3">3.5</span> proc/cpuinfo</h3>
<div class="outline-text-3" id="text-3-5">
<p>
cpuinfo显示CPU相关信息：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/cpuinfo
processor<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>0
vendor_id<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>GenuineIntel
cpu<span class="org-whitespace-space"> </span>family<span class="org-whitespace-space">      </span>:<span class="org-whitespace-space"> </span>6
model<span class="org-whitespace-space">           </span>:<span class="org-whitespace-space"> </span>60
model<span class="org-whitespace-space"> </span>name<span class="org-whitespace-space">      </span>:<span class="org-whitespace-space"> </span>Intel(R)<span class="org-whitespace-space"> </span>Core(TM)<span class="org-whitespace-space"> </span>i5-4570<span class="org-whitespace-space"> </span>CPU<span class="org-whitespace-space"> </span>@<span class="org-whitespace-space"> </span>3.20GHz
stepping<span class="org-whitespace-space">        </span>:<span class="org-whitespace-space"> </span>3
microcode<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>0x1c
cpu<span class="org-whitespace-space"> </span>MHz<span class="org-whitespace-space">         </span>:<span class="org-whitespace-space"> </span>3200.390
cache<span class="org-whitespace-space"> </span>size<span class="org-whitespace-space">      </span>:<span class="org-whitespace-space"> </span>6144<span class="org-whitespace-space"> </span>KB
physical<span class="org-whitespace-space"> </span>id<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>0
siblings<span class="org-whitespace-space">        </span>:<span class="org-whitespace-space"> </span>4
core<span class="org-whitespace-space"> </span>id<span class="org-whitespace-space">         </span>:<span class="org-whitespace-space"> </span>0
cpu<span class="org-whitespace-space"> </span>cores<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>4
apicid<span class="org-whitespace-space">          </span>:<span class="org-whitespace-space"> </span>0
initial<span class="org-whitespace-space"> </span>apicid<span class="org-whitespace-space">  </span>:<span class="org-whitespace-space"> </span>0
fpu<span class="org-whitespace-space">             </span>:<span class="org-whitespace-space"> </span>yes
fpu_exception<span class="org-whitespace-space">   </span>:<span class="org-whitespace-space"> </span>yes
cpuid<span class="org-whitespace-space"> </span>level<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>13
wp<span class="org-whitespace-space">              </span>:<span class="org-whitespace-space"> </span>yes
flags<span class="org-whitespace-space">           </span>:<span class="org-whitespace-space"> </span>fpu<span class="org-whitespace-space"> </span>vme<span class="org-whitespace-space"> </span>de<span class="org-whitespace-space"> </span>pse<span class="org-whitespace-space"> </span>tsc<span class="org-whitespace-space"> </span>msr<span class="org-whitespace-space"> </span>pae<span class="org-whitespace-space"> </span>mce<span class="org-whitespace-space"> </span>cx8<span class="org-whitespace-space"> </span>apic<span class="org-whitespace-space"> </span>sep<span class="org-whitespace-space"> </span>mtrr<span class="org-whitespace-space"> </span>pge<span class="org-whitespace-space"> </span>mca<span class="org-whitespace-space"> </span>cmov<span class="org-whitespace-space"> </span><span class="org-whitespace-line">pat</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">pse36</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">clflush</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">dts</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">acpi</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">mmx</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">fxsr</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">sse</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">sse2</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">ss</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">ht</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">tm</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">pbe</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">syscall</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">n</span>
x<span class="org-whitespace-space"> </span>pdpe1gb<span class="org-whitespace-space"> </span>rdtscp<span class="org-whitespace-space"> </span>lm<span class="org-whitespace-space"> </span>constant_tsc<span class="org-whitespace-space"> </span>arch_perfmon<span class="org-whitespace-space"> </span>pebs<span class="org-whitespace-space"> </span>bts<span class="org-whitespace-space"> </span>rep_good<span class="org-whitespace-space"> </span>nopl<span class="org-whitespace-space"> </span>xtopology<span class="org-whitespace-space"> </span>n<span class="org-whitespace-line">onstop_tsc</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">aperfmperf</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">eagerfpu</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">pni</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">pclmulqdq</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">dtes64</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">monitor</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">ds_cpl</span>
vmx<span class="org-whitespace-space"> </span>smx<span class="org-whitespace-space"> </span>est<span class="org-whitespace-space"> </span>tm2<span class="org-whitespace-space"> </span>ssse3<span class="org-whitespace-space"> </span>sdbg<span class="org-whitespace-space"> </span>fma<span class="org-whitespace-space"> </span>cx16<span class="org-whitespace-space"> </span>xtpr<span class="org-whitespace-space"> </span>pdcm<span class="org-whitespace-space"> </span>pcid<span class="org-whitespace-space"> </span>sse4_1<span class="org-whitespace-space"> </span>sse4_2<span class="org-whitespace-space"> </span>x2apic<span class="org-whitespace-space"> </span>movbe<span class="org-whitespace-space"> </span>po<span class="org-whitespace-line">pcnt</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">tsc_deadline_timer</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">aes</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">xsave</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">avx</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">f16c</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">rdrand</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">lahf_lm</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">abm</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">epb</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">t</span>
pr_shadow<span class="org-whitespace-space"> </span>vnmi<span class="org-whitespace-space"> </span>flexpriority<span class="org-whitespace-space"> </span>ept<span class="org-whitespace-space"> </span>vpid<span class="org-whitespace-space"> </span>fsgsbase<span class="org-whitespace-space"> </span>tsc_adjust<span class="org-whitespace-space"> </span>bmi1<span class="org-whitespace-space"> </span>avx2<span class="org-whitespace-space"> </span>smep<span class="org-whitespace-space"> </span>bmi2<span class="org-whitespace-space"> </span>erm<span class="org-whitespace-line">s</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">invpcid</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">xsaveopt</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">dtherm</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">ida</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">arat</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">pln</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">pts</span>
bugs<span class="org-whitespace-space">            </span>:
bogomips<span class="org-whitespace-space">        </span>:<span class="org-whitespace-space"> </span>6384.87
clflush<span class="org-whitespace-space"> </span>size<span class="org-whitespace-space">    </span>:<span class="org-whitespace-space"> </span>64
cache_alignment<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>64
address<span class="org-whitespace-space"> </span>sizes<span class="org-whitespace-space">   </span>:<span class="org-whitespace-space"> </span>39<span class="org-whitespace-space"> </span>bits<span class="org-whitespace-space"> </span>physical,<span class="org-whitespace-space"> </span>48<span class="org-whitespace-space"> </span>bits<span class="org-whitespace-space"> </span>virtual
power<span class="org-whitespace-space"> </span>management:

processor<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>1
vendor_id<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>GenuineIntel
cpu<span class="org-whitespace-space"> </span>family<span class="org-whitespace-space">      </span>:<span class="org-whitespace-space"> </span>6
model<span class="org-whitespace-space">           </span>:<span class="org-whitespace-space"> </span>60
model<span class="org-whitespace-space"> </span>name<span class="org-whitespace-space">      </span>:<span class="org-whitespace-space"> </span>Intel(R)<span class="org-whitespace-space"> </span>Core(TM)<span class="org-whitespace-space"> </span>i5-4570<span class="org-whitespace-space"> </span>CPU<span class="org-whitespace-space"> </span>@<span class="org-whitespace-space"> </span>3.20GHz
stepping<span class="org-whitespace-space">        </span>:<span class="org-whitespace-space"> </span>3
...
</pre>
</div>

<p>
内核代码由平台无关<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/cpuinfo.c">fs/proc/cpuinfo.c</a>和平台相关(<a href="https://elixir.bootlin.com/linux/v4.15.4/source/arch/x86/kernel/cpu/proc.c#L162">arch/x86/kernel/cpu/proc.c</a>)组成：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">cpuinfo_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span>arch_freq_prepare_all();
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;cpuinfo_op);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_cpuinfo_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>cpuinfo_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_cpuinfo_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"cpuinfo"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_cpuinfo_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">fs_initcall</span>(proc_cpuinfo_init);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd874653" class="outline-3">
<h3 id="orgd874653"><span class="section-number-3">3.6</span> proc/crypto</h3>
<div class="outline-text-3" id="text-3-6">
<p>
crypto显示系统支持的密码算法。部分内容示例如下：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/crypto
name<span class="org-whitespace-space">         </span>:<span class="org-whitespace-space"> </span>crct10dif
driver<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>crct10dif-pclmul
module<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>crct10dif_pclmul
priority<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>200
refcnt<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>1
selftest<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>passed
internal<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>no
<span class="org-builtin">type</span><span class="org-whitespace-space">         </span>:<span class="org-whitespace-space"> </span>shash
blocksize<span class="org-whitespace-space">    </span>:<span class="org-whitespace-space"> </span>1
digestsize<span class="org-whitespace-space">   </span>:<span class="org-whitespace-space"> </span>2
...
name<span class="org-whitespace-space">         </span>:<span class="org-whitespace-space"> </span>sha1
driver<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>sha1-generic
module<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>kernel
priority<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>0
refcnt<span class="org-whitespace-space">       </span>:<span class="org-whitespace-space"> </span>1
selftest<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>passed
internal<span class="org-whitespace-space">     </span>:<span class="org-whitespace-space"> </span>no
<span class="org-builtin">type</span><span class="org-whitespace-space">         </span>:<span class="org-whitespace-space"> </span>shash
blocksize<span class="org-whitespace-space">    </span>:<span class="org-whitespace-space"> </span>64
digestsize<span class="org-whitespace-space">   </span>:<span class="org-whitespace-space"> </span>20
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/crypto/proc.c#L103">crypto/proc.c</a>:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">crypto_seq_ops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-tab">          </span>=<span class="org-whitespace-space"> </span>c_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>c_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>c_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>c_show
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">crypto_info_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;crypto_seq_ops);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_crypto_ops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>crypto_info_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release
};

<span class="org-type">void</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>crypto_init_proc(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"crypto"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_crypto_ops);
}

<span class="org-type">void</span><span class="org-whitespace-space"> </span><span class="org-function-name">__exit</span><span class="org-whitespace-space"> </span>crypto_exit_proc(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>remove_proc_entry(<span class="org-string">"crypto"</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org17df211" class="outline-3">
<h3 id="org17df211"><span class="section-number-3">3.7</span> proc/devices</h3>
<div class="outline-text-3" id="text-3-7">
<p>
devices显示字符设备和块设备主设备号。如下：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/devices
Character<span class="org-whitespace-space"> </span>devices:
<span class="org-whitespace-space">  </span>1<span class="org-whitespace-space"> </span>mem
<span class="org-whitespace-space">  </span>4<span class="org-whitespace-space"> </span>/dev/vc/0
<span class="org-whitespace-space">  </span>4<span class="org-whitespace-space"> </span>tty
<span class="org-whitespace-space">  </span>4<span class="org-whitespace-space"> </span>ttyS
<span class="org-whitespace-space">  </span>5<span class="org-whitespace-space"> </span>/dev/tty
<span class="org-whitespace-space">  </span>5<span class="org-whitespace-space"> </span>/dev/console
<span class="org-whitespace-space">  </span>5<span class="org-whitespace-space"> </span>/dev/ptmx
<span class="org-whitespace-space">  </span>6<span class="org-whitespace-space"> </span>lp
<span class="org-whitespace-space">  </span>7<span class="org-whitespace-space"> </span>vcs
<span class="org-whitespace-space"> </span>10<span class="org-whitespace-space"> </span>misc
<span class="org-whitespace-space"> </span>13<span class="org-whitespace-space"> </span>input
<span class="org-whitespace-space"> </span>21<span class="org-whitespace-space"> </span>sg
<span class="org-whitespace-space"> </span>29<span class="org-whitespace-space"> </span>fb
<span class="org-whitespace-space"> </span>81<span class="org-whitespace-space"> </span>video4linux
<span class="org-whitespace-space"> </span>99<span class="org-whitespace-space"> </span>ppdev
116<span class="org-whitespace-space"> </span>alsa
128<span class="org-whitespace-space"> </span>ptm
136<span class="org-whitespace-space"> </span>pts
180<span class="org-whitespace-space"> </span>usb
189<span class="org-whitespace-space"> </span>usb_device
216<span class="org-whitespace-space"> </span>rfcomm

...

253<span class="org-whitespace-space"> </span>tpm
254<span class="org-whitespace-space"> </span>gpiochip

Block<span class="org-whitespace-space"> </span>devices:
259<span class="org-whitespace-space"> </span>blkext
<span class="org-whitespace-space">  </span>8<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>65<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>66<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>67<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>68<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>69<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>70<span class="org-whitespace-space"> </span>sd
<span class="org-whitespace-space"> </span>71<span class="org-whitespace-space"> </span>sd
128<span class="org-whitespace-space"> </span>sd
129<span class="org-whitespace-space"> </span>sd
130<span class="org-whitespace-space"> </span>sd
131<span class="org-whitespace-space"> </span>sd
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/devices.c">fs/proc/devices.c</a>:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">devinfo_ops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>devinfo_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-space">  </span>=<span class="org-whitespace-space"> </span>devinfo_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-space">  </span>=<span class="org-whitespace-space"> </span>devinfo_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-space">  </span>=<span class="org-whitespace-space"> </span>devinfo_show
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">devinfo_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">filp</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(filp,<span class="org-whitespace-space"> </span>&amp;devinfo_ops);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_devinfo_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>devinfo_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_devices_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"devices"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_devinfo_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">fs_initcall</span>(proc_devices_init);

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">devinfo_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">f</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">i</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>*(<span class="org-type">loff_t</span><span class="org-whitespace-space"> </span>*)<span class="org-whitespace-space"> </span>v;

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>&lt;<span class="org-whitespace-space"> </span>CHRDEV_MAJOR_MAX)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>0)
<span class="org-whitespace-space">                        </span>seq_puts(f,<span class="org-whitespace-space"> </span><span class="org-string">"Character</span><span class="org-whitespace-space"> </span><span class="org-string">devices:\n"</span>);
<span class="org-whitespace-space">                </span>chrdev_show(f,<span class="org-whitespace-space"> </span>i);
<span class="org-whitespace-space">        </span>}
<span class="org-preprocessor">#ifdef</span><span class="org-whitespace-space"> </span>CONFIG_BLOCK
<span class="org-whitespace-space">        </span><span class="org-keyword">else</span><span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>i<span class="org-whitespace-space"> </span>-=<span class="org-whitespace-space"> </span>CHRDEV_MAJOR_MAX;
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>0)
<span class="org-whitespace-space">                        </span>seq_puts(f,<span class="org-whitespace-space"> </span><span class="org-string">"\nBlock</span><span class="org-whitespace-space"> </span><span class="org-string">devices:\n"</span>);
<span class="org-whitespace-space">                </span>blkdev_show(f,<span class="org-whitespace-space"> </span>i);
<span class="org-whitespace-space">        </span>}
<span class="org-preprocessor">#endif</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-type">void</span><span class="org-whitespace-space"> </span><span class="org-function-name">chrdev_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">f</span>,<span class="org-whitespace-space"> </span><span class="org-type">off_t</span><span class="org-whitespace-space"> </span><span class="org-variable-name">offset</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">char_device_struct</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">cd</span>;

<span class="org-whitespace-space">        </span>mutex_lock(&amp;chrdevs_lock);
<span class="org-whitespace-space">        </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(cd<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>chrdevs[major_to_index(offset)];<span class="org-whitespace-space"> </span>cd;<span class="org-whitespace-space"> </span>cd<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>cd-&gt;next)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(cd-&gt;major<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>offset)
<span class="org-whitespace-space">                        </span>seq_printf(f,<span class="org-whitespace-space"> </span><span class="org-string">"%3d</span><span class="org-whitespace-space"> </span><span class="org-string">%s\n"</span>,<span class="org-whitespace-space"> </span>cd-&gt;major,<span class="org-whitespace-space"> </span>cd-&gt;name);
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span>mutex_unlock(&amp;chrdevs_lock);
}

<span class="org-type">void</span><span class="org-whitespace-space"> </span><span class="org-function-name">blkdev_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">seqf</span>,<span class="org-whitespace-space"> </span><span class="org-type">off_t</span><span class="org-whitespace-space"> </span><span class="org-variable-name">offset</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">blk_major_name</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">dp</span>;

<span class="org-whitespace-space">        </span>mutex_lock(&amp;block_class_lock);
<span class="org-whitespace-space">        </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(dp<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>major_names[major_to_index(offset)];<span class="org-whitespace-space"> </span>dp;<span class="org-whitespace-space"> </span>dp<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>dp-&gt;next)
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(dp-&gt;major<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>offset)
<span class="org-whitespace-space">                        </span>seq_printf(seqf,<span class="org-whitespace-space"> </span><span class="org-string">"%3d</span><span class="org-whitespace-space"> </span><span class="org-string">%s\n"</span>,<span class="org-whitespace-space"> </span>dp-&gt;major,<span class="org-whitespace-space"> </span>dp-&gt;name);
<span class="org-whitespace-space">        </span>mutex_unlock(&amp;block_class_lock);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b161cd" class="outline-3">
<h3 id="org6b161cd"><span class="section-number-3">3.8</span> proc/diskstats</h3>
<div class="outline-text-3" id="text-3-8">
<p>
diskstats显示disk统计信息。如下是示例，输出内容解析参考<a href="https://elixir.bootlin.com/linux/v4.15.4/source/Documentation/iostats.txt">Documentation/iostats.txt</a>：
</p>
<div class="org-src-container">
<pre class="src src-sh">cat<span class="org-whitespace-space"> </span>/proc/diskstats
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>16<span class="org-whitespace-space"> </span>sdb<span class="org-whitespace-space"> </span>476<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>37508<span class="org-whitespace-space"> </span>15096<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>2608<span class="org-whitespace-space"> </span>15096
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>17<span class="org-whitespace-space"> </span>sdb1<span class="org-whitespace-space"> </span>50<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4160<span class="org-whitespace-space"> </span>1780<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1780<span class="org-whitespace-space"> </span>1780
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>18<span class="org-whitespace-space"> </span>sdb2<span class="org-whitespace-space"> </span>48<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4144<span class="org-whitespace-space"> </span>1400<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1380<span class="org-whitespace-space"> </span>1400
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>19<span class="org-whitespace-space"> </span>sdb3<span class="org-whitespace-space"> </span>48<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4144<span class="org-whitespace-space"> </span>1952<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1884<span class="org-whitespace-space"> </span>1952
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>20<span class="org-whitespace-space"> </span>sdb4<span class="org-whitespace-space"> </span>2<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4<span class="org-whitespace-space"> </span>176<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>176<span class="org-whitespace-space"> </span>176
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>21<span class="org-whitespace-space"> </span>sdb5<span class="org-whitespace-space"> </span>46<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4128<span class="org-whitespace-space"> </span>2588<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1640<span class="org-whitespace-space"> </span>2588
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>22<span class="org-whitespace-space"> </span>sdb6<span class="org-whitespace-space"> </span>46<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4128<span class="org-whitespace-space"> </span>1052<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1004<span class="org-whitespace-space"> </span>1052
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>23<span class="org-whitespace-space"> </span>sdb7<span class="org-whitespace-space"> </span>48<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4144<span class="org-whitespace-space"> </span>984<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>980<span class="org-whitespace-space"> </span>984
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>24<span class="org-whitespace-space"> </span>sdb8<span class="org-whitespace-space"> </span>50<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4160<span class="org-whitespace-space"> </span>2536<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>2016<span class="org-whitespace-space"> </span>2536
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">      </span>25<span class="org-whitespace-space"> </span>sdb9<span class="org-whitespace-space"> </span>48<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4144<span class="org-whitespace-space"> </span>1188<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1188<span class="org-whitespace-space"> </span>1188
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">       </span>0<span class="org-whitespace-space"> </span>sda<span class="org-whitespace-space"> </span>28874<span class="org-whitespace-space"> </span>1231<span class="org-whitespace-space"> </span>1655786<span class="org-whitespace-space"> </span>10164<span class="org-whitespace-space"> </span>6376<span class="org-whitespace-space"> </span>11927<span class="org-whitespace-space"> </span>340456<span class="org-whitespace-space"> </span>6204<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>5348<span class="org-whitespace-space"> </span>16352
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">       </span>1<span class="org-whitespace-space"> </span>sda1<span class="org-whitespace-space"> </span>52<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>4176<span class="org-whitespace-space"> </span>24<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>16<span class="org-whitespace-space"> </span>24
<span class="org-whitespace-space">   </span>8<span class="org-whitespace-space">       </span>2<span class="org-whitespace-space"> </span>sda2<span class="org-whitespace-space"> </span>28795<span class="org-whitespace-space"> </span>1231<span class="org-whitespace-space"> </span>1649538<span class="org-whitespace-space"> </span>10136<span class="org-whitespace-space"> </span>6225<span class="org-whitespace-space"> </span>11927<span class="org-whitespace-space"> </span>340456<span class="org-whitespace-space"> </span>6068<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>5216<span class="org-whitespace-space"> </span>16188
</pre>
</div>

<p>
各列概要如下：
</p>
<div class="org-src-container">
<pre class="src src-text"><span class="org-whitespace-space"> </span>1<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>major<span class="org-whitespace-space"> </span>number
<span class="org-whitespace-space"> </span>2<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>minor<span class="org-whitespace-space"> </span>mumber
<span class="org-whitespace-space"> </span>3<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>device<span class="org-whitespace-space"> </span>name
<span class="org-whitespace-space"> </span>4<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>reads<span class="org-whitespace-space"> </span>completed<span class="org-whitespace-space"> </span>successfully
<span class="org-whitespace-space"> </span>5<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>reads<span class="org-whitespace-space"> </span>merged
<span class="org-whitespace-space"> </span>6<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>sectors<span class="org-whitespace-space"> </span>read
<span class="org-whitespace-space"> </span>7<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>time<span class="org-whitespace-space"> </span>spent<span class="org-whitespace-space"> </span>reading<span class="org-whitespace-space"> </span>(ms)
<span class="org-whitespace-space"> </span>8<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>writes<span class="org-whitespace-space"> </span>completed
<span class="org-whitespace-space"> </span>9<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>writes<span class="org-whitespace-space"> </span>merged
10<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>sectors<span class="org-whitespace-space"> </span>written
11<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>time<span class="org-whitespace-space"> </span>spent<span class="org-whitespace-space"> </span>writing<span class="org-whitespace-space"> </span>(ms)
12<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>I/Os<span class="org-whitespace-space"> </span>currently<span class="org-whitespace-space"> </span>in<span class="org-whitespace-space"> </span>progress
13<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>time<span class="org-whitespace-space"> </span>spent<span class="org-whitespace-space"> </span>doing<span class="org-whitespace-space"> </span>I/Os<span class="org-whitespace-space"> </span>(ms)
14<span class="org-whitespace-space"> </span>-<span class="org-whitespace-space"> </span>weighted<span class="org-whitespace-space"> </span>time<span class="org-whitespace-space"> </span>spent<span class="org-whitespace-space"> </span>doing<span class="org-whitespace-space"> </span>I/Os<span class="org-whitespace-space"> </span>(ms)
</pre>
</div>

<p>
第4-14列说明如下：
</p>
<p class="verse">
Field  1 &#x2013; # of reads completed<br />
&#xa0;&#xa0;&#xa0;&#xa0;This is the total number of reads completed successfully.<br />
<br />
Field  2 &#x2013; # of reads merged, field 6 &#x2013; # of writes merged<br />
&#xa0;&#xa0;&#xa0;&#xa0;Reads and writes which are adjacent to each other may be merged for<br />
&#xa0;&#xa0;&#xa0;&#xa0;efficiency.  Thus two 4K reads may become one 8K read before it is<br />
&#xa0;&#xa0;&#xa0;&#xa0;ultimately handed to the disk, and so it will be counted (and queued)<br />
&#xa0;&#xa0;&#xa0;&#xa0;as only one I/O.  This field lets you know how often this was done.<br />
<br />
Field  3 &#x2013; # of sectors read<br />
&#xa0;&#xa0;&#xa0;&#xa0;This is the total number of sectors read successfully.<br />
<br />
Field  4 &#x2013; # of milliseconds spent reading<br />
&#xa0;&#xa0;&#xa0;&#xa0;This is the total number of milliseconds spent by all reads (as<br />
&#xa0;&#xa0;&#xa0;&#xa0;measured from __make_request() to end_that_request_last()).<br />
<br />
Field  5 &#x2013; # of writes completed<br />
&#xa0;&#xa0;&#xa0;&#xa0;This is the total number of writes completed successfully.<br />
<br />
Field  6 &#x2013; # of writes merged<br />
&#xa0;&#xa0;&#xa0;&#xa0;See the description of field 2.<br />
<br />
Field  7 &#x2013; # of sectors written<br />
&#xa0;&#xa0;&#xa0;&#xa0;This is the total number of sectors written successfully.<br />
<br />
Field  8 &#x2013; # of milliseconds spent writing<br />
&#xa0;&#xa0;&#xa0;&#xa0;This is the total number of milliseconds spent by all writes (as<br />
&#xa0;&#xa0;&#xa0;&#xa0;measured from __make_request() to end_that_request_last()).<br />
<br />
Field  9 &#x2013; # of I/Os currently in progress<br />
&#xa0;&#xa0;&#xa0;&#xa0;The only field that should go to zero. Incremented as requests are<br />
&#xa0;&#xa0;&#xa0;&#xa0;given to appropriate struct request_queue and decremented as they finish.<br />
<br />
Field 10 &#x2013; # of milliseconds spent doing I/Os<br />
&#xa0;&#xa0;&#xa0;&#xa0;This field increases so long as field 9 is nonzero.<br />
<br />
Field 11 &#x2013; weighted # of milliseconds spent doing I/Os<br />
&#xa0;&#xa0;&#xa0;&#xa0;This field is incremented at each I/O start, I/O completion, I/O<br />
&#xa0;&#xa0;&#xa0;&#xa0;merge, or read of these stats by the number of I/Os in progress<br />
&#xa0;&#xa0;&#xa0;&#xa0;(field 9) times the number of milliseconds spent doing I/O since the<br />
&#xa0;&#xa0;&#xa0;&#xa0;last update of this field.  This can provide an easy measure of both<br />
&#xa0;&#xa0;&#xa0;&#xa0;I/O completion time and the backlog that may be accumulating.<br />
</p>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/block/genhd.c#L1341">block/genhd.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C">
<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">diskstats_op</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-tab">  </span>=<span class="org-whitespace-space"> </span>disk_seqf_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>disk_seqf_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>disk_seqf_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>diskstats_show
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">diskstats_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;diskstats_op);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_diskstats_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>diskstats_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_genhd_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"diskstats"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_diskstats_operations);
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"partitions"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_partitions_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">module_init</span>(proc_genhd_init);

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">diskstats_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">seqf</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">gendisk</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">gp</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>v;
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">disk_part_iter</span><span class="org-whitespace-space"> </span><span class="org-variable-name">piter</span>;
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">hd_struct</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">hd</span>;
<span class="org-whitespace-space">        </span><span class="org-type">char</span><span class="org-whitespace-space"> </span><span class="org-variable-name">buf</span>[BDEVNAME_SIZE];
<span class="org-whitespace-space">        </span><span class="org-type">unsigned</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">inflight</span>[2];
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">cpu</span>;

<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space">        </span><span class="org-comment">if</span><span class="org-whitespace-space"> </span><span class="org-comment">(&amp;disk_to_dev(gp)-&gt;kobj.entry</span><span class="org-whitespace-space"> </span><span class="org-comment">==</span><span class="org-whitespace-space"> </span><span class="org-comment">block_class.devices.next)</span>
<span class="org-whitespace-space">                </span><span class="org-comment">seq_puts(seqf,</span><span class="org-whitespace-tab">  </span><span class="org-comment">"major</span><span class="org-whitespace-space"> </span><span class="org-comment">minor</span><span class="org-whitespace-space"> </span><span class="org-comment">name"</span>
<span class="org-whitespace-space">                                </span><span class="org-comment">"</span><span class="org-whitespace-space">     </span><span class="org-comment">rio</span><span class="org-whitespace-space"> </span><span class="org-comment">rmerge</span><span class="org-whitespace-space"> </span><span class="org-comment">rsect</span><span class="org-whitespace-space"> </span><span class="org-comment">ruse</span><span class="org-whitespace-space"> </span><span class="org-comment">wio</span><span class="org-whitespace-space"> </span><span class="org-comment">wmerge</span><span class="org-whitespace-space"> </span><span class="org-comment">"</span>
<span class="org-whitespace-space">                                </span><span class="org-comment">"wsect</span><span class="org-whitespace-space"> </span><span class="org-comment">wuse</span><span class="org-whitespace-space"> </span><span class="org-comment">running</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">aveq"</span>
<span class="org-whitespace-space">                                </span><span class="org-comment">"\n\n");</span>
<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">*/</span>

<span class="org-whitespace-space">        </span>disk_part_iter_init(&amp;piter,<span class="org-whitespace-space"> </span>gp,<span class="org-whitespace-space"> </span>DISK_PITER_INCL_EMPTY_PART0);
<span class="org-whitespace-space">        </span><span class="org-keyword">while</span><span class="org-whitespace-space"> </span>((hd<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>disk_part_iter_next(&amp;piter)))<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>cpu<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>part_stat_lock();
<span class="org-whitespace-space">                </span>part_round_stats(gp-&gt;queue,<span class="org-whitespace-space"> </span>cpu,<span class="org-whitespace-space"> </span>hd);
<span class="org-whitespace-space">                </span>part_stat_unlock();
<span class="org-whitespace-space">                </span>part_in_flight(gp-&gt;queue,<span class="org-whitespace-space"> </span>hd,<span class="org-whitespace-space"> </span>inflight);
<span class="org-whitespace-space">                </span>seq_printf(seqf,<span class="org-whitespace-space"> </span><span class="org-string">"%4d</span><span class="org-whitespace-space"> </span><span class="org-string">%7d</span><span class="org-whitespace-space"> </span><span class="org-string">%s</span><span class="org-whitespace-space"> </span><span class="org-string">%lu</span><span class="org-whitespace-space"> </span><span class="org-string">%lu</span><span class="org-whitespace-space"> </span><span class="org-string">%lu</span><span class="org-whitespace-space"> </span><span class="org-string">"</span>
<span class="org-whitespace-space">                           </span><span class="org-string">"%u</span><span class="org-whitespace-space"> </span><span class="org-string">%lu</span><span class="org-whitespace-space"> </span><span class="org-string">%lu</span><span class="org-whitespace-space"> </span><span class="org-string">%lu</span><span class="org-whitespace-space"> </span><span class="org-string">%u</span><span class="org-whitespace-space"> </span><span class="org-string">%u</span><span class="org-whitespace-space"> </span><span class="org-string">%u</span><span class="org-whitespace-space"> </span><span class="org-string">%u\n"</span>,
<span class="org-whitespace-space">                           </span>MAJOR(part_devt(hd)),<span class="org-whitespace-space"> </span>MINOR(part_devt(hd)),
<span class="org-whitespace-space">                           </span>disk_name(gp,<span class="org-whitespace-space"> </span>hd-&gt;partno,<span class="org-whitespace-space"> </span>buf),
<span class="org-whitespace-space">                           </span>part_stat_read(hd,<span class="org-whitespace-space"> </span>ios[READ]),
<span class="org-whitespace-space">                           </span>part_stat_read(hd,<span class="org-whitespace-space"> </span>merges[READ]),
<span class="org-whitespace-space">                           </span>part_stat_read(hd,<span class="org-whitespace-space"> </span>sectors[READ]),
<span class="org-whitespace-space">                           </span>jiffies_to_msecs(part_stat_read(hd,<span class="org-whitespace-space"> </span>ticks[READ])),
<span class="org-whitespace-space">                           </span>part_stat_read(hd,<span class="org-whitespace-space"> </span>ios[WRITE]),
<span class="org-whitespace-space">                           </span>part_stat_read(hd,<span class="org-whitespace-space"> </span>merges[WRITE]),
<span class="org-whitespace-space">                           </span>part_stat_read(hd,<span class="org-whitespace-space"> </span>sectors[WRITE]),
<span class="org-whitespace-space">                           </span>jiffies_to_msecs(part_stat_read(hd,<span class="org-whitespace-space"> </span>ticks[WRITE])),
<span class="org-whitespace-space">                           </span>inflight[0],
<span class="org-whitespace-space">                           </span>jiffies_to_msecs(part_stat_read(hd,<span class="org-whitespace-space"> </span>io_ticks)),
<span class="org-whitespace-space">                           </span>jiffies_to_msecs(part_stat_read(hd,<span class="org-whitespace-space"> </span>time_in_queue))
<span class="org-whitespace-space">                        </span>);
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span>disk_part_iter_exit(&amp;piter);

<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org883e48a" class="outline-3">
<h3 id="org883e48a"><span class="section-number-3">3.9</span> proc/dma</h3>
<div class="outline-text-3" id="text-3-9">
<p>
This is a list of the registered ISA DMA (direct memory access) channels in use.
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/dma
<span class="org-whitespace-space"> </span>4:<span class="org-whitespace-space"> </span>cascade
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/kernel/dma.c">kernel/dma.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">proc_dma_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>single_open(file,<span class="org-whitespace-space"> </span>proc_dma_show,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_dma_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>proc_dma_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>single_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_dma_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"dma"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_dma_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-function-name">__initcall</span>(proc_dma_init);

<span class="org-preprocessor">#ifdef</span><span class="org-whitespace-space"> </span>MAX_DMA_CHANNELS
<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">proc_dma_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">i</span>;

<span class="org-whitespace-space">        </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>;<span class="org-whitespace-space"> </span>i<span class="org-whitespace-space"> </span>&lt;<span class="org-whitespace-space"> </span>MAX_DMA_CHANNELS<span class="org-whitespace-space"> </span>;<span class="org-whitespace-space"> </span>i++)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(dma_chan_busy[i].lock)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                        </span>seq_printf(m,<span class="org-whitespace-space"> </span><span class="org-string">"%2d:</span><span class="org-whitespace-space"> </span><span class="org-string">%s\n"</span>,<span class="org-whitespace-space"> </span>i,
<span class="org-whitespace-space">                                   </span>dma_chan_busy[i].device_id);
<span class="org-whitespace-space">                </span>}
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-preprocessor">#else</span>
<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">proc_dma_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span>seq_puts(m,<span class="org-whitespace-space"> </span><span class="org-string">"No</span><span class="org-whitespace-space"> </span><span class="org-string">DMA\n"</span>);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-preprocessor">#endif</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">MAX_DMA_CHANNELS</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org49a3bf7" class="outline-3">
<h3 id="org49a3bf7"><span class="section-number-3">3.10</span> proc/execdomains</h3>
<div class="outline-text-3" id="text-3-10">
<p>
execdomains显示当前支持的可执行文件domains(ABI)。当前总是显示Linux [kernel]：
</p>
<div class="org-src-container">
<pre class="src src-sh">cat<span class="org-whitespace-space"> </span>/proc/execdomains
0-0<span class="org-whitespace-space">     </span>Linux<span class="org-whitespace-space">                   </span>[kernel]
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/kernel/exec_domain.c">kernel/exec_domain.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#ifdef</span><span class="org-whitespace-space"> </span>CONFIG_PROC_FS
<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">execdomains_proc_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span>seq_puts(m,<span class="org-whitespace-space"> </span><span class="org-string">"0-0\tLinux</span><span class="org-whitespace-space">           </span><span class="org-string">\t[kernel]\n"</span>);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">execdomains_proc_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>single_open(file,<span class="org-whitespace-space"> </span>execdomains_proc_show,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">execdomains_proc_fops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>execdomains_proc_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>single_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_execdomains_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"execdomains"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;execdomains_proc_fops);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">module_init</span>(proc_execdomains_init);
<span class="org-preprocessor">#endif</span>

<span class="org-function-name">SYSCALL_DEFINE1</span>(personality,<span class="org-whitespace-space"> </span><span class="org-type">unsigned</span><span class="org-whitespace-space"> </span><span class="org-type">int</span>,<span class="org-whitespace-space"> </span>personality)
{
<span class="org-whitespace-space">        </span><span class="org-type">unsigned</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">old</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>current-&gt;personality;

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(personality<span class="org-whitespace-space"> </span>!=<span class="org-whitespace-space"> </span>0xffffffff)
<span class="org-whitespace-space">                </span>set_personality(personality);

<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>old;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8151505" class="outline-3">
<h3 id="org8151505"><span class="section-number-3">3.11</span> proc/fb</h3>
<div class="outline-text-3" id="text-3-11">
<p>
fb(frame buffer)显示当前系统fb信息：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/fb
0<span class="org-whitespace-space"> </span>inteldrmfb
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/drivers/video/fbdev/core/fbmem.c">drivers/video/fbdev/core/fbmem.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">fb_seq_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">i</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>*(<span class="org-type">loff_t</span><span class="org-whitespace-space"> </span>*)v;
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">fb_info</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">fi</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>registered_fb[i];

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(fi)
<span class="org-whitespace-space">                </span>seq_printf(m,<span class="org-whitespace-space"> </span><span class="org-string">"%d</span><span class="org-whitespace-space"> </span><span class="org-string">%s\n"</span>,<span class="org-whitespace-space"> </span>fi-&gt;node,<span class="org-whitespace-space"> </span>fi-&gt;fix.id);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_fb_seq_ops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-tab">  </span>=<span class="org-whitespace-space"> </span>fb_seq_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>fb_seq_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>fb_seq_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>fb_seq_show,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">proc_fb_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;proc_fb_seq_ops);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">fb_proc_fops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.owner<span class="org-whitespace-tab">          </span>=<span class="org-whitespace-space"> </span>THIS_MODULE,
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>proc_fb_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org6884369" class="outline-3">
<h3 id="org6884369"><span class="section-number-3">3.12</span> proc/filesystems</h3>
<div class="outline-text-3" id="text-3-12">
<p>
filesystems列举当前支持的文件系统类型：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/filesystems
nodev<span class="org-whitespace-space">   </span>sysfs
nodev<span class="org-whitespace-space">   </span>rootfs
nodev<span class="org-whitespace-space">   </span>ramfs
nodev<span class="org-whitespace-space">   </span>bdev
nodev<span class="org-whitespace-space">   </span>proc
nodev<span class="org-whitespace-space">   </span>cpuset
nodev<span class="org-whitespace-space">   </span>cgroup
nodev<span class="org-whitespace-space">   </span>cgroup2
nodev<span class="org-whitespace-space">   </span>tmpfs
nodev<span class="org-whitespace-space">   </span>devtmpfs
nodev<span class="org-whitespace-space">   </span>debugfs
nodev<span class="org-whitespace-space">   </span>tracefs
nodev<span class="org-whitespace-space">   </span>securityfs
nodev<span class="org-whitespace-space">   </span>sockfs
nodev<span class="org-whitespace-space">   </span>bpf
nodev<span class="org-whitespace-space">   </span>pipefs
nodev<span class="org-whitespace-space">   </span>hugetlbfs
nodev<span class="org-whitespace-space">   </span>devpts
nodev<span class="org-whitespace-space">   </span>pstore
nodev<span class="org-whitespace-space">   </span>mqueue
<span class="org-whitespace-space">        </span>ext3
<span class="org-whitespace-space">        </span>ext2
<span class="org-whitespace-space">        </span>ext4
nodev<span class="org-whitespace-space">   </span>autofs
nodev<span class="org-whitespace-space">   </span>binfmt_misc
<span class="org-whitespace-space">        </span>fuseblk
nodev<span class="org-whitespace-space">   </span>fuse
nodev<span class="org-whitespace-space">   </span>fusectl
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/filesystems.c">fs/filesystems.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">filesystems_proc_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_system_type</span><span class="org-whitespace-space"> </span>*<span class="org-whitespace-space"> </span><span class="org-variable-name">tmp</span>;

<span class="org-whitespace-space">        </span>read_lock(&amp;file_systems_lock);
<span class="org-whitespace-space">        </span>tmp<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>file_systems;
<span class="org-whitespace-space">        </span><span class="org-keyword">while</span><span class="org-whitespace-space"> </span>(tmp)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>seq_printf(m,<span class="org-whitespace-space"> </span><span class="org-string">"%s\t%s\n"</span>,
<span class="org-whitespace-space">                        </span>(tmp-&gt;fs_flags<span class="org-whitespace-space"> </span>&amp;<span class="org-whitespace-space"> </span>FS_REQUIRES_DEV)<span class="org-whitespace-space"> </span>?<span class="org-whitespace-space"> </span><span class="org-string">""</span><span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span><span class="org-string">"nodev"</span>,
<span class="org-whitespace-space">                        </span>tmp-&gt;name);
<span class="org-whitespace-space">                </span>tmp<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>tmp-&gt;next;
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span>read_unlock(&amp;file_systems_lock);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">filesystems_proc_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>single_open(file,<span class="org-whitespace-space"> </span>filesystems_proc_show,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">filesystems_proc_fops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>filesystems_proc_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>single_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_filesystems_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"filesystems"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;filesystems_proc_fops);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">module_init</span>(proc_filesystems_init);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdeb47d6" class="outline-3">
<h3 id="orgdeb47d6"><span class="section-number-3">3.13</span> proc/fs</h3>
<div class="outline-text-3" id="text-3-13">
<p>
fs目录下包含子目录，每个子目录是一种当前正在使用的文件系统名称（比如ext4），每个文件系统子目录下二级子目录是每个挂载的块设备（比如sda2），其下文件是其属性。
</p>

<p>
proc/fs是由<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/root.c#L144">fs/proc/root.c</a>创建的：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-type">void</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_root_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">err</span>;

<span class="org-whitespace-space">        </span>proc_init_inodecache();
<span class="org-whitespace-space">        </span>set_proc_pid_nlink();
<span class="org-whitespace-space">        </span>err<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>register_filesystem(&amp;proc_fs_type);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(err)
<span class="org-whitespace-space">                </span><span class="org-keyword">return</span>;

<span class="org-whitespace-space">        </span>proc_self_init();
<span class="org-whitespace-space">        </span>proc_thread_self_init();
<span class="org-whitespace-space">        </span>proc_symlink(<span class="org-string">"mounts"</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span><span class="org-string">"self/mounts"</span>);

<span class="org-whitespace-space">        </span>proc_net_init();

<span class="org-preprocessor">#ifdef</span><span class="org-whitespace-space"> </span>CONFIG_SYSVIPC
<span class="org-whitespace-space">        </span>proc_mkdir(<span class="org-string">"sysvipc"</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
<span class="org-preprocessor">#endif</span>
<span class="org-whitespace-space">        </span>proc_mkdir(<span class="org-string">"fs"</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
<span class="org-whitespace-space">        </span>proc_mkdir(<span class="org-string">"driver"</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
<span class="org-whitespace-space">        </span>proc_create_mount_point(<span class="org-string">"fs/nfsd"</span>);<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">somewhere</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">nfsd</span><span class="org-whitespace-space"> </span><span class="org-comment">filesystem</span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">to</span></span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">be</span></span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment"><span class="org-whitespace-line">mounted</span></span><span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-comment-delimiter"><span class="org-whitespace-line">*/</span></span>
<span class="org-preprocessor">#if</span><span class="org-whitespace-space"> </span><span class="org-preprocessor">defined</span>(CONFIG_SUN_OPENPROMFS)<span class="org-whitespace-space"> </span>||<span class="org-whitespace-space"> </span><span class="org-preprocessor">defined</span>(CONFIG_SUN_OPENPROMFS_MODULE)
<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">just</span><span class="org-whitespace-space"> </span><span class="org-comment">give</span><span class="org-whitespace-space"> </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">mountpoint</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span>proc_create_mount_point(<span class="org-string">"openprom"</span>);
<span class="org-preprocessor">#endif</span>
<span class="org-whitespace-space">        </span>proc_tty_init();
<span class="org-whitespace-space">        </span>proc_mkdir(<span class="org-string">"bus"</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
<span class="org-whitespace-space">        </span>proc_sys_init();
}
</pre>
</div>

<p>
每个子目录是由不同的文件系统创建的，比如ext4：
<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/ext4/sysfs.c">fs/ext4/sysfs.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-type">char</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_dirname</span>[]<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span><span class="org-string">"fs/ext4"</span>;
<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">proc_dir_entry</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">ext4_proc_root</span>;

<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>ext4_init_sysfs(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">ret</span>;

<span class="org-whitespace-space">        </span>kobject_set_name(&amp;ext4_kset.kobj,<span class="org-whitespace-space"> </span><span class="org-string">"ext4"</span>);
<span class="org-whitespace-space">        </span>ext4_kset.kobj.parent<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>fs_kobj;
<span class="org-whitespace-space">        </span>ret<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>kset_register(&amp;ext4_kset);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(ret)
<span class="org-whitespace-space">                </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>ret;

<span class="org-whitespace-space">        </span>ret<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>kobject_init_and_add(&amp;ext4_feat,<span class="org-whitespace-space"> </span>&amp;ext4_feat_ktype,
<span class="org-whitespace-space">                                   </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span><span class="org-string">"features"</span>);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(ret)
<span class="org-whitespace-space">                </span>kset_unregister(&amp;ext4_kset);
<span class="org-whitespace-space">        </span><span class="org-keyword">else</span>
<span class="org-whitespace-space">                </span>ext4_proc_root<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>proc_mkdir(proc_dirname,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>ret;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">ext4_proc_files</span><span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-type">char</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">name</span>;
<span class="org-whitespace-space">        </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">fops</span>;
}<span class="org-whitespace-space"> </span><span class="org-variable-name">proc_files</span>[]<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>PROC_FILE_LIST(options),
<span class="org-whitespace-space">        </span>PROC_FILE_LIST(es_shrinker_info),
<span class="org-whitespace-space">        </span>PROC_FILE_LIST(mb_groups),
<span class="org-whitespace-space">        </span>{<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span><span class="org-whitespace-space"> </span>},
};

<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">ext4_register_sysfs</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">super_block</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">sb</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">ext4_sb_info</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">sbi</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>EXT4_SB(sb);
<span class="org-whitespace-space">        </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">ext4_proc_files</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">p</span>;
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">err</span>;

<span class="org-whitespace-space">        </span>sbi-&gt;s_kobj.kset<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>&amp;ext4_kset;
<span class="org-whitespace-space">        </span>init_completion(&amp;sbi-&gt;s_kobj_unregister);
<span class="org-whitespace-space">        </span>err<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>kobject_init_and_add(&amp;sbi-&gt;s_kobj,<span class="org-whitespace-space"> </span>&amp;ext4_sb_ktype,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,
<span class="org-whitespace-space">                                   </span><span class="org-string">"%s"</span>,<span class="org-whitespace-space"> </span>sb-&gt;s_id);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(err)
<span class="org-whitespace-space">                </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>err;

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(ext4_proc_root)
<span class="org-whitespace-space">                </span>sbi-&gt;s_proc<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>proc_mkdir(sb-&gt;s_id,<span class="org-whitespace-space"> </span>ext4_proc_root);

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(sbi-&gt;s_proc)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(p<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>proc_files;<span class="org-whitespace-space"> </span>p-&gt;name;<span class="org-whitespace-space"> </span>p++)
<span class="org-whitespace-space">                        </span>proc_create_data(p-&gt;name,<span class="org-whitespace-space"> </span>S_IRUGO,<span class="org-whitespace-space"> </span>sbi-&gt;s_proc,
<span class="org-whitespace-space">                                         </span>p-&gt;fops,<span class="org-whitespace-space"> </span>sb);
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf0f2f7" class="outline-3">
<h3 id="orgcf0f2f7"><span class="section-number-3">3.14</span> proc/interrups</h3>
<div class="outline-text-3" id="text-3-14">
<p>
interrupts显示每CPU每设备的中断数，此文件信息可用来分析中断是否均衡：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/interrupts
<span class="org-whitespace-space">           </span>CPU0<span class="org-whitespace-space">       </span>CPU1<span class="org-whitespace-space">       </span>CPU2<span class="org-whitespace-space">       </span>CPU3
<span class="org-whitespace-space">  </span>0:<span class="org-whitespace-space">         </span>18<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">   </span>2-edge<span class="org-whitespace-space">      </span>timer
<span class="org-whitespace-space">  </span>1:<span class="org-whitespace-space">          </span>3<span class="org-whitespace-space">          </span>1<span class="org-whitespace-space">          </span>1<span class="org-whitespace-space">          </span>8<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">   </span>1-edge<span class="org-whitespace-space">      </span>i8042
<span class="org-whitespace-space">  </span>8:<span class="org-whitespace-space">          </span>1<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">   </span>8-edge<span class="org-whitespace-space">      </span>rtc0
<span class="org-whitespace-space">  </span>9:<span class="org-whitespace-space">       </span>1076<span class="org-whitespace-space">       </span>2273<span class="org-whitespace-space">        </span>812<span class="org-whitespace-space">        </span>836<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">   </span>9-fasteoi<span class="org-whitespace-space">   </span>acpi
<span class="org-whitespace-space"> </span>12:<span class="org-whitespace-space">         </span>42<span class="org-whitespace-space">        </span>475<span class="org-whitespace-space">         </span>34<span class="org-whitespace-space">         </span>51<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">  </span>12-edge<span class="org-whitespace-space">      </span>i8042
<span class="org-whitespace-space"> </span>16:<span class="org-whitespace-space">          </span>2<span class="org-whitespace-space">         </span>23<span class="org-whitespace-space">          </span>2<span class="org-whitespace-space">          </span>2<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">  </span>16-fasteoi<span class="org-whitespace-space">   </span>ehci_<span class="org-whitespace-line">hcd:usb1</span>
<span class="org-whitespace-space"> </span>18:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>1<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">  </span>18-fasteoi<span class="org-whitespace-space">   </span>i801_<span class="org-whitespace-line">smbus</span>
<span class="org-whitespace-space"> </span>23:<span class="org-whitespace-space">          </span>3<span class="org-whitespace-space">         </span>28<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>2<span class="org-whitespace-space">  </span>IR-IO-APIC<span class="org-whitespace-space">  </span>23-fasteoi<span class="org-whitespace-space">   </span>ehci_<span class="org-whitespace-line">hcd:usb2</span>
<span class="org-whitespace-space"> </span>24:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">  </span>DMAR-MSI<span class="org-whitespace-space">   </span>0-edge<span class="org-whitespace-space">      </span>dmar0
<span class="org-whitespace-space"> </span>25:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">  </span>DMAR-MSI<span class="org-whitespace-space">   </span>1-edge<span class="org-whitespace-space">      </span>dmar1
<span class="org-whitespace-space"> </span>28:<span class="org-whitespace-space">         </span>17<span class="org-whitespace-space">          </span>1<span class="org-whitespace-space">          </span>3<span class="org-whitespace-space">          </span>1<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>1572864-edge<span class="org-whitespace-space">      </span>r<span class="org-whitespace-line">tsx_pci</span>
<span class="org-whitespace-space"> </span>29:<span class="org-whitespace-space">        </span>160<span class="org-whitespace-space">       </span>1281<span class="org-whitespace-space">        </span>141<span class="org-whitespace-space">        </span>110<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>409600-edge<span class="org-whitespace-space">      </span>en<span class="org-whitespace-line">p0s25</span>
<span class="org-whitespace-space"> </span>30:<span class="org-whitespace-space">       </span>7815<span class="org-whitespace-space">      </span>43472<span class="org-whitespace-space">       </span>5581<span class="org-whitespace-space">       </span>5237<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>327680-edge<span class="org-whitespace-space">      </span>xh<span class="org-whitespace-line">ci_hcd</span>
<span class="org-whitespace-space"> </span>31:<span class="org-whitespace-space">      </span>29423<span class="org-whitespace-space">      </span>41453<span class="org-whitespace-space">      </span>16894<span class="org-whitespace-space">      </span>16308<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>512000-edge<span class="org-whitespace-space">      </span>ah<span class="org-whitespace-line">ci[0000:00:1f.2]</span>
<span class="org-whitespace-space"> </span>32:<span class="org-whitespace-space">         </span>21<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>360448-edge<span class="org-whitespace-space">      </span>me<span class="org-whitespace-line">i_me</span>
<span class="org-whitespace-space"> </span>33:<span class="org-whitespace-space">        </span>234<span class="org-whitespace-space">        </span>129<span class="org-whitespace-space">         </span>18<span class="org-whitespace-space">          </span>5<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>442368-edge<span class="org-whitespace-space">      </span>sn<span class="org-whitespace-line">d_hda_intel:card1</span>
<span class="org-whitespace-space"> </span>34:<span class="org-whitespace-space">         </span>17<span class="org-whitespace-space">         </span>25<span class="org-whitespace-space">          </span>9<span class="org-whitespace-space">          </span>6<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>1048576-edge
<span class="org-whitespace-space"> </span>35:<span class="org-whitespace-space">      </span>21776<span class="org-whitespace-space">      </span>66376<span class="org-whitespace-space">      </span>16760<span class="org-whitespace-space">      </span>12078<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>32768-edge<span class="org-whitespace-space">      </span>i91<span class="org-whitespace-line">5</span>
<span class="org-whitespace-space"> </span>36:<span class="org-whitespace-space">       </span>7089<span class="org-whitespace-space">      </span>20303<span class="org-whitespace-space">       </span>4455<span class="org-whitespace-space">       </span>3968<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>2097152-edge<span class="org-whitespace-space">      </span>i<span class="org-whitespace-line">wlwifi</span>
<span class="org-whitespace-space"> </span>37:<span class="org-whitespace-space">        </span>116<span class="org-whitespace-space">        </span>855<span class="org-whitespace-space">        </span>136<span class="org-whitespace-space">        </span>140<span class="org-whitespace-space">  </span>IR-PCI-MSI<span class="org-whitespace-space"> </span>49152-edge<span class="org-whitespace-space">      </span>snd<span class="org-whitespace-line">_hda_intel:card0</span>
NMI:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Non-maskable<span class="org-whitespace-space"> </span>interrupts
LOC:<span class="org-whitespace-space">     </span>310517<span class="org-whitespace-space">     </span>250892<span class="org-whitespace-space">     </span>326730<span class="org-whitespace-space">     </span>272651<span class="org-whitespace-space">   </span>Local<span class="org-whitespace-space"> </span>timer<span class="org-whitespace-space"> </span>interrupts
SPU:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Spurious<span class="org-whitespace-space"> </span>interrupts
PMI:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Performance<span class="org-whitespace-space"> </span>monitoring<span class="org-whitespace-space"> </span>interr<span class="org-whitespace-line">upts</span>
IWI:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>2<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>IRQ<span class="org-whitespace-space"> </span>work<span class="org-whitespace-space"> </span>interrupts
RTR:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>APIC<span class="org-whitespace-space"> </span>ICR<span class="org-whitespace-space"> </span>read<span class="org-whitespace-space"> </span>retries
RES:<span class="org-whitespace-space">      </span>32446<span class="org-whitespace-space">      </span>33569<span class="org-whitespace-space">      </span>28799<span class="org-whitespace-space">      </span>18822<span class="org-whitespace-space">   </span>Rescheduling<span class="org-whitespace-space"> </span>interrupts
CAL:<span class="org-whitespace-space">      </span>50777<span class="org-whitespace-space">      </span>60493<span class="org-whitespace-space">      </span>62390<span class="org-whitespace-space">      </span>53925<span class="org-whitespace-space">   </span>Function<span class="org-whitespace-space"> </span>call<span class="org-whitespace-space"> </span>interrupts
TLB:<span class="org-whitespace-space">      </span>48661<span class="org-whitespace-space">      </span>58330<span class="org-whitespace-space">      </span>60778<span class="org-whitespace-space">      </span>51797<span class="org-whitespace-space">   </span>TLB<span class="org-whitespace-space"> </span>shootdowns
TRM:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Thermal<span class="org-whitespace-space"> </span>event<span class="org-whitespace-space"> </span>interrupts
THR:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Threshold<span class="org-whitespace-space"> </span>APIC<span class="org-whitespace-space"> </span>interrupts
DFR:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Deferred<span class="org-whitespace-space"> </span>Error<span class="org-whitespace-space"> </span>APIC<span class="org-whitespace-space"> </span>interrupt<span class="org-whitespace-line">s</span>
MCE:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Machine<span class="org-whitespace-space"> </span>check<span class="org-whitespace-space"> </span>exceptions
MCP:<span class="org-whitespace-space">         </span>12<span class="org-whitespace-space">         </span>12<span class="org-whitespace-space">         </span>12<span class="org-whitespace-space">         </span>12<span class="org-whitespace-space">   </span>Machine<span class="org-whitespace-space"> </span>check<span class="org-whitespace-space"> </span>polls
ERR:<span class="org-whitespace-space">          </span>0
MIS:<span class="org-whitespace-space">          </span>0
PIN:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Posted-interrupt<span class="org-whitespace-space"> </span>notification<span class="org-whitespace-space"><span class="org-whitespace-line"> </span></span><span class="org-whitespace-line">event</span>
PIW:<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">          </span>0<span class="org-whitespace-space">   </span>Posted-interrupt<span class="org-whitespace-space"> </span>wakeup<span class="org-whitespace-space"> </span>event
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/fs/proc/interrupts.c">fs/proc/interrupts.c</a>和<a href="https://elixir.bootlin.com/linux/v4.15.4/source/kernel/irq/proc.c">kernel/irq/proc.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">int_seq_ops</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>int_seq_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-space">  </span>=<span class="org-whitespace-space"> </span>int_seq_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-space">  </span>=<span class="org-whitespace-space"> </span>int_seq_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-space">  </span>=<span class="org-whitespace-space"> </span>show_interrupts
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">interrupts_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">filp</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>seq_open(filp,<span class="org-whitespace-space"> </span>&amp;int_seq_ops);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_interrupts_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>interrupts_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>proc_interrupts_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"interrupts"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_interrupts_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">fs_initcall</span>(proc_interrupts_init);

<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">show_interrupts</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">p</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">prec</span>;

<span class="org-whitespace-space">        </span><span class="org-type">unsigned</span><span class="org-whitespace-space"> </span><span class="org-type">long</span><span class="org-whitespace-space"> </span><span class="org-variable-name">flags</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">any_count</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>0;
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">i</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>*(<span class="org-type">loff_t</span><span class="org-whitespace-space"> </span>*)<span class="org-whitespace-space"> </span>v,<span class="org-whitespace-space"> </span><span class="org-variable-name">j</span>;
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">irqaction</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">action</span>;
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">irq_desc</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">desc</span>;

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>&gt;<span class="org-whitespace-space"> </span>ACTUAL_NR_IRQS)
<span class="org-whitespace-space">                </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>ACTUAL_NR_IRQS)
<span class="org-whitespace-space">                </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>arch_show_interrupts(p,<span class="org-whitespace-space"> </span>prec);

<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">print</span><span class="org-whitespace-space"> </span><span class="org-comment">header</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span><span class="org-whitespace-space"> </span><span class="org-comment">calculate</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">width</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">the</span><span class="org-whitespace-space"> </span><span class="org-comment">first</span><span class="org-whitespace-space"> </span><span class="org-comment">column</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(i<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>0)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(prec<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>3,<span class="org-whitespace-space"> </span>j<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>1000;<span class="org-whitespace-space"> </span>prec<span class="org-whitespace-space"> </span>&lt;<span class="org-whitespace-space"> </span>10<span class="org-whitespace-space"> </span>&amp;&amp;<span class="org-whitespace-space"> </span>j<span class="org-whitespace-space"> </span>&lt;=<span class="org-whitespace-space"> </span>nr_irqs;<span class="org-whitespace-space"> </span>++prec)
<span class="org-whitespace-space">                        </span>j<span class="org-whitespace-space"> </span>*=<span class="org-whitespace-space"> </span>10;

<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"%*s"</span>,<span class="org-whitespace-space"> </span>prec<span class="org-whitespace-space"> </span>+<span class="org-whitespace-space"> </span>8,<span class="org-whitespace-space"> </span><span class="org-string">""</span>);
<span class="org-whitespace-space">                </span>for_each_online_cpu(j)
<span class="org-whitespace-space">                        </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"CPU%-8d"</span>,<span class="org-whitespace-space"> </span>j);
<span class="org-whitespace-space">                </span>seq_putc(p,<span class="org-whitespace-space"> </span><span class="org-string">'\n'</span>);
<span class="org-whitespace-space">        </span>}

<span class="org-whitespace-space">        </span>irq_lock_sparse();
<span class="org-whitespace-space">        </span>desc<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>irq_to_desc(i);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(<span class="org-negation-char">!</span>desc)
<span class="org-whitespace-space">                </span><span class="org-keyword">goto</span><span class="org-whitespace-space"> </span><span class="org-constant">outsparse</span>;

<span class="org-whitespace-space">        </span>raw_spin_lock_irqsave(&amp;desc-&gt;lock,<span class="org-whitespace-space"> </span>flags);
<span class="org-whitespace-space">        </span>for_each_online_cpu(j)
<span class="org-whitespace-space">                </span>any_count<span class="org-whitespace-space"> </span>|=<span class="org-whitespace-space"> </span>kstat_irqs_cpu(i,<span class="org-whitespace-space"> </span>j);
<span class="org-whitespace-space">        </span>action<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>desc-&gt;action;
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>((<span class="org-negation-char">!</span>action<span class="org-whitespace-space"> </span>||<span class="org-whitespace-space"> </span>irq_desc_is_chained(desc))<span class="org-whitespace-space"> </span>&amp;&amp;<span class="org-whitespace-space"> </span><span class="org-negation-char">!</span>any_count)
<span class="org-whitespace-space">                </span><span class="org-keyword">goto</span><span class="org-whitespace-space"> </span><span class="org-constant">out</span>;

<span class="org-whitespace-space">        </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"%*d:</span><span class="org-whitespace-space"> </span><span class="org-string">"</span>,<span class="org-whitespace-space"> </span>prec,<span class="org-whitespace-space"> </span>i);
<span class="org-whitespace-space">        </span>for_each_online_cpu(j)
<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"%10u</span><span class="org-whitespace-space"> </span><span class="org-string">"</span>,<span class="org-whitespace-space"> </span>kstat_irqs_cpu(i,<span class="org-whitespace-space"> </span>j));

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(desc-&gt;irq_data.chip)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(desc-&gt;irq_data.chip-&gt;irq_print_chip)
<span class="org-whitespace-space">                        </span>desc-&gt;irq_data.chip-&gt;irq_print_chip(&amp;desc-&gt;irq_data,<span class="org-whitespace-space"> </span>p);
<span class="org-whitespace-space">                </span><span class="org-keyword">else</span><span class="org-whitespace-space"> </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(desc-&gt;irq_data.chip-&gt;name)
<span class="org-whitespace-space">                        </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">%8s"</span>,<span class="org-whitespace-space"> </span>desc-&gt;irq_data.chip-&gt;name);
<span class="org-whitespace-space">                </span><span class="org-keyword">else</span>
<span class="org-whitespace-space">                        </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">%8s"</span>,<span class="org-whitespace-space"> </span><span class="org-string">"-"</span>);
<span class="org-whitespace-space">        </span>}<span class="org-whitespace-space"> </span><span class="org-keyword">else</span><span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">%8s"</span>,<span class="org-whitespace-space"> </span><span class="org-string">"None"</span>);
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(desc-&gt;irq_data.domain)
<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">%*d"</span>,<span class="org-whitespace-space"> </span>prec,<span class="org-whitespace-space"> </span>(<span class="org-type">int</span>)<span class="org-whitespace-space"> </span>desc-&gt;irq_data.hwirq);
<span class="org-whitespace-space">        </span><span class="org-keyword">else</span>
<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">%*s"</span>,<span class="org-whitespace-space"> </span>prec,<span class="org-whitespace-space"> </span><span class="org-string">""</span>);
<span class="org-preprocessor">#ifdef</span><span class="org-whitespace-space"> </span>CONFIG_GENERIC_IRQ_SHOW_LEVEL
<span class="org-whitespace-space">        </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">%-8s"</span>,<span class="org-whitespace-space"> </span>irqd_is_level_type(&amp;desc-&gt;irq_data)<span class="org-whitespace-space"> </span>?<span class="org-whitespace-space"> </span><span class="org-string">"Level"</span><span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-string"><span class="org-whitespace-line">Edge"</span></span><span class="org-whitespace-line">);</span>
<span class="org-preprocessor">#endif</span>
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(desc-&gt;name)
<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"-%-8s"</span>,<span class="org-whitespace-space"> </span>desc-&gt;name);

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(action)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space">  </span><span class="org-string">%s"</span>,<span class="org-whitespace-space"> </span>action-&gt;name);
<span class="org-whitespace-space">                </span><span class="org-keyword">while</span><span class="org-whitespace-space"> </span>((action<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>action-&gt;next)<span class="org-whitespace-space"> </span>!=<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>)
<span class="org-whitespace-space">                        </span>seq_printf(p,<span class="org-whitespace-space"> </span><span class="org-string">",</span><span class="org-whitespace-space"> </span><span class="org-string">%s"</span>,<span class="org-whitespace-space"> </span>action-&gt;name);
<span class="org-whitespace-space">        </span>}

<span class="org-whitespace-space">        </span>seq_putc(p,<span class="org-whitespace-space"> </span><span class="org-string">'\n'</span>);
<span class="org-constant">out</span>:
<span class="org-whitespace-space">        </span>raw_spin_unlock_irqrestore(&amp;desc-&gt;lock,<span class="org-whitespace-space"> </span>flags);
<span class="org-constant">outsparse</span>:
<span class="org-whitespace-space">        </span>irq_unlock_sparse();
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ea24fc" class="outline-3">
<h3 id="iomem"><a id="org0ea24fc"></a><span class="section-number-3">3.15</span> iomem</h3>
<div class="outline-text-3" id="text-iomem">
<p>
I/O内存映射表。包括预留、BIOS、显卡、内存、PCI地址空间等。部分PCIe地址空间因安全原因，BIOS不暴露给OS，此时显示为reserved。
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/iomem
00000000-00000fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
00001000-0009d7ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>System<span class="org-whitespace-space"> </span>RAM
0009d800-0009ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
000a0000-000bffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:00
000c0000-000c7fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>Video<span class="org-whitespace-space"> </span>ROM
000c8000-000cbfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:00
000cc000-000cffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:00
000d0000-000d3fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:00
000d4000-000d7fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:00
000d8000-000dbfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:00
000dc000-000dffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:00
000e0000-000fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">  </span>000f0000-000fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>System<span class="org-whitespace-space"> </span>ROM
00100000-1fffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>System<span class="org-whitespace-space"> </span>RAM
<span class="org-whitespace-space">  </span>01000000-01519c00<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>Kernel<span class="org-whitespace-space"> </span>code
<span class="org-whitespace-space">  </span>01519c01-018ecdff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>Kernel<span class="org-whitespace-space"> </span>data
<span class="org-whitespace-space">  </span>01a21000-01af2fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>Kernel<span class="org-whitespace-space"> </span>bss
20000000-201fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
20200000-40003fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>System<span class="org-whitespace-space"> </span>RAM
40004000-40004fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
40005000-cdba6fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>System<span class="org-whitespace-space"> </span>RAM
cdba7000-dae9efff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
dae9f000-daf9efff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>Non-volatile<span class="org-whitespace-space"> </span>Storage
daf9f000-daffefff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>Tables
dafff000-df9fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">  </span>dba00000-df9fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>Graphics<span class="org-whitespace-space"> </span>Stolen<span class="org-whitespace-space"> </span>Memory
dfa00000-febfffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:00
<span class="org-whitespace-space">  </span>e0000000-efffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:02.0
<span class="org-whitespace-space">  </span>f0000000-f03fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:02.0
<span class="org-whitespace-space">  </span>f0400000-f0bfffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:02
<span class="org-whitespace-space">  </span>f0c00000-f13fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:04
<span class="org-whitespace-space">  </span>f1400000-f1bfffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:04
<span class="org-whitespace-space">  </span>f1c00000-f1cfffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:03
<span class="org-whitespace-space">    </span>f1c00000-f1c01fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:03:00.0
<span class="org-whitespace-space">      </span>f1c00000-f1c01fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iwlwifi
<span class="org-whitespace-space">  </span>f1d00000-f24fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:02
<span class="org-whitespace-space">    </span>f1d00000-f1d000ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:02:00.0
<span class="org-whitespace-space">      </span>f1d00000-f1d000ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>mmc0
<span class="org-whitespace-space">  </span>f2500000-f251ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:19.0
<span class="org-whitespace-space">    </span>f2500000-f251ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>e1000e
<span class="org-whitespace-space">  </span>f2520000-f252ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:14.0
<span class="org-whitespace-space">    </span>f2520000-f252ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>xhci_hcd
<span class="org-whitespace-space">  </span>f2530000-f2533fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1b.0
<span class="org-whitespace-space">    </span>f2530000-f2533fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ICH<span class="org-whitespace-space"> </span>HD<span class="org-whitespace-space"> </span>audio
<span class="org-whitespace-space">  </span>f2534000-f25340ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.3
<span class="org-whitespace-space">  </span>f2535000-f253500f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:16.0
<span class="org-whitespace-space">    </span>f2535000-f253500f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>mei_me
<span class="org-whitespace-space">  </span>f2538000-f25387ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.2
<span class="org-whitespace-space">    </span>f2538000-f25387ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ahci
<span class="org-whitespace-space">  </span>f2539000-f25393ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1d.0
<span class="org-whitespace-space">    </span>f2539000-f25393ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ehci_hcd
<span class="org-whitespace-space">  </span>f253a000-f253a3ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1a.0
<span class="org-whitespace-space">    </span>f253a000-f253a3ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ehci_hcd
<span class="org-whitespace-space">  </span>f253b000-f253bfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:19.0
<span class="org-whitespace-space">    </span>f253b000-f253bfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>e1000e
<span class="org-whitespace-space">  </span>f253c000-f253cfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:16.3
<span class="org-whitespace-space">  </span>f8000000-fbffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>MMCONFIG<span class="org-whitespace-space"> </span>0000<span class="org-whitespace-space"> </span>[bus<span class="org-whitespace-space"> </span>00-3f]
<span class="org-whitespace-space">    </span>f8000000-fbffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">      </span>f8000000-fbffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
fec00000-fec00fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">  </span>fec00000-fec003ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>IOAPIC<span class="org-whitespace-space"> </span>0
fed00000-fed003ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>HPET<span class="org-whitespace-space"> </span>0
<span class="org-whitespace-space">  </span>fed00000-fed003ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PNP0103:00
fed08000-fed08fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
fed10000-fed19fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">  </span>fed10000-fed17fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
<span class="org-whitespace-space">  </span>fed18000-fed18fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
<span class="org-whitespace-space">  </span>fed19000-fed19fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
fed1c000-fed1ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">  </span>fed1c000-fed1ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
<span class="org-whitespace-space">    </span>fed1f410-fed1f414<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iTCO_wdt
<span class="org-whitespace-space">      </span>fed1f410-fed1f414<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iTCO_wdt
fed40000-fed4bfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:00
<span class="org-whitespace-space">  </span>fed45000-fed4bfff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
fed90000-fed90fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>dmar0
fed91000-fed91fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>dmar1
fee00000-fee00fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>Local<span class="org-whitespace-space"> </span>APIC
<span class="org-whitespace-space">  </span>fee00000-fee00fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
ffc00000-ffffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
<span class="org-whitespace-space">  </span>fffff000-ffffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
100000000-41e5fffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>System<span class="org-whitespace-space"> </span>RAM
41e600000-41effffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>reserved
41f000000-41fffffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>RAM<span class="org-whitespace-space"> </span>buffer
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/kernel/resource.c">kernel/resource.c</a>：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#ifdef</span><span class="org-whitespace-space"> </span>CONFIG_PROC_FS

<span class="org-keyword">enum</span><span class="org-whitespace-space"> </span>{<span class="org-whitespace-space"> </span><span class="org-variable-name">MAX_IORES_LEVEL</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>5<span class="org-whitespace-space"> </span>};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-function-name">r_start</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">loff_t</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">pos</span>)
<span class="org-whitespace-space">        </span><span class="org-function-name">__acquires</span>(resource_lock)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">resource</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">p</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>m-&gt;private;
<span class="org-whitespace-space">        </span><span class="org-type">loff_t</span><span class="org-whitespace-space"> </span><span class="org-variable-name">l</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>0;
<span class="org-whitespace-space">        </span>read_lock(&amp;resource_lock);
<span class="org-whitespace-space">        </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(p<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>p-&gt;child;<span class="org-whitespace-space"> </span>p<span class="org-whitespace-space"> </span>&amp;&amp;<span class="org-whitespace-space"> </span>l<span class="org-whitespace-space"> </span>&lt;<span class="org-whitespace-space"> </span>*pos;<span class="org-whitespace-space"> </span>p<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>r_next(m,<span class="org-whitespace-space"> </span>p,<span class="org-whitespace-space"> </span>&amp;l))
<span class="org-whitespace-space">                </span>;
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>p;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span><span class="org-function-name">r_stop</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
<span class="org-whitespace-space">        </span><span class="org-function-name">__releases</span>(resource_lock)
{
<span class="org-whitespace-space">        </span>read_unlock(&amp;resource_lock);
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">r_show</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span>,<span class="org-whitespace-space"> </span><span class="org-type">void</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">v</span>)
{
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">resource</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">root</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>m-&gt;private;
<span class="org-whitespace-space">        </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">resource</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">r</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>v,<span class="org-whitespace-space"> </span>*<span class="org-variable-name">p</span>;
<span class="org-whitespace-space">        </span><span class="org-type">unsigned</span><span class="org-whitespace-space"> </span><span class="org-type">long</span><span class="org-whitespace-space"> </span><span class="org-type">long</span><span class="org-whitespace-space"> </span><span class="org-variable-name">start</span>,<span class="org-whitespace-space"> </span><span class="org-variable-name">end</span>;
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">width</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>root-&gt;end<span class="org-whitespace-space"> </span>&lt;<span class="org-whitespace-space"> </span>0x10000<span class="org-whitespace-space"> </span>?<span class="org-whitespace-space"> </span>4<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>8;
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">depth</span>;

<span class="org-whitespace-space">        </span><span class="org-keyword">for</span><span class="org-whitespace-space"> </span>(depth<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span>p<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>r;<span class="org-whitespace-space"> </span>depth<span class="org-whitespace-space"> </span>&lt;<span class="org-whitespace-space"> </span>MAX_IORES_LEVEL;<span class="org-whitespace-space"> </span>depth++,<span class="org-whitespace-space"> </span>p<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>p-&gt;parent)
<span class="org-whitespace-space">                </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(p-&gt;parent<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>root)
<span class="org-whitespace-space">                        </span><span class="org-keyword">break</span>;

<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(file_ns_capable(m-&gt;file,<span class="org-whitespace-space"> </span>&amp;init_user_ns,<span class="org-whitespace-space"> </span>CAP_SYS_ADMIN))<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>start<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>r-&gt;start;
<span class="org-whitespace-space">                </span>end<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>r-&gt;end;
<span class="org-whitespace-space">        </span>}<span class="org-whitespace-space"> </span><span class="org-keyword">else</span><span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span>start<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>end<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>0;
<span class="org-whitespace-space">        </span>}

<span class="org-whitespace-space">        </span>seq_printf(m,<span class="org-whitespace-space"> </span><span class="org-string">"%*s%0*llx-%0*llx</span><span class="org-whitespace-space"> </span><span class="org-string">:</span><span class="org-whitespace-space"> </span><span class="org-string">%s\n"</span>,
<span class="org-whitespace-space">                        </span>depth<span class="org-whitespace-space"> </span>*<span class="org-whitespace-space"> </span>2,<span class="org-whitespace-space"> </span><span class="org-string">""</span>,
<span class="org-whitespace-space">                        </span>width,<span class="org-whitespace-space"> </span>start,
<span class="org-whitespace-space">                        </span>width,<span class="org-whitespace-space"> </span>end,
<span class="org-whitespace-space">                        </span>r-&gt;name<span class="org-whitespace-space"> </span>?<span class="org-whitespace-space"> </span>r-&gt;name<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span><span class="org-string">"&lt;BAD&gt;"</span>);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">resource_op</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.start<span class="org-whitespace-tab">  </span>=<span class="org-whitespace-space"> </span>r_start,
<span class="org-whitespace-space">        </span>.next<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>r_next,
<span class="org-whitespace-space">        </span>.stop<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>r_stop,
<span class="org-whitespace-space">        </span>.show<span class="org-whitespace-tab">   </span>=<span class="org-whitespace-space"> </span>r_show,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">ioports_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">res</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;resource_op);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(<span class="org-negation-char">!</span>res)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>file-&gt;private_data;
<span class="org-whitespace-space">                </span>m-&gt;private<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>&amp;ioport_resource;
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>res;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">iomem_open</span>(<span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">inode</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">inode</span>,<span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">file</span>)
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">res</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>seq_open(file,<span class="org-whitespace-space"> </span>&amp;resource_op);
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(<span class="org-negation-char">!</span>res)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">                </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">seq_file</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">m</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>file-&gt;private_data;
<span class="org-whitespace-space">                </span>m-&gt;private<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>&amp;iomem_resource;
<span class="org-whitespace-space">        </span>}
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>res;
}

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_ioports_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>ioports_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-keyword">struct</span><span class="org-whitespace-space"> </span><span class="org-type">file_operations</span><span class="org-whitespace-space"> </span><span class="org-variable-name">proc_iomem_operations</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">        </span>.open<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>iomem_open,
<span class="org-whitespace-space">        </span>.read<span class="org-whitespace-tab">           </span>=<span class="org-whitespace-space"> </span>seq_read,
<span class="org-whitespace-space">        </span>.llseek<span class="org-whitespace-tab">         </span>=<span class="org-whitespace-space"> </span>seq_lseek,
<span class="org-whitespace-space">        </span>.release<span class="org-whitespace-tab">        </span>=<span class="org-whitespace-space"> </span>seq_release,
};

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">__init</span><span class="org-whitespace-space"> </span>ioresources_init(<span class="org-type">void</span>)
{
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"ioports"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_ioports_operations);
<span class="org-whitespace-space">        </span>proc_create(<span class="org-string">"iomem"</span>,<span class="org-whitespace-space"> </span>0,<span class="org-whitespace-space"> </span><span class="org-constant">NULL</span>,<span class="org-whitespace-space"> </span>&amp;proc_iomem_operations);
<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
<span class="org-function-name">__initcall</span>(ioresources_init);

<span class="org-preprocessor">#endif</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">CONFIG_PROC_FS</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org92a15c3" class="outline-3">
<h3 id="org92a15c3"><span class="section-number-3">3.16</span> proc/ioports</h3>
<div class="outline-text-3" id="text-3-16">
<p>
注册的IO端口区间，用inb、outb访问：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/ioports
0000-0cf7<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:00
<span class="org-whitespace-space">  </span>0000-001f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>dma1
<span class="org-whitespace-space">  </span>0020-0021<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pic1
<span class="org-whitespace-space">  </span>0040-0043<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>timer0
<span class="org-whitespace-space">  </span>0050-0053<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>timer1
<span class="org-whitespace-space">  </span>0060-0060<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>keyboard
<span class="org-whitespace-space">  </span>0061-0061<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PNP0800:00
<span class="org-whitespace-space">  </span>0062-0062<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PNP0C09:00
<span class="org-whitespace-space">    </span>0062-0062<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>EC<span class="org-whitespace-space"> </span>data
<span class="org-whitespace-space">  </span>0064-0064<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>keyboard
<span class="org-whitespace-space">  </span>0066-0066<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PNP0C09:00
<span class="org-whitespace-space">    </span>0066-0066<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>EC<span class="org-whitespace-space"> </span>cmd
<span class="org-whitespace-space">  </span>0070-0071<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>rtc0
<span class="org-whitespace-space">  </span>0080-008f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>dma<span class="org-whitespace-space"> </span>page<span class="org-whitespace-space"> </span>reg
<span class="org-whitespace-space">  </span>00a0-00a1<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pic2
<span class="org-whitespace-space">  </span>00c0-00df<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>dma2
<span class="org-whitespace-space">  </span>00f0-00ff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>fpu
<span class="org-whitespace-space">    </span>00f0-00f0<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PNP0C04:00
<span class="org-whitespace-space">  </span>03c0-03df<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>vga+
<span class="org-whitespace-space">  </span>0400-0403<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>PM1a_EVT_BLK
<span class="org-whitespace-space">  </span>0404-0405<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>PM1a_CNT_BLK
<span class="org-whitespace-space">  </span>0408-040b<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>PM_TMR
<span class="org-whitespace-space">  </span>0410-0415<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>CPU<span class="org-whitespace-space"> </span>throttle
<span class="org-whitespace-space">  </span>0420-042f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>GPE0_BLK
<span class="org-whitespace-space">  </span>0430-0433<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iTCO_wdt
<span class="org-whitespace-space">    </span>0430-0433<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iTCO_wdt
<span class="org-whitespace-space">  </span>0450-0450<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ACPI<span class="org-whitespace-space"> </span>PM2_CNT_BLK
<span class="org-whitespace-space">  </span>0460-047f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iTCO_wdt
<span class="org-whitespace-space">    </span>0460-047f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>iTCO_wdt
<span class="org-whitespace-space">  </span>0500-057f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
<span class="org-whitespace-space">  </span>0800-080f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
0cf8-0cff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>conf1
0d00-ffff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:00
<span class="org-whitespace-space">  </span>15e0-15ef<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
<span class="org-whitespace-space">  </span>1600-167f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>pnp<span class="org-whitespace-space"> </span>00:01
<span class="org-whitespace-space">  </span>3000-3fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:04
<span class="org-whitespace-space">  </span>4000-4fff<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>PCI<span class="org-whitespace-space"> </span>Bus<span class="org-whitespace-space"> </span>0000:02
<span class="org-whitespace-space">  </span>5000-503f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:02.0
<span class="org-whitespace-space">  </span>5060-507f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.2
<span class="org-whitespace-space">    </span>5060-507f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ahci
<span class="org-whitespace-space">  </span>5080-509f<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:19.0
<span class="org-whitespace-space">  </span>50a0-50a7<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.2
<span class="org-whitespace-space">    </span>50a0-50a7<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ahci
<span class="org-whitespace-space">  </span>50a8-50af<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.2
<span class="org-whitespace-space">    </span>50a8-50af<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ahci
<span class="org-whitespace-space">  </span>50b0-50b7<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:16.3
<span class="org-whitespace-space">    </span>50b0-50b7<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>serial
<span class="org-whitespace-space">  </span>50b8-50bb<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.2
<span class="org-whitespace-space">    </span>50b8-50bb<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ahci
<span class="org-whitespace-space">  </span>50bc-50bf<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.2
<span class="org-whitespace-space">    </span>50bc-50bf<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>ahci
<span class="org-whitespace-space">  </span>efa0-efbf<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>0000:00:1f.3
<span class="org-whitespace-space">    </span>efa0-efbf<span class="org-whitespace-space"> </span>:<span class="org-whitespace-space"> </span>i801_smbus
</pre>
</div>

<p>
内核代码<a href="https://elixir.bootlin.com/linux/v4.15.4/source/kernel/resource.c">kernel/resource.c</a>，参见<a href="#iomem">iomem代码</a>。
</p>
</div>
</div>

<div id="outline-container-orgbeb1fa6" class="outline-3">
<h3 id="orgbeb1fa6"><span class="section-number-3">3.17</span> proc/kallsyms</h3>
<div class="outline-text-3" id="text-3-17">
<p>
内核导出的符号定义，供module(X)工具链接和绑定使用：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/kallsyms
0000000000000000<span class="org-whitespace-space"> </span>A<span class="org-whitespace-space"> </span>irq_stack_union
0000000000000000<span class="org-whitespace-space"> </span>A<span class="org-whitespace-space"> </span>__per_cpu_start
ffffffff810002b8<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>_stext
ffffffff81001000<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>hypercall_page
ffffffff81001000<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_set_trap_table
ffffffff81001020<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_mmu_update
ffffffff81001040<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_set_gdt
ffffffff81001060<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_stack_switch
ffffffff81001080<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_set_callbacks
ffffffff810010a0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_fpu_taskswitch
ffffffff810010c0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_sched_op_compat
ffffffff810010e0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_platform_op
ffffffff81001100<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_set_debugreg
ffffffff81001120<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_get_debugreg
ffffffff81001140<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_update_descriptor
ffffffff81001160<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_ni
ffffffff81001180<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>xen_hypercall_memory_op
...
ffffffff8113fb60<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>find_get_entries
ffffffff8113fc90<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>find_get_pages
ffffffff8113fdd0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_kfree
ffffffff8113fde0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_alloc_slab
ffffffff8113fe00<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_free_slab
ffffffff8113fe20<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_alloc_pages
ffffffff8113fe30<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_free_pages
ffffffff8113fe40<span class="org-whitespace-space"> </span>t<span class="org-whitespace-space"> </span>remove_element.isra.1
ffffffff8113fe60<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_destroy
ffffffff8113fec0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_alloc
ffffffff81140010<span class="org-whitespace-space"> </span>t<span class="org-whitespace-space"> </span>add_element
ffffffff81140030<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_free
ffffffff811400c0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_create_node
ffffffff81140200<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_create
ffffffff81140220<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_resize
ffffffff811403c0<span class="org-whitespace-space"> </span>T<span class="org-whitespace-space"> </span>mempool_kmalloc
</pre>
</div>
</div>
</div>

<div id="outline-container-org3522b40" class="outline-3">
<h3 id="org3522b40"><span class="section-number-3">3.18</span> proc/meminfo</h3>
<div class="outline-text-3" id="text-3-18">
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/meminfo
MemTotal:<span class="org-whitespace-space">       </span>16145220<span class="org-whitespace-space"> </span>kB
MemFree:<span class="org-whitespace-space">        </span>14074612<span class="org-whitespace-space"> </span>kB
MemAvailable:<span class="org-whitespace-space">   </span>14689140<span class="org-whitespace-space"> </span>kB
Buffers:<span class="org-whitespace-space">           </span>88384<span class="org-whitespace-space"> </span>kB
Cached:<span class="org-whitespace-space">           </span>878512<span class="org-whitespace-space"> </span>kB
SwapCached:<span class="org-whitespace-space">            </span>0<span class="org-whitespace-space"> </span>kB
Active:<span class="org-whitespace-space">          </span>1272364<span class="org-whitespace-space"> </span>kB
Inactive:<span class="org-whitespace-space">         </span>597024<span class="org-whitespace-space"> </span>kB
<span class="org-function-name">Active</span>(anon):<span class="org-whitespace-space">     </span>903844<span class="org-whitespace-space"> </span>kB
<span class="org-function-name">Inactive</span>(anon):<span class="org-whitespace-space">   </span>217676<span class="org-whitespace-space"> </span>kB
<span class="org-function-name">Active</span>(file):<span class="org-whitespace-space">     </span>368520<span class="org-whitespace-space"> </span>kB
<span class="org-function-name">Inactive</span>(file):<span class="org-whitespace-space">   </span>379348<span class="org-whitespace-space"> </span>kB
Unevictable:<span class="org-whitespace-space">         </span>120<span class="org-whitespace-space"> </span>kB
Mlocked:<span class="org-whitespace-space">             </span>120<span class="org-whitespace-space"> </span>kB
SwapTotal:<span class="org-whitespace-space">             </span>0<span class="org-whitespace-space"> </span>kB
SwapFree:<span class="org-whitespace-space">              </span>0<span class="org-whitespace-space"> </span>kB
Dirty:<span class="org-whitespace-space">               </span>100<span class="org-whitespace-space"> </span>kB
Writeback:<span class="org-whitespace-space">             </span>0<span class="org-whitespace-space"> </span>kB
AnonPages:<span class="org-whitespace-space">        </span>902604<span class="org-whitespace-space"> </span>kB
...
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b4996a" class="outline-3">
<h3 id="org1b4996a"><span class="section-number-3">3.19</span> proc/&lt;pid&gt;</h3>
<div class="outline-text-3" id="text-3-19">
</div>
<div id="outline-container-org468e188" class="outline-4">
<h4 id="org468e188"><span class="section-number-4">3.19.1</span> proc/&lt;pid&gt;/oom_adj</h4>
<div class="outline-text-4" id="text-3-19-1">
<p>
调整进程OOM-killing亲和度。有效范围[-17, +15]。-17是特殊值，禁止OOM-Killing。数值越大，OOM时被选中的可能性越大。默认为0，需要CAP_SYS_RESOURCE权限修改此值。2.6.36之后版本不建议使用此方式，请使用/proc/&lt;pid&gt;/oom_score_adj代替。
</p>
</div>
</div>

<div id="outline-container-org74ca80c" class="outline-4">
<h4 id="org74ca80c"><span class="section-number-4">3.19.2</span> proc/&lt;pid&gt;/oom_score</h4>
<div class="outline-text-4" id="text-3-19-2">
<p>
查看当前进程OOM-killer分值。分数越高越容易被OOM-Killer选中。基本分值与进程占用内存相关，且随着fork数量、CPU占用、nice、privileged、是否直接存取硬件调整：
</p>
<blockquote>
<p>
This  file displays the current score that the kernel gives to this process for the purpose of selecting
a process for the OOM-killer.  A higher score means that the process is more likely to  be  selected  by
the  OOM-killer.   The  basis for this score is the amount of memory used by the process, with increases
(+) or decreases (-) for factors including:
</p>
<ul class="org-ul">
<li>whether the process creates a lot of children using fork(2) (+);</li>
<li>whether the process has been running a long time, or has used a lot of CPU time (-);</li>
<li>whether the process has a low nice value (i.e., &gt; 0) (+);</li>
<li>whether the process is privileged (-); and</li>
<li>whether the process is making direct hardware access (-).</li>
<li>The oom_score also reflects the adjustment specified by the oom_score_adj or  oom_adj  setting  for  the</li>
</ul>
<p>
process.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orga6d148d" class="outline-4">
<h4 id="orga6d148d"><span class="section-number-4">3.19.3</span> proc/&lt;pid&gt;/oom_score_adj</h4>
<div class="outline-text-4" id="text-3-19-3">
<p>
调整OOM-killer选择该进程的坏值。数值范围[-1000, +1000]。-1000表示禁止被选中。重要的常驻程序可以设置-1000禁止进程被OOM-killer选中杀死：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span><span class="org-whitespace-space"> </span><span class="org-string">&lt;errno.h&gt;</span>
<span class="org-preprocessor">#include</span><span class="org-whitespace-space"> </span><span class="org-string">&lt;stdio.h&gt;</span>

<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">disable_oom</span>()
{
<span class="org-whitespace-space">    </span><span class="org-type">FILE</span><span class="org-whitespace-space"> </span>*<span class="org-variable-name">fp</span><span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>fopen(<span class="org-string">"/proc/self/oom_score_adj"</span>,<span class="org-whitespace-space"> </span><span class="org-string">"w"</span>);

<span class="org-whitespace-space">    </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(<span class="org-negation-char">!</span>fp)<span class="org-whitespace-space"> </span>{
<span class="org-whitespace-space">            </span>fprintf(stderr,<span class="org-whitespace-space"> </span><span class="org-string">"open</span><span class="org-whitespace-space"> </span><span class="org-string">oom_score_adj</span><span class="org-whitespace-space"> </span><span class="org-string">failed\n"</span>);
<span class="org-whitespace-space">            </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>-1;
<span class="org-whitespace-space">    </span>}

<span class="org-whitespace-space">    </span>fprintf(fp,<span class="org-whitespace-space"> </span><span class="org-string">"%i"</span>,<span class="org-whitespace-space"> </span>-1000);
<span class="org-whitespace-space">    </span>fclose(fp);

<span class="org-whitespace-space">    </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}

<span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-function-name">main</span>()
{
<span class="org-whitespace-space">        </span><span class="org-type">int</span><span class="org-whitespace-space"> </span><span class="org-variable-name">ret</span>;

<span class="org-whitespace-space">        </span>ret<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>disable_oom();
<span class="org-whitespace-space">        </span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span>(0<span class="org-whitespace-space"> </span>==<span class="org-whitespace-space"> </span>ret)
<span class="org-whitespace-space">                </span>printf(<span class="org-string">"disable</span><span class="org-whitespace-space"> </span><span class="org-string">oom</span><span class="org-whitespace-space"> </span><span class="org-string">success\n"</span>);

<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">//</span><span class="org-whitespace-space"> </span><span class="org-comment">do</span><span class="org-whitespace-space"> </span><span class="org-comment">post</span><span class="org-whitespace-space"> </span><span class="org-comment">work</span><span class="org-whitespace-space"> </span><span class="org-comment">...</span>

<span class="org-whitespace-space">        </span><span class="org-keyword">return</span><span class="org-whitespace-space"> </span>0;
}
</pre>
</div>

<pre class="example">
disable oom success

</pre>
</div>
</div>

<div id="outline-container-orgd2b620f" class="outline-4">
<h4 id="orgd2b620f"><span class="section-number-4">3.19.4</span> proc/&lt;pid&gt;/stack</h4>
<div class="outline-text-4" id="text-3-19-4">
<p>
进程内核态栈调用符号跟踪。
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/self/stack
[&lt;ffffffff810695d9&gt;]<span class="org-whitespace-space"> </span>do_wait+0x1d9/0x230
[&lt;ffffffff8106a637&gt;]<span class="org-whitespace-space"> </span>SyS_wait4+0x67/0xe0
[&lt;ffffffff81068430&gt;]<span class="org-whitespace-space"> </span>child_wait_callback+0x0/0x60
[&lt;ffffffff81514a0d&gt;]<span class="org-whitespace-space"> </span>system_call_fast_compare_end+0x10/0x15
[&lt;ffffffffffffffff&gt;]<span class="org-whitespace-space"> </span>0xffffffffffffffff

~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/self/stack
[&lt;ffffffff81021bae&gt;]<span class="org-whitespace-space"> </span>save_stack_trace_tsk+0x1e/0x40
[&lt;ffffffff81208ebd&gt;]<span class="org-whitespace-space"> </span>proc_pid_stack+0x8d/0xe0
[&lt;ffffffff81209ac7&gt;]<span class="org-whitespace-space"> </span>proc_single_show+0x47/0x80
[&lt;ffffffff811ca132&gt;]<span class="org-whitespace-space"> </span>seq_read+0xe2/0x360
[&lt;ffffffff811a8723&gt;]<span class="org-whitespace-space"> </span>vfs_read+0x93/0x170
[&lt;ffffffff811a9352&gt;]<span class="org-whitespace-space"> </span>SyS_read+0x42/0xa0
[&lt;ffffffff81516a28&gt;]<span class="org-whitespace-space"> </span>page_fault+0x28/0x30
[&lt;ffffffff81514a0d&gt;]<span class="org-whitespace-space"> </span>system_call_fast_compare_end+0x10/0x15
[&lt;ffffffffffffffff&gt;]<span class="org-whitespace-space"> </span>0xffffffffffffffff

~$<span class="org-whitespace-space"> </span>sudo<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/1/stack
[&lt;ffffffff811e8730&gt;]<span class="org-whitespace-space"> </span>ep_send_events_proc+0x0/0x1b0
[&lt;ffffffff811e9079&gt;]<span class="org-whitespace-space"> </span>ep_scan_ready_list.isra.7+0x199/0x1c0
[&lt;ffffffff811e931a&gt;]<span class="org-whitespace-space"> </span>ep_poll+0x25a/0x340
[&lt;ffffffff810970a0&gt;]<span class="org-whitespace-space"> </span>default_wake_function+0x0/0x10
[&lt;ffffffff811ea7a4&gt;]<span class="org-whitespace-space"> </span>SyS_epoll_wait+0xb4/0xe0
[&lt;ffffffff81514a0d&gt;]<span class="org-whitespace-space"> </span>system_call_fast_compare_end+0x10/0x15
[&lt;ffffffffffffffff&gt;]<span class="org-whitespace-space"> </span>0xffffffffffffffff
</pre>
</div>
</div>
</div>

<div id="outline-container-org75125d5" class="outline-4">
<h4 id="org75125d5"><span class="section-number-4">3.19.5</span> proc/&lt;pid&gt;/stat</h4>
<div class="outline-text-4" id="text-3-19-5">
<p>
进程状态信息，ps使用此处信息，对应代码<a href="https://elixir.bootlin.com/linux/v4.15.14/source/fs/proc/array.c">kernel/fs/proc/array.c</a>，截取部分意义代码：
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">The</span><span class="org-whitespace-space"> </span><span class="org-comment">task</span><span class="org-whitespace-space"> </span><span class="org-comment">state</span><span class="org-whitespace-space"> </span><span class="org-comment">array</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">strange</span><span class="org-whitespace-space"> </span><span class="org-comment">"bitmap"</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">reasons</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">sleep.</span><span class="org-whitespace-space"> </span><span class="org-comment">Thus</span><span class="org-whitespace-space"> </span><span class="org-comment">"running"</span><span class="org-whitespace-space"> </span><span class="org-comment">is</span><span class="org-whitespace-space"> </span><span class="org-comment">zero,</span><span class="org-whitespace-space"> </span><span class="org-comment">and</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">you</span><span class="org-whitespace-space"> </span><span class="org-comment">can</span><span class="org-whitespace-space"> </span><span class="org-comment">test</span><span class="org-whitespace-space"> </span><span class="org-comment">for</span><span class="org-whitespace-space"> </span><span class="org-comment">combinations</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">others</span><span class="org-whitespace-space"> </span><span class="org-comment">with</span>
<span class="org-whitespace-space"> </span><span class="org-comment">*</span><span class="org-whitespace-space"> </span><span class="org-comment">simple</span><span class="org-whitespace-space"> </span><span class="org-comment">bit</span><span class="org-whitespace-space"> </span><span class="org-comment">tests.</span>
<span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-keyword">static</span><span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-type">char</span><span class="org-whitespace-space"> </span>*<span class="org-whitespace-space"> </span><span class="org-keyword">const</span><span class="org-whitespace-space"> </span><span class="org-variable-name">task_state_array</span>[]<span class="org-whitespace-space"> </span>=<span class="org-whitespace-space"> </span>{

<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">states</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">TASK_REPORT:</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"R</span><span class="org-whitespace-space"> </span><span class="org-string">(running)"</span>,<span class="org-whitespace-tab">          </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x00</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"S</span><span class="org-whitespace-space"> </span><span class="org-string">(sleeping)"</span>,<span class="org-whitespace-tab">         </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x01</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"D</span><span class="org-whitespace-space"> </span><span class="org-string">(disk</span><span class="org-whitespace-space"> </span><span class="org-string">sleep)"</span>,<span class="org-whitespace-tab">       </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x02</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"T</span><span class="org-whitespace-space"> </span><span class="org-string">(stopped)"</span>,<span class="org-whitespace-tab">          </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x04</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"t</span><span class="org-whitespace-space"> </span><span class="org-string">(tracing</span><span class="org-whitespace-space"> </span><span class="org-string">stop)"</span>,<span class="org-whitespace-tab">     </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x08</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"X</span><span class="org-whitespace-space"> </span><span class="org-string">(dead)"</span>,<span class="org-whitespace-tab">             </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x10</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"Z</span><span class="org-whitespace-space"> </span><span class="org-string">(zombie)"</span>,<span class="org-whitespace-tab">           </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x20</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"P</span><span class="org-whitespace-space"> </span><span class="org-string">(parked)"</span>,<span class="org-whitespace-tab">           </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x40</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>

<span class="org-whitespace-space">        </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">states</span><span class="org-whitespace-space"> </span><span class="org-comment">beyond</span><span class="org-whitespace-space"> </span><span class="org-comment">TASK_REPORT:</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
<span class="org-whitespace-space">        </span><span class="org-string">"I</span><span class="org-whitespace-space"> </span><span class="org-string">(idle)"</span>,<span class="org-whitespace-tab">             </span><span class="org-comment-delimiter">/*</span><span class="org-whitespace-space"> </span><span class="org-comment">0x80</span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">*/</span>
};
</pre>
</div>

<p>
Man页有各细节描述：
</p>
<blockquote>
<p>
~$ cat /proc/self/stat
1897 (bash) S 1892 1897 1897 34817 6762 4202496 76561 174332 1 115 113 36 134 64 20 0 1 0 3871 31305728 1893 18446744073709551615 4194304 5184116 140734690585584 140734690584264 140388838861628 0 65536 3670020 1266777851 0 0 0 17 2 0 0 2 0 0 7282144 7319112 11919360 140734690589286 140734690589292 140734690589292 140734690590702 0
</p>

<p>
<i>proc</i>[pid]/stat
       Status  information  about the process.  This is used by ps(1).  It
       is defined in the kernel source file fs/proc/array.c.
</p>

<p>
The fields, in order, with their proper scanf(3) format specifiers,
are:
</p>

<p>
(1) pid  %d
          The process ID.
</p>

<p>
(2) comm  %s
          The  filename of the executable, in parentheses.  This is
          visible whether or not the executable is swapped out.
</p>

<p>
(3) state  %c
          One  of  the  following  characters,  indicating  process
          state:
</p>

<p>
R  Running
</p>

<p>
S  Sleeping in an interruptible wait
</p>

<p>
D  Waiting in uninterruptible disk sleep
</p>

<p>
Z  Zombie
</p>

<p>
T  Stopped  (on  a signal) or (before Linux 2.6.33) trace
   stopped
</p>

<p>
t  Tracing stop (Linux 2.6.33 onward)
</p>

<p>
W  Paging (only before Linux 2.6.0)
</p>

<p>
X  Dead (from Linux 2.6.0 onward)
</p>

<p>
x  Dead (Linux 2.6.33 to 3.13 only)
</p>

<p>
K  Wakekill (Linux 2.6.33 to 3.13 only)
</p>

<p>
W  Waking (Linux 2.6.33 to 3.13 only)
</p>

<p>
P  Parked (Linux 3.9 to 3.13 only)
</p>


<p>
(4) ppid  %d
          The PID of the parent of this process.
</p>

<p>
(5) pgrp  %d
          The process group ID of the process.
</p>

<p>
(6) session  %d
          The session ID of the process.
</p>

<p>
(7) tty_nr  %d
          The controlling terminal  of  the  process.   (The  minor
          device  number is contained in the combination of bits 31
          to 20 and 7 to 0; the major device number is in  bits  15
          to 8.)
</p>

<p>
(8) tpgid  %d
          The ID of the foreground process group of the controlling
          terminal of the process.
</p>

<p>
(9) flags  %u
          The kernel flags word of the process.  For bit  meanings,
          see  the  PF_*  defines  in  the Linux kernel source file
          include/linux/sched.h.  Details depend on the kernel ver‐
          sion.
</p>

<p>
The format for this field was %lu before Linux 2.6.
</p>

<p>
(1) minflt  %lu
          The  number  of  minor  faults the process has made which
          have not required loading a memory page from disk.
</p>

<p>
(11) cminflt  %lu
          The number of minor faults that the process's  waited-for
          children have made.
</p>

<p>
(12) majflt  %lu
          The  number  of  major  faults the process has made which
          have required loading a memory page from disk.
</p>

<p>
(13) cmajflt  %lu
          The number of major faults that the process's  waited-for
          children have made.
</p>

<p>
(14) utime  %lu
          Amount  of  time  that this process has been scheduled in
          user  mode,  measured   in   clock   ticks   (divide   by
          sysconf(_SC_CLK_TCK)).    This   includes   guest   time,
          guest_time (time spent running a virtual CPU, see below),
          so that applications that are not aware of the guest time
          field do not lose that time from their calculations.
</p>

<p>
(15) stime  %lu
          Amount of time that this process has  been  scheduled  in
          kernel   mode,   measured   in  clock  ticks  (divide  by
          sysconf(_SC_CLK_TCK)).
</p>

<p>
(16) cutime  %ld
          Amount of time that this  process's  waited-for  children
          have been scheduled in user mode, measured in clock ticks
          (divide by sysconf(_SC_CLK_TCK)).  (See  also  times(2).)
          This includes guest time, cguest_time (time spent running
          a virtual CPU, see below).
</p>

<p>
(17) cstime  %ld
          Amount of time that this  process's  waited-for  children
          have  been  scheduled  in  kernel mode, measured in clock
          ticks (divide by sysconf(_SC_CLK_TCK)).
</p>


<p>
(18) priority  %ld
          (Explanation for Linux 2.6) For processes running a real-
          time scheduling policy (policy below; see sched_setsched‐
          uler(2)), this is the negated scheduling priority,  minus
          one;  that  is,  a number in the range -2 to -100, corre‐
          sponding to real-time priorities 1 to 99.  For  processes
          running  under a non-real-time scheduling policy, this is
          the raw nice value (setpriority(2)) as represented in the
          kernel.   The kernel stores nice values as numbers in the
          range 0 (high) to 39 (low), corresponding  to  the  user-
          visible nice range of -20 to 19.
</p>

<p>
Before  Linux  2.6,  this was a scaled value based on the
scheduler weighting given to this process.
</p>

<p>
(19) nice  %ld
          The nice value (see setpriority(2)), a value in the range
          19 (low priority) to -20 (high priority).
</p>

<p>
(20) num_threads  %ld
          Number  of  threads  in  this  process (since Linux 2.6).
          Before kernel 2.6, this field was hard coded to  0  as  a
          placeholder for an earlier removed field.
</p>

<p>
(21) itrealvalue  %ld
          The  time  in  jiffies before the next SIGALRM is sent to
          the process due  to  an  interval  timer.   Since  kernel
          2.6.17,  this  field is no longer maintained, and is hard
          coded as 0.
</p>

<p>
(22) starttime  %llu
          The time the process started after system boot.  In  ker‐
          nels  before  Linux  2.6,  this  value  was  expressed in
          jiffies.  Since Linux 2.6,  the  value  is  expressed  in
          clock ticks (divide by sysconf(_SC_CLK_TCK)).
</p>

<p>
The format for this field was %lu before Linux 2.6.
</p>

<p>
(23) vsize  %lu
          Virtual memory size in bytes.
</p>

<p>
(24) rss  %ld
          Resident  Set  Size:  number  of pages the process has in
          real memory.  This is just the pages which  count  toward
          text,  data, or stack space.  This does not include pages
          which have  not  been  demand-loaded  in,  or  which  are
          swapped out.
</p>

<p>
(25) rsslim  %lu
          Current  soft  limit  in bytes on the rss of the process;
          see the description of RLIMIT_RSS in getrlimit(2).
</p>

<p>
(26) startcode  %lu
          The address above which program text can run.
</p>

<p>
(27) endcode  %lu
          The address below which program text can run.
</p>

<p>
(28) startstack  %lu
          The address of the start (i.e., bottom) of the stack.
</p>

<p>
(29) kstkesp  %lu
          The current value of ESP (stack pointer), as found in the
          kernel stack page for the process.
</p>

<p>
(30) kstkeip  %lu
          The current EIP (instruction pointer).
</p>

<p>
(31) signal  %lu
          The  bitmap  of  pending  signals, displayed as a decimal
          number.  Obsolete, because it does not  provide  informa‐
          tion   on   real-time   signals;  use  <i>proc</i>[pid]/status
          instead.
</p>

<p>
(32) blocked  %lu
          The bitmap of blocked signals,  displayed  as  a  decimal
          number.   Obsolete,  because it does not provide informa‐
          tion  on  real-time   signals;   use   <i>proc</i>[pid]/status
          instead.
</p>

<p>
(33) sigignore  %lu
          The  bitmap  of  ignored  signals, displayed as a decimal
          number.  Obsolete, because it does not  provide  informa‐
          tion   on   real-time   signals;  use  <i>proc</i>[pid]/status
          instead.
</p>

<p>
(34) sigcatch  %lu
          The bitmap of caught signals, displayed as a decimal num‐
          ber.   Obsolete,  because it does not provide information
          on real-time signals; use <i>proc</i>[pid]/status instead.
</p>

<p>
(35) wchan  %lu
          This is the "channel" in which the  process  is  waiting.
          It  is  the address of a location in the kernel where the
          process is sleeping.  The corresponding symbolic name can
          be found in <i>proc</i>[pid]/wchan.
</p>

<p>
(36) nswap  %lu
          Number of pages swapped (not maintained).
</p>

<p>
(37) cnswap  %lu
          Cumulative nswap for child processes (not maintained).
</p>

<p>
(38) exit_signal  %d  (since Linux 2.1.22)
          Signal to be sent to parent when we die.
</p>

<p>
(39) processor  %d  (since Linux 2.2.8)
          CPU number last executed on.
</p>

<p>
(40) rt_priority  %u  (since Linux 2.5.19)
          Real-time scheduling priority, a number in the range 1 to
          99 for processes scheduled under a real-time  policy,  or
          0,   for  non-real-time  processes  (see  sched_setsched‐
          uler(2)).
</p>

<p>
(41) policy  %u  (since Linux 2.5.19)
          Scheduling policy  (see  sched_setscheduler(2)).   Decode
          using the SCHED_* constants in linux/sched.h.
</p>

<p>
The format for this field was %lu before Linux 2.6.22.
</p>

<p>
(42) delayacct_blkio_ticks  %llu  (since Linux 2.6.18)
          Aggregated  block  I/O  delays,  measured  in clock ticks
          (centiseconds).
</p>

<p>
(43) guest_time  %lu  (since Linux 2.6.24)
          Guest time of the process (time spent running  a  virtual
          CPU  for  a  guest  operating  system), measured in clock
          ticks (divide by sysconf(_SC_CLK_TCK)).
</p>

<p>
(44) cguest_time  %ld  (since Linux 2.6.24)
          Guest time of the process's children, measured  in  clock
          ticks (divide by sysconf(_SC_CLK_TCK)).
</p>

<p>
(45) start_data  %lu  (since Linux 3.3)
          Address above which program initialized and uninitialized
          (BSS) data are placed.
</p>

<p>
(46) end_data  %lu  (since Linux 3.3)
          Address below which program initialized and uninitialized
          (BSS) data are placed.
</p>

<p>
(47) start_brk  %lu  (since Linux 3.3)
          Address  above  which  program  heap can be expanded with
          brk(2).
</p>

<p>
(48) arg_start  %lu  (since Linux 3.5)
          Address above which program command-line arguments (argv)
          are placed.
</p>

<p>
(49) arg_end  %lu  (since Linux 3.5)
          Address  below  program command-line arguments (argv) are
          placed.
</p>

<p>
(50) env_start  %lu  (since Linux 3.5)
          Address above which program environment is placed.
</p>

<p>
(51) env_end  %lu  (since Linux 3.5)
          Address below which program environment is placed.
</p>

<p>
(52) exit_code  %d  (since Linux 3.5)
          The thread's exit status in the form  reported  by  wait‐
          pid(2).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org676c69d" class="outline-4">
<h4 id="org676c69d"><span class="section-number-4">3.19.6</span> proc/&lt;pid&gt;/statm</h4>
<div class="outline-text-4" id="text-3-19-6">
<p>
进程内存使用评估，以Page为单位。
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>statm
7643<span class="org-whitespace-space"> </span>1893<span class="org-whitespace-space"> </span>850<span class="org-whitespace-space"> </span>242<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>1040<span class="org-whitespace-space"> </span>0
</pre>
</div>

<blockquote>
<p>
<i>proc</i>[pid]/statm
       Provides  information  about  memory usage, measured in pages.  The
       columns are:
</p>

<p>
size       (1) total program size
           (same as VmSize in <i>proc</i>[pid]/status)
resident   (2) resident set size
           (same as VmRSS in <i>proc</i>[pid]/status)
share      (3) shared pages (i.e., backed by a file)
text       (4) text (code)
lib        (5) library (unused in Linux 2.6)
data       (6) data + stack
dt         (7) dirty pages (unused in Linux 2.6)
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4289172" class="outline-4">
<h4 id="org4289172"><span class="section-number-4">3.19.7</span> proc/&lt;pid&gt;/status</h4>
<div class="outline-text-4" id="text-3-19-7">
<p>
可读方式提供更多进程信息：
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/self/status
Name:<span class="org-whitespace-space">   </span>cat
State:<span class="org-whitespace-space">  </span>R<span class="org-whitespace-space"> </span>(running)
Tgid:<span class="org-whitespace-space">   </span>6955
Ngid:<span class="org-whitespace-space">   </span>0
Pid:<span class="org-whitespace-space">    </span>6955
PPid:<span class="org-whitespace-space">   </span>1897
TracerPid:<span class="org-whitespace-space">      </span>0
Uid:<span class="org-whitespace-space">    </span>1000<span class="org-whitespace-space">    </span>1000<span class="org-whitespace-space">    </span>1000<span class="org-whitespace-space">    </span>1000
Gid:<span class="org-whitespace-space">    </span>1000<span class="org-whitespace-space">    </span>1000<span class="org-whitespace-space">    </span>1000<span class="org-whitespace-space">    </span>1000
FDSize:<span class="org-whitespace-space"> </span>256
Groups:<span class="org-whitespace-space"> </span>24<span class="org-whitespace-space"> </span>25<span class="org-whitespace-space"> </span>29<span class="org-whitespace-space"> </span>30<span class="org-whitespace-space"> </span>44<span class="org-whitespace-space"> </span>46<span class="org-whitespace-space"> </span>108<span class="org-whitespace-space"> </span>110<span class="org-whitespace-space"> </span>113<span class="org-whitespace-space"> </span>118<span class="org-whitespace-space"> </span>1000
VmPeak:<span class="org-whitespace-space">    </span>11012<span class="org-whitespace-space"> </span>kB
VmSize:<span class="org-whitespace-space">    </span>11012<span class="org-whitespace-space"> </span>kB
VmLck:<span class="org-whitespace-space">         </span>0<span class="org-whitespace-space"> </span>kB
VmPin:<span class="org-whitespace-space">         </span>0<span class="org-whitespace-space"> </span>kB
VmHWM:<span class="org-whitespace-space">       </span>712<span class="org-whitespace-space"> </span>kB
VmRSS:<span class="org-whitespace-space">       </span>712<span class="org-whitespace-space"> </span>kB
VmData:<span class="org-whitespace-space">      </span>324<span class="org-whitespace-space"> </span>kB
VmStk:<span class="org-whitespace-space">       </span>136<span class="org-whitespace-space"> </span>kB
VmExe:<span class="org-whitespace-space">        </span>48<span class="org-whitespace-space"> </span>kB
VmLib:<span class="org-whitespace-space">      </span>1796<span class="org-whitespace-space"> </span>kB
VmPTE:<span class="org-whitespace-space">        </span>40<span class="org-whitespace-space"> </span>kB
VmSwap:<span class="org-whitespace-space">        </span>0<span class="org-whitespace-space"> </span>kB
Threads:<span class="org-whitespace-space">        </span>1
SigQ:<span class="org-whitespace-space">   </span>0/63000
SigPnd:<span class="org-whitespace-space"> </span>0000000000000000
ShdPnd:<span class="org-whitespace-space"> </span>0000000000000000
SigBlk:<span class="org-whitespace-space"> </span>0000000000000000
SigIgn:<span class="org-whitespace-space"> </span>0000000000000000
SigCgt:<span class="org-whitespace-space"> </span>0000000000000000
CapInh:<span class="org-whitespace-space"> </span>0000000000000000
CapPrm:<span class="org-whitespace-space"> </span>0000000000000000
CapEff:<span class="org-whitespace-space"> </span>0000000000000000
CapBnd:<span class="org-whitespace-space"> </span>0000003fffffffff
Seccomp:<span class="org-whitespace-space">        </span>0
Cpus_allowed:<span class="org-whitespace-space">   </span>ff
Cpus_allowed_list:<span class="org-whitespace-space">      </span>0-7
Mems_allowed:<span class="org-whitespace-space">   </span>00000000,00000001
Mems_allowed_list:<span class="org-whitespace-space">      </span>0
voluntary_ctxt_switches:<span class="org-whitespace-space">        </span>0
nonvoluntary_ctxt_switches:<span class="org-whitespace-space">     </span>1
</pre>
</div>

<blockquote>
<ul class="org-ul">
<li>Name: Command run by this process.</li>

<li>State: Current state of the process.  One of  "R  (running)",  "S
(sleeping)", "D (disk sleep)", "T (stopped)", "T (tracing stop)",
"Z (zombie)", or "X (dead)".</li>

<li>Tgid: Thread group ID (i.e., Process ID).</li>

<li>Pid: Thread ID (see gettid(2)).</li>

<li>PPid: PID of parent process.</li>

<li>TracerPid: PID of process tracing this process (0  if  not  being
traced).</li>

<li>Uid, Gid: Real, effective, saved set, and filesystem UIDs (GIDs).</li>

<li>FDSize: Number of file descriptor slots currently allocated.</li>

<li>Groups: Supplementary group list.</li>

<li>VmPeak: Peak virtual memory size.</li>

<li>VmSize: Virtual memory size.</li>

<li>VmLck: Locked memory size (see mlock(3)).</li>

<li>VmHWM: Peak resident set size ("high water mark").</li>

<li>VmRSS: Resident set size.</li>

<li>VmData, VmStk, VmExe: Size of data, stack, and text segments.</li>

<li>VmLib: Shared library code size.</li>

<li>VmPTE: Page table entries size (since Linux 2.6.10).</li>

<li>Threads: Number of threads in process containing this thread.</li>

<li>SigQ: This field contains two slash-separated numbers that relate
to queued signals for the real user  ID  of  this  process.   The
first of these is the number of currently queued signals for this
real user ID, and the second is the resource limit on the  number
of  queued  signals  for  this  process  (see  the description of
RLIMIT_SIGPENDING in getrlimit(2)).</li>

<li>SigPnd, ShdPnd: Number of signals  pending  for  thread  and  for
process as a whole (see pthreads(7) and signal(7)).</li>

<li>SigBlk,  SigIgn,  SigCgt: Masks indicating signals being blocked,
ignored, and caught (see signal(7)).</li>

<li>CapInh, CapPrm, CapEff: Masks of capabilities enabled in  inheri‐
table, permitted, and effective sets (see capabilities(7)).</li>

<li>CapBnd: Capability Bounding set (since Linux 2.6.26, see capabil‐
ities(7)).</li>

<li>Cpus_allowed: Mask of CPUs on which this process may  run  (since
Linux 2.6.24, see cpuset(7)).</li>

<li>Cpus_allowed_list:  Same as previous, but in "list format" (since
Linux 2.6.26, see cpuset(7)).</li>

<li>Mems_allowed: Mask of memory nodes allowed to this process (since
Linux 2.6.24, see cpuset(7)).</li>

<li>Mems_allowed_list:  Same as previous, but in "list format" (since
Linux 2.6.26, see cpuset(7)).</li>

<li>voluntary_ctxt_switches,  nonvoluntary_ctxt_switches:  Number  of
voluntary and involuntary context switches (since Linux 2.6.23).</li>
</ul>
</blockquote>
</div>
</div>

<div id="outline-container-orgdf165b6" class="outline-4">
<h4 id="orgdf165b6"><span class="section-number-4">3.19.8</span> proc/&lt;pid&gt;/syscall</h4>
<div class="outline-text-4" id="text-3-19-8">
<p>
进程最近系统调用的信息。第一列为调用号，其后是stack地址、ecx，和6个通用寄存器信息。
</p>
<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>cat<span class="org-whitespace-space"> </span>/proc/self/syscall
0<span class="org-whitespace-space"> </span>0x3<span class="org-whitespace-space"> </span>0x7f065d1ad000<span class="org-whitespace-space"> </span>0x20000<span class="org-whitespace-space"> </span>0x7ffcb1120dd0<span class="org-whitespace-space"> </span>0xffffffff<span class="org-whitespace-space"> </span>0x0<span class="org-whitespace-space"> </span>0x7ffcb1120f70<span class="org-whitespace-space"> </span>0x7f06<span class="org-whitespace-line">5cce0ba0</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5306b71" class="outline-3">
<h3 id="org5306b71"><span class="section-number-3">3.20</span> proc/self</h3>
<div class="outline-text-3" id="text-3-20">
<p>
proc/self是一个符号链接，总是指向执行进程本身(/proc/&lt;pid&gt;)。
</p>

<div class="org-src-container">
<pre class="src src-sh">~$<span class="org-whitespace-space"> </span>ls<span class="org-whitespace-space"> </span>-ld<span class="org-whitespace-space"> </span>/proc/self
lrwxrwxrwx<span class="org-whitespace-space"> </span>1<span class="org-whitespace-space"> </span>root<span class="org-whitespace-space"> </span>root<span class="org-whitespace-space"> </span>0<span class="org-whitespace-space"> </span>Dec<span class="org-whitespace-space"> </span>20<span class="org-whitespace-space"> </span>18:47<span class="org-whitespace-space"> </span>/proc/self<span class="org-whitespace-space"> </span>-&gt;<span class="org-whitespace-space"> </span>2289
</pre>
</div>
</div>
</div>

<div id="outline-container-org0126384" class="outline-3">
<h3 id="org0126384"><span class="section-number-3">3.21</span> oom_score</h3>
<div class="outline-text-3" id="text-3-21">
<div class="org-src-container">
<pre class="src src-C">
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1dee46d" class="outline-2">
<h2 id="org1dee46d"><span class="section-number-2">4</span> 内核实现</h2>
</div>

<div id="outline-container-org2af8850" class="outline-2">
<h2 id="org2af8850"><span class="section-number-2">5</span> 参考资料</h2>
<div class="outline-text-2" id="text-5">
<dl class="org-dl">
<dt>IBM developer procfs、seq_file、debugfs and relayfs</dt><dd><a href="https://www.ibm.com/developerworks/cn/linux/l-kerns-usrs2/">https://www.ibm.com/developerworks/cn/linux/l-kerns-usrs2/</a></dd>
<dt>LWN Driver porting: The seq_file interface</dt><dd><a href="https://lwn.net/Articles/22355/">https://lwn.net/Articles/22355/</a></dd>
</dl>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread" class="disqus container"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://ycode.org/linux-proc.html';
    this.page.identifier = 'linux-proc.html';
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://yanyg.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div class="copyright">
2012-2020 Copyright&copy; <i> YANYG - Powered by Emacs Orgmode</i>
</div>
</div>
</body>
</html>
